{"pageProps":{"metadata":{"title":"Hetzner Cloud Builder | Integrations"},"product":{"name":"Packer","slug":"packer","algoliaConfig":{"indexName":"product_PACKER","searchOnlyApiKey":"4e1ea7f4bf4335ac43d9f28463e42148"},"analyticsConfig":{"includedDomains":"packer.io www.packer.io","segmentWriteKey":"AjXdfmTTk1I9q9dfyePuDFHBrz1tCO3l"},"datoToken":"88b4984480dad56295a8aadae6caad","metadata":{"title":"Packer by HashiCorp","description":"Packer helps you create golden images for multiple platforms from a single source configuration.","image":"https://www.packer.io/packer-public/img/og-image.png","icon":[{"href":"/packer-public/_favicon.ico"}]},"alertBannerActive":true,"alertBanner":{"tag":"HashiDays","url":"https://hashicorp.com/conferences/hashidays","text":"One conference. Three cities.","linkText":"Find a city near you","expirationDate":"2024-06-14T00:00:00-08:00"},"version":"1.7.10","basePaths":["docs","guides","intro","downloads"],"rootDocsPaths":[{"iconName":"docs","name":"Documentation","path":"docs"},{"iconName":"guide","name":"Guides","path":"guides"}],"integrationsConfig":{"description":"A curated collection of official, partner, and community Packer Integrations."}},"integration":{"id":"5818fdf9-0b5d-4d23-b0c4-0e0406714074","slug":"hcloud","name":"Hetzner Cloud","description":"The hcloud plugin can be used with HashiCorp Packer to create custom images on Hetzner Cloud.","license_type":null,"license_url":null,"external_only":false,"external_url":null,"tier":"partner","repo_url":"https://github.com/hetznercloud/packer-plugin-hcloud","subdirectory":"/.web-docs","created_at":"2023-06-15T19:02:49.962Z","updated_at":"2023-11-07T18:31:17.894Z","hide_versions":false,"organization":{"id":"90b1a82d-3961-402a-80d8-98acbedbdb1b","slug":"hetznercloud","created_at":"2023-11-07T18:31:17.374Z","updated_at":"2023-11-07T18:31:17.374Z"},"product":{"id":"4c2b00c6-7cc1-4e4c-b596-4ab57e319f21","slug":"packer","name":"Packer","created_at":"2022-11-09T22:56:29.896Z","updated_at":"2022-11-09T22:56:29.896Z"},"versions":["1.6.0","1.5.4","1.5.3","1.5.2","1.5.1","1.5.0","1.4.0","1.3.0","1.2.1","1.2.0","1.1.1","1.1.0","1.0.5"],"components":[{"id":"36076511-3ced-4faf-addf-101fce0405ff","slug":"builder","name":"Builder","plural_name":"Builders"}],"flags":[],"integration_type":null},"activeRelease":{"id":"6b90fa54-3e72-4036-af5a-bcc03223ab2c","integration_id":"5818fdf9-0b5d-4d23-b0c4-0e0406714074","version":"1.6.0","readme":"The `hcloud` Packer plugin is able to create new images for use with [Hetzner\nCloud](https://www.hetzner.cloud).\n\n### Installation\n\nTo install this plugin, copy and paste this code into your Packer configuration, then run [`packer init`](https://www.packer.io/docs/commands/init).\n\n```hcl\npacker {\n  required_plugins {\n    hcloud = {\n      source  = \"github.com/hetznercloud/hcloud\"\n      version = \"~> 1\"\n    }\n  }\n}\n```\n\nAlternatively, you can use `packer plugins install` to manage installation of this plugin.\n\n```sh\n$ packer plugins install github.com/hetznercloud/hcloud\n```\n\n#### Migrate from `github.com/hashicorp/hcloud`\n\nOn the 7 November 2023, the Packer plugin source moved from `github.com/hashicorp/hcloud` to `github.com/hetznercloud/hcloud`, make sure to update your Packer configuration with the new source:\n\n```patch\n packer {\n   required_plugins {\n     hcloud = {\n-      source  = \"github.com/hashicorp/hcloud\"\n+      source  = \"github.com/hetznercloud/hcloud\"\n       version = \">= 1.1.1\"\n     }\n   }\n }\n```\n\n### Components\n\n#### Builders\n\n- [hcloud](/packer/integrations/hetznercloud/hcloud/latest/components/builder/hcloud) - The hcloud builder\n  lets you create custom images on Hetzner Cloud by launching an instance, provisioning it, then\n  export it as an image for later reuse.\n","created_at":"2024-08-14T11:50:59.488Z","updated_at":"2024-08-14T11:50:59.488Z","components":[{"id":"70617ec1-150d-4d57-993c-c4653ffeb537","integration_release_id":"6b90fa54-3e72-4036-af5a-bcc03223ab2c","component_id":"36076511-3ced-4faf-addf-101fce0405ff","readme":"Type: `hcloud`\nArtifact BuilderId: `hcloud.builder`\n\nThe `hcloud` Packer builder is able to create new images for use with [Hetzner\nCloud](https://www.hetzner.com/cloud/). The builder takes a source image, runs any\nprovisioning necessary on the image after launching it, then snapshots it into\na reusable image. This reusable image can then be used as the foundation of new\nservers that are launched within the Hetzner Cloud.\n\nThe builder does _not_ manage images. Once it creates an image, it is up to you\nto use it or delete it.\n\n## Connection to the server\n\nThe builder will connect to the server using the first available IP, in the following order:\n\n- `public_ipv4`: If enabled, the public IPv4 will be used,\n- `public_ipv6`: If enabled, the public IPv6 will be used,\n- `private_ipv4`: If the server is attached to private networks, the private IPv4 of the\n  first private network will be used.\n\n## Configuration Reference\n\nThere are many configuration options available for the builder. They are\nsegmented below into two categories: required and optional parameters. Within\neach category, the available configuration keys are alphabetized.\n\nIn addition to the options listed here, a\n[communicator](/packer/docs/templates/legacy_json_templates/communicator) can be configured for this\nbuilder.\n\n### Required Builder Configuration options:\n\n- `token` (string) - The client TOKEN to use to access your account. It can\n  also be specified via environment variable `HCLOUD_TOKEN`, if set.\n\n- `image` (string) - ID or name of image to launch server from. Alternatively\n  you can use `image_filter`.\n\n- `location` (string) - The name of the location to launch the server in.\n\n- `server_type` (string) - ID or name of the server type this server should\n  be created with.\n\n### Optional:\n\n- `endpoint` (string) - Non standard api endpoint URL. Set this if you are\n  using a Hetzner Cloud API compatible service. It can also be specified via\n  environment variable `HCLOUD_ENDPOINT`.\n\n- `image_filter` (object) - Filters used to populate the `filter`\n  field. Example:\n\n  ```hcl\n  image_filter {\n    most_recent   = true\n    with_selector = [\"name==my-image\"]\n  }\n  ```\n\n  This selects the most recent image with the label `name==my-image`. NOTE:\n  This will fail unless _exactly_ one AMI is returned. In the above example,\n  `most_recent` will cause this to succeed by selecting the newest image.\n\n  - `with_selector` (list of strings) - label selectors used to select an\n    `image`. NOTE: This will fail unless _exactly_ one image is returned.\n    Check the official hcloud docs on\n    [Label Selectors](https://docs.hetzner.cloud/#label-selector)\n    for more info.\n\n  - `most_recent` (boolean) - Selects the newest created image when true.\n    This is most useful if you base your image on another Packer build image.\n\n  You may set this in place of `image`, but not both.\n\n- `server_name` (string) - The name assigned to the server. The Hetzner Cloud\n  sets the hostname of the machine to this value.\n\n- `server_labels` (map of key/value strings) - Key/value pair labels to\n  apply to the created server.\n\n- `snapshot_name` (string) - The name of the resulting snapshot that will\n  appear in your account as image description. Defaults to `packer-{{timestamp}}` (see\n  [configuration templates](/packer/docs/templates/legacy_json_templates/engine) for more info).\n  The snapshot_name must be unique per architecture.\n  If you want to reference the image as a sample in your terraform configuration please use the image id or the `snapshot_labels`.\n\n- `snapshot_labels` (map of key/value strings) - Key/value pair labels to\n  apply to the created image.\n\n- `poll_interval` (string) - Configures the interval in which actions are\n  polled by the client. Default `500ms`. Increase this interval if you run\n  into rate limiting errors.\n\n- `user_data` (string) - User data to launch with the server. Packer will not\n  automatically wait for a user script to finish before shutting down the\n  instance this must be handled in a provisioner.\n\n- `user_data_file` (string) - Path to a file that will be used for the user\n  data when launching the server.\n\n- `ssh_keys_labels` (map of key/value strings) - Key/value pair labels to\n  apply to the created ssh keys.\n\n- `ssh_keys` (array of strings) - List of SSH keys by name or id to be added\n  to image on launch.\n\n<!-- Code generated from the comments of the SSHTemporaryKeyPair struct in communicator/config.go; DO NOT EDIT MANUALLY -->\n\n- `temporary_key_pair_type` (string) - `dsa` | `ecdsa` | `ed25519` | `rsa` ( the default )\n  \n  Specifies the type of key to create. The possible values are 'dsa',\n  'ecdsa', 'ed25519', or 'rsa'.\n  \n  NOTE: DSA is deprecated and no longer recognized as secure, please\n  consider other alternatives like RSA or ED25519.\n\n- `temporary_key_pair_bits` (int) - Specifies the number of bits in the key to create. For RSA keys, the\n  minimum size is 1024 bits and the default is 4096 bits. Generally, 3072\n  bits is considered sufficient. DSA keys must be exactly 1024 bits as\n  specified by FIPS 186-2. For ECDSA keys, bits determines the key length\n  by selecting from one of three elliptic curve sizes: 256, 384 or 521\n  bits. Attempting to use bit lengths other than these three values for\n  ECDSA keys will fail. Ed25519 keys have a fixed length and bits will be\n  ignored.\n  \n  NOTE: DSA is deprecated and no longer recognized as secure as specified\n  by FIPS 186-5, please consider other alternatives like RSA or ED25519.\n\n<!-- End of code generated from the comments of the SSHTemporaryKeyPair struct in communicator/config.go; -->\n\n\n- `rescue` (string) - Enable and boot in to the specified rescue system. This\n  enables simple installation of custom operating systems. `linux64` or `linux32`\n\n- `upgrade_server_type` (string) - ID or name of the server type this server should\n  be upgraded to, without changing the disk size. Improves building performance.\n  The resulting snapshot is compatible with smaller server types and disk sizes.\n\n- `networks` (array of integers) - List of Network IDs which should be\n  attached to the server private network interface at creation time.\n\n- `public_ipv4` (string) - ID, name or IP address of a pre-allocated Hetzner\n  Primary IPv4 address to use for the created server.\n\n- `public_ipv4_disabled` (bool) - Disable the public ipv4 for the created server.\n\n- `public_ipv6` (string) - ID, name or IP address of a pre-allocated Hetzner\n  Primary IPv6 address to use for the created server.\n\n- `public_ipv4_disabled` (bool) - Disable the public ipv6 for the created server.\n\n- `firewalls` (array of strings) - List of Firewall by name or id to be attached\n  to the created server.\n\n## Basic Example\n\nHere is a basic example. It is completely valid as soon as you enter your own\naccess tokens:\n\n```hcl\nsource \"hcloud\" \"basic_example\" {\n  token = \"YOUR API TOKEN\"\n  image = \"ubuntu-22.04\"\n  location = \"nbg1\"\n  server_type = \"cx22\"\n  ssh_username = \"root\"\n}\n\nbuild {\n  sources  = [\"source.hcloud.basic_example\"]\n}\n```\n\nSee the [examples](https://github.com/hetznercloud/packer-plugin-hcloud/tree/main/example) folder in the Packer project for more examples.\n\n## Tips\n\n### Keeping the images size small\n\nTo reduce the size of your images, we recommend cleaning up any temporary files that\nwere added during the build process and discard the unused blocks from the disk.\n\nBelow are a few commands that might useful:\n\n- Clean and reset could-init files:\n\n  ```bash\n  cloud-init clean --logs --machine-id --seed --configs all\n\n  rm -rf /run/cloud-init/*\n  rm -rf /var/lib/cloud/*\n  ```\n\n- Clean apt files:\n\n  ```bash\n  export DEBIAN_FRONTEND=noninteractive\n\n  apt-get -y autopurge\n  apt-get -y clean\n\n  rm -rf /var/lib/apt/lists/*\n  ```\n\n- Clean logs:\n\n  ```bash\n  journalctl --flush\n  journalctl --rotate --vacuum-time=0\n\n  find /var/log -type f -exec truncate --size 0 {} \\; # truncate system logs\n  find /var/log -type f -name '*.[1-9]' -delete # remove archived logs\n  find /var/log -type f -name '*.gz' -delete # remove compressed archived logs\n  ```\n\n- Reset host ssh keys:\n\n  ```bash\n  rm -f /etc/ssh/ssh_host_*_key /etc/ssh/ssh_host_*_key.pub\n  ```\n\nOnce the cleanup is complete, you must discard the now unused blocks from the disk. This can be done with the following:\n\n```bash\ndd if=/dev/zero of=/zero bs=4M || true\nsync\nrm -f /zero\n```\n\nTo speed up the process above, you may configure cloud-init to not grow the system partition to the server disk size during the boot process, leaving you with a 4GB system partition:\n\n```yaml\n#cloud-config\ngrowpart:\n  mode: \"off\"\nresize_rootfs: false\n```\n\nSee the [docker example](https://github.com/hetznercloud/packer-plugin-hcloud/tree/main/example/docker) in the Packer project for more details.\n","created_at":"2024-08-14T11:51:00.784Z","updated_at":"2024-08-14T11:51:00.784Z","name":"Hetzner Cloud","slug":"hcloud","component":{"id":"36076511-3ced-4faf-addf-101fce0405ff","slug":"builder","name":"Builder","plural_name":"Builders","product_id":"4c2b00c6-7cc1-4e4c-b596-4ab57e319f21","created_at":"2022-11-09T22:56:30.937Z","updated_at":"2022-11-09T22:56:30.937Z"},"variable_groups":[]}]},"component":{"id":"70617ec1-150d-4d57-993c-c4653ffeb537","integration_release_id":"6b90fa54-3e72-4036-af5a-bcc03223ab2c","component_id":"36076511-3ced-4faf-addf-101fce0405ff","readme":"Type: `hcloud`\nArtifact BuilderId: `hcloud.builder`\n\nThe `hcloud` Packer builder is able to create new images for use with [Hetzner\nCloud](https://www.hetzner.com/cloud/). The builder takes a source image, runs any\nprovisioning necessary on the image after launching it, then snapshots it into\na reusable image. This reusable image can then be used as the foundation of new\nservers that are launched within the Hetzner Cloud.\n\nThe builder does _not_ manage images. Once it creates an image, it is up to you\nto use it or delete it.\n\n## Connection to the server\n\nThe builder will connect to the server using the first available IP, in the following order:\n\n- `public_ipv4`: If enabled, the public IPv4 will be used,\n- `public_ipv6`: If enabled, the public IPv6 will be used,\n- `private_ipv4`: If the server is attached to private networks, the private IPv4 of the\n  first private network will be used.\n\n## Configuration Reference\n\nThere are many configuration options available for the builder. They are\nsegmented below into two categories: required and optional parameters. Within\neach category, the available configuration keys are alphabetized.\n\nIn addition to the options listed here, a\n[communicator](/packer/docs/templates/legacy_json_templates/communicator) can be configured for this\nbuilder.\n\n### Required Builder Configuration options:\n\n- `token` (string) - The client TOKEN to use to access your account. It can\n  also be specified via environment variable `HCLOUD_TOKEN`, if set.\n\n- `image` (string) - ID or name of image to launch server from. Alternatively\n  you can use `image_filter`.\n\n- `location` (string) - The name of the location to launch the server in.\n\n- `server_type` (string) - ID or name of the server type this server should\n  be created with.\n\n### Optional:\n\n- `endpoint` (string) - Non standard api endpoint URL. Set this if you are\n  using a Hetzner Cloud API compatible service. It can also be specified via\n  environment variable `HCLOUD_ENDPOINT`.\n\n- `image_filter` (object) - Filters used to populate the `filter`\n  field. Example:\n\n  ```hcl\n  image_filter {\n    most_recent   = true\n    with_selector = [\"name==my-image\"]\n  }\n  ```\n\n  This selects the most recent image with the label `name==my-image`. NOTE:\n  This will fail unless _exactly_ one AMI is returned. In the above example,\n  `most_recent` will cause this to succeed by selecting the newest image.\n\n  - `with_selector` (list of strings) - label selectors used to select an\n    `image`. NOTE: This will fail unless _exactly_ one image is returned.\n    Check the official hcloud docs on\n    [Label Selectors](https://docs.hetzner.cloud/#label-selector)\n    for more info.\n\n  - `most_recent` (boolean) - Selects the newest created image when true.\n    This is most useful if you base your image on another Packer build image.\n\n  You may set this in place of `image`, but not both.\n\n- `server_name` (string) - The name assigned to the server. The Hetzner Cloud\n  sets the hostname of the machine to this value.\n\n- `server_labels` (map of key/value strings) - Key/value pair labels to\n  apply to the created server.\n\n- `snapshot_name` (string) - The name of the resulting snapshot that will\n  appear in your account as image description. Defaults to `packer-{{timestamp}}` (see\n  [configuration templates](/packer/docs/templates/legacy_json_templates/engine) for more info).\n  The snapshot_name must be unique per architecture.\n  If you want to reference the image as a sample in your terraform configuration please use the image id or the `snapshot_labels`.\n\n- `snapshot_labels` (map of key/value strings) - Key/value pair labels to\n  apply to the created image.\n\n- `poll_interval` (string) - Configures the interval in which actions are\n  polled by the client. Default `500ms`. Increase this interval if you run\n  into rate limiting errors.\n\n- `user_data` (string) - User data to launch with the server. Packer will not\n  automatically wait for a user script to finish before shutting down the\n  instance this must be handled in a provisioner.\n\n- `user_data_file` (string) - Path to a file that will be used for the user\n  data when launching the server.\n\n- `ssh_keys_labels` (map of key/value strings) - Key/value pair labels to\n  apply to the created ssh keys.\n\n- `ssh_keys` (array of strings) - List of SSH keys by name or id to be added\n  to image on launch.\n\n<!-- Code generated from the comments of the SSHTemporaryKeyPair struct in communicator/config.go; DO NOT EDIT MANUALLY -->\n\n- `temporary_key_pair_type` (string) - `dsa` | `ecdsa` | `ed25519` | `rsa` ( the default )\n  \n  Specifies the type of key to create. The possible values are 'dsa',\n  'ecdsa', 'ed25519', or 'rsa'.\n  \n  NOTE: DSA is deprecated and no longer recognized as secure, please\n  consider other alternatives like RSA or ED25519.\n\n- `temporary_key_pair_bits` (int) - Specifies the number of bits in the key to create. For RSA keys, the\n  minimum size is 1024 bits and the default is 4096 bits. Generally, 3072\n  bits is considered sufficient. DSA keys must be exactly 1024 bits as\n  specified by FIPS 186-2. For ECDSA keys, bits determines the key length\n  by selecting from one of three elliptic curve sizes: 256, 384 or 521\n  bits. Attempting to use bit lengths other than these three values for\n  ECDSA keys will fail. Ed25519 keys have a fixed length and bits will be\n  ignored.\n  \n  NOTE: DSA is deprecated and no longer recognized as secure as specified\n  by FIPS 186-5, please consider other alternatives like RSA or ED25519.\n\n<!-- End of code generated from the comments of the SSHTemporaryKeyPair struct in communicator/config.go; -->\n\n\n- `rescue` (string) - Enable and boot in to the specified rescue system. This\n  enables simple installation of custom operating systems. `linux64` or `linux32`\n\n- `upgrade_server_type` (string) - ID or name of the server type this server should\n  be upgraded to, without changing the disk size. Improves building performance.\n  The resulting snapshot is compatible with smaller server types and disk sizes.\n\n- `networks` (array of integers) - List of Network IDs which should be\n  attached to the server private network interface at creation time.\n\n- `public_ipv4` (string) - ID, name or IP address of a pre-allocated Hetzner\n  Primary IPv4 address to use for the created server.\n\n- `public_ipv4_disabled` (bool) - Disable the public ipv4 for the created server.\n\n- `public_ipv6` (string) - ID, name or IP address of a pre-allocated Hetzner\n  Primary IPv6 address to use for the created server.\n\n- `public_ipv4_disabled` (bool) - Disable the public ipv6 for the created server.\n\n- `firewalls` (array of strings) - List of Firewall by name or id to be attached\n  to the created server.\n\n## Basic Example\n\nHere is a basic example. It is completely valid as soon as you enter your own\naccess tokens:\n\n```hcl\nsource \"hcloud\" \"basic_example\" {\n  token = \"YOUR API TOKEN\"\n  image = \"ubuntu-22.04\"\n  location = \"nbg1\"\n  server_type = \"cx22\"\n  ssh_username = \"root\"\n}\n\nbuild {\n  sources  = [\"source.hcloud.basic_example\"]\n}\n```\n\nSee the [examples](https://github.com/hetznercloud/packer-plugin-hcloud/tree/main/example) folder in the Packer project for more examples.\n\n## Tips\n\n### Keeping the images size small\n\nTo reduce the size of your images, we recommend cleaning up any temporary files that\nwere added during the build process and discard the unused blocks from the disk.\n\nBelow are a few commands that might useful:\n\n- Clean and reset could-init files:\n\n  ```bash\n  cloud-init clean --logs --machine-id --seed --configs all\n\n  rm -rf /run/cloud-init/*\n  rm -rf /var/lib/cloud/*\n  ```\n\n- Clean apt files:\n\n  ```bash\n  export DEBIAN_FRONTEND=noninteractive\n\n  apt-get -y autopurge\n  apt-get -y clean\n\n  rm -rf /var/lib/apt/lists/*\n  ```\n\n- Clean logs:\n\n  ```bash\n  journalctl --flush\n  journalctl --rotate --vacuum-time=0\n\n  find /var/log -type f -exec truncate --size 0 {} \\; # truncate system logs\n  find /var/log -type f -name '*.[1-9]' -delete # remove archived logs\n  find /var/log -type f -name '*.gz' -delete # remove compressed archived logs\n  ```\n\n- Reset host ssh keys:\n\n  ```bash\n  rm -f /etc/ssh/ssh_host_*_key /etc/ssh/ssh_host_*_key.pub\n  ```\n\nOnce the cleanup is complete, you must discard the now unused blocks from the disk. This can be done with the following:\n\n```bash\ndd if=/dev/zero of=/zero bs=4M || true\nsync\nrm -f /zero\n```\n\nTo speed up the process above, you may configure cloud-init to not grow the system partition to the server disk size during the boot process, leaving you with a 4GB system partition:\n\n```yaml\n#cloud-config\ngrowpart:\n  mode: \"off\"\nresize_rootfs: false\n```\n\nSee the [docker example](https://github.com/hetznercloud/packer-plugin-hcloud/tree/main/example/docker) in the Packer project for more details.\n","created_at":"2024-08-14T11:51:00.784Z","updated_at":"2024-08-14T11:51:00.784Z","name":"Hetzner Cloud","slug":"hcloud","component":{"id":"36076511-3ced-4faf-addf-101fce0405ff","slug":"builder","name":"Builder","plural_name":"Builders","product_id":"4c2b00c6-7cc1-4e4c-b596-4ab57e319f21","created_at":"2022-11-09T22:56:30.937Z","updated_at":"2022-11-09T22:56:30.937Z"},"variable_groups":[]},"processedVariablesMarkdown":{},"anchorLinks":[{"id":"connection-to-the-server","level":2,"title":"Connection to the server"},{"id":"configuration-reference","level":2,"title":"Configuration Reference"},{"id":"required-builder-configuration-options:","level":3,"title":"Required Builder Configuration options:"},{"id":"optional:","level":3,"title":"Optional:"},{"id":"basic-example","level":2,"title":"Basic Example"},{"id":"tips","level":2,"title":"Tips"},{"id":"keeping-the-images-size-small","level":3,"title":"Keeping the images size small"}],"serializedREADME":{"compiledSource":"const layoutProps={};const MDXLayout=\"wrapper\";function MDXContent({components,...props}){return mdx(MDXLayout,{...layoutProps,...props,components:components,mdxType:\"MDXLayout\"},mdx(\"p\",{\"className\":\"g-type-long-body\"},`Type: `,mdx(\"inlineCode\",{parentName:\"p\"},`hcloud`),`\nArtifact BuilderId: `,mdx(\"inlineCode\",{parentName:\"p\"},`hcloud.builder`)),mdx(\"p\",{\"className\":\"g-type-long-body\"},`The `,mdx(\"inlineCode\",{parentName:\"p\"},`hcloud`),` Packer builder is able to create new images for use with `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://www.hetzner.com/cloud/\"},`Hetzner\nCloud`),`. The builder takes a source image, runs any\nprovisioning necessary on the image after launching it, then snapshots it into\na reusable image. This reusable image can then be used as the foundation of new\nservers that are launched within the Hetzner Cloud.`),mdx(\"p\",{\"className\":\"g-type-long-body\"},`The builder does `,mdx(\"em\",{parentName:\"p\"},`not`),` manage images. Once it creates an image, it is up to you\nto use it or delete it.`),mdx(\"h2\",{\"id\":\"user-content-connection-to-the-server\",\"data-text-content\":\"Connection to the server\",\"className\":\"g-type-display-3\"},`Connection to the server`),mdx(\"p\",{\"className\":\"g-type-long-body\"},`The builder will connect to the server using the first available IP, in the following order:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`public_ipv4`),`: If enabled, the public IPv4 will be used,`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`public_ipv6`),`: If enabled, the public IPv6 will be used,`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`private_ipv4`),`: If the server is attached to private networks, the private IPv4 of the\nfirst private network will be used.`)),mdx(\"h2\",{\"id\":\"user-content-configuration-reference\",\"data-text-content\":\"Configuration Reference\",\"className\":\"g-type-display-3\"},`Configuration Reference`),mdx(\"p\",{\"className\":\"g-type-long-body\"},`There are many configuration options available for the builder. They are\nsegmented below into two categories: required and optional parameters. Within\neach category, the available configuration keys are alphabetized.`),mdx(\"p\",{\"className\":\"g-type-long-body\"},`In addition to the options listed here, a\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/packer/docs/templates/legacy_json_templates/communicator\"},`communicator`),` can be configured for this\nbuilder.`),mdx(\"h3\",{\"id\":\"user-content-required-builder-configuration-options:\",\"data-text-content\":\"Required Builder Configuration options\",\"className\":\"g-type-display-4\"},`Required Builder Configuration options:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`token`),` (string) - The client TOKEN to use to access your account. It can\nalso be specified via environment variable `,mdx(\"inlineCode\",{parentName:\"p\"},`HCLOUD_TOKEN`),`, if set.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`image`),` (string) - ID or name of image to launch server from. Alternatively\nyou can use `,mdx(\"inlineCode\",{parentName:\"p\"},`image_filter`),`.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`location`),` (string) - The name of the location to launch the server in.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`server_type`),` (string) - ID or name of the server type this server should\nbe created with.`))),mdx(\"h3\",{\"id\":\"user-content-optional:\",\"data-text-content\":\"Optional\",\"className\":\"g-type-display-4\"},`Optional:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`endpoint`),` (string) - Non standard api endpoint URL. Set this if you are\nusing a Hetzner Cloud API compatible service. It can also be specified via\nenvironment variable `,mdx(\"inlineCode\",{parentName:\"p\"},`HCLOUD_ENDPOINT`),`.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`image_filter`),` (object) - Filters used to populate the `,mdx(\"inlineCode\",{parentName:\"p\"},`filter`),`\nfield. Example:`),mdx(\"pre\",{parentName:\"li\"},mdx(\"code\",{parentName:\"pre\"},mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`image_filter`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},` {`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`  most_recent   `),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`=`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-constant)\"}},` true`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`  with_selector `),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`=`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},` [`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},`\"name==my-image\"`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`]`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`}`)),`\n`)),mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},`This selects the most recent image with the label `,mdx(\"inlineCode\",{parentName:\"p\"},`name==my-image`),`. NOTE:\nThis will fail unless `,mdx(\"em\",{parentName:\"p\"},`exactly`),` one AMI is returned. In the above example,\n`,mdx(\"inlineCode\",{parentName:\"p\"},`most_recent`),` will cause this to succeed by selecting the newest image.`),mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`with_selector`),` (list of strings) - label selectors used to select an\n`,mdx(\"inlineCode\",{parentName:\"p\"},`image`),`. NOTE: This will fail unless `,mdx(\"em\",{parentName:\"p\"},`exactly`),` one image is returned.\nCheck the official hcloud docs on\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://docs.hetzner.cloud/#label-selector\"},`Label Selectors`),`\nfor more info.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`most_recent`),` (boolean) - Selects the newest created image when true.\nThis is most useful if you base your image on another Packer build image.`))),mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},`You may set this in place of `,mdx(\"inlineCode\",{parentName:\"p\"},`image`),`, but not both.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`server_name`),` (string) - The name assigned to the server. The Hetzner Cloud\nsets the hostname of the machine to this value.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`server_labels`),` (map of key/value strings) - Key/value pair labels to\napply to the created server.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`snapshot_name`),` (string) - The name of the resulting snapshot that will\nappear in your account as image description. Defaults to `,mdx(\"inlineCode\",{parentName:\"p\"},`packer-{{timestamp}}`),` (see\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/packer/docs/templates/legacy_json_templates/engine\"},`configuration templates`),` for more info).\nThe snapshot_name must be unique per architecture.\nIf you want to reference the image as a sample in your terraform configuration please use the image id or the `,mdx(\"inlineCode\",{parentName:\"p\"},`snapshot_labels`),`.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`snapshot_labels`),` (map of key/value strings) - Key/value pair labels to\napply to the created image.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`poll_interval`),` (string) - Configures the interval in which actions are\npolled by the client. Default `,mdx(\"inlineCode\",{parentName:\"p\"},`500ms`),`. Increase this interval if you run\ninto rate limiting errors.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`user_data`),` (string) - User data to launch with the server. Packer will not\nautomatically wait for a user script to finish before shutting down the\ninstance this must be handled in a provisioner.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`user_data_file`),` (string) - Path to a file that will be used for the user\ndata when launching the server.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`ssh_keys_labels`),` (map of key/value strings) - Key/value pair labels to\napply to the created ssh keys.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`ssh_keys`),` (array of strings) - List of SSH keys by name or id to be added\nto image on launch.`))),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`temporary_key_pair_type`),` (string) - `,mdx(\"inlineCode\",{parentName:\"p\"},`dsa`),` | `,mdx(\"inlineCode\",{parentName:\"p\"},`ecdsa`),` | `,mdx(\"inlineCode\",{parentName:\"p\"},`ed25519`),` | `,mdx(\"inlineCode\",{parentName:\"p\"},`rsa`),` ( the default )`),mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},`Specifies the type of key to create. The possible values are 'dsa',\n'ecdsa', 'ed25519', or 'rsa'.`),mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},`NOTE: DSA is deprecated and no longer recognized as secure, please\nconsider other alternatives like RSA or ED25519.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`temporary_key_pair_bits`),` (int) - Specifies the number of bits in the key to create. For RSA keys, the\nminimum size is 1024 bits and the default is 4096 bits. Generally, 3072\nbits is considered sufficient. DSA keys must be exactly 1024 bits as\nspecified by FIPS 186-2. For ECDSA keys, bits determines the key length\nby selecting from one of three elliptic curve sizes: 256, 384 or 521\nbits. Attempting to use bit lengths other than these three values for\nECDSA keys will fail. Ed25519 keys have a fixed length and bits will be\nignored.`),mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},`NOTE: DSA is deprecated and no longer recognized as secure as specified\nby FIPS 186-5, please consider other alternatives like RSA or ED25519.`))),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`rescue`),` (string) - Enable and boot in to the specified rescue system. This\nenables simple installation of custom operating systems. `,mdx(\"inlineCode\",{parentName:\"p\"},`linux64`),` or `,mdx(\"inlineCode\",{parentName:\"p\"},`linux32`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`upgrade_server_type`),` (string) - ID or name of the server type this server should\nbe upgraded to, without changing the disk size. Improves building performance.\nThe resulting snapshot is compatible with smaller server types and disk sizes.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`networks`),` (array of integers) - List of Network IDs which should be\nattached to the server private network interface at creation time.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`public_ipv4`),` (string) - ID, name or IP address of a pre-allocated Hetzner\nPrimary IPv4 address to use for the created server.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`public_ipv4_disabled`),` (bool) - Disable the public ipv4 for the created server.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`public_ipv6`),` (string) - ID, name or IP address of a pre-allocated Hetzner\nPrimary IPv6 address to use for the created server.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`public_ipv4_disabled`),` (bool) - Disable the public ipv6 for the created server.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},mdx(\"inlineCode\",{parentName:\"p\"},`firewalls`),` (array of strings) - List of Firewall by name or id to be attached\nto the created server.`))),mdx(\"h2\",{\"id\":\"user-content-basic-example\",\"data-text-content\":\"Basic Example\",\"className\":\"g-type-display-3\"},`Basic Example`),mdx(\"p\",{\"className\":\"g-type-long-body\"},`Here is a basic example. It is completely valid as soon as you enter your own\naccess tokens:`),mdx(\"pre\",null,mdx(\"code\",{parentName:\"pre\"},mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`source`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-constant)\"}},` \"hcloud\"`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-constant)\"}},` \"basic_example\"`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},` {`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`  token `),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`=`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` \"YOUR API TOKEN\"`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`  image `),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`=`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` \"ubuntu-22.04\"`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`  location `),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`=`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` \"nbg1\"`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`  server_type `),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`=`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` \"cx22\"`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`  ssh_username `),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`=`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` \"root\"`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`}`)),`\n`,`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`build`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},` {`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`  sources  `),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`=`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},` [`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},`\"source.hcloud.basic_example\"`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`]`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`}`)),`\n`)),mdx(\"p\",{\"className\":\"g-type-long-body\"},`See the `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hetznercloud/packer-plugin-hcloud/tree/main/example\"},`examples`),` folder in the Packer project for more examples.`),mdx(\"h2\",{\"id\":\"user-content-tips\",\"data-text-content\":\"Tips\",\"className\":\"g-type-display-3\"},`Tips`),mdx(\"h3\",{\"id\":\"user-content-keeping-the-images-size-small\",\"data-text-content\":\"Keeping the images size small\",\"className\":\"g-type-display-4\"},`Keeping the images size small`),mdx(\"p\",{\"className\":\"g-type-long-body\"},`To reduce the size of your images, we recommend cleaning up any temporary files that\nwere added during the build process and discard the unused blocks from the disk.`),mdx(\"p\",{\"className\":\"g-type-long-body\"},`Below are a few commands that might useful:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},`Clean and reset could-init files:`),mdx(\"pre\",{parentName:\"li\"},mdx(\"code\",{parentName:\"pre\"},mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`cloud-init`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` clean`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` --logs`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` --machine-id`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` --seed`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` --configs`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` all`)),`\n`,`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`rm`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -rf`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` /run/cloud-init/*`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`rm`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -rf`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` /var/lib/cloud/*`)),`\n`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},`Clean apt files:`),mdx(\"pre\",{parentName:\"li\"},mdx(\"code\",{parentName:\"pre\"},mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`export`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},` DEBIAN_FRONTEND`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`=`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},`noninteractive`)),`\n`,`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`apt-get`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -y`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` autopurge`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`apt-get`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -y`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` clean`)),`\n`,`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`rm`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -rf`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` /var/lib/apt/lists/*`)),`\n`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},`Clean logs:`),mdx(\"pre\",{parentName:\"li\"},mdx(\"code\",{parentName:\"pre\"},mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`journalctl`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` --flush`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`journalctl`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` --rotate`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` --vacuum-time=0`)),`\n`,`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`find`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` /var/log`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -type`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` f`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -exec`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` truncate`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` --size`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-constant)\"}},` 0`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` {}`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-token)\"}},` \\\\; `),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-comment)\"}},`# truncate system logs`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`find`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` /var/log`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -type`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` f`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -name`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` '*.[1-9]'`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -delete`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-comment)\"}},` # remove archived logs`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`find`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` /var/log`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -type`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` f`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -name`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` '*.gz'`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -delete`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-comment)\"}},` # remove compressed archived logs`)),`\n`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\",\"className\":\"g-type-long-body\"},`Reset host ssh keys:`),mdx(\"pre\",{parentName:\"li\"},mdx(\"code\",{parentName:\"pre\"},mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`rm`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -f`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` /etc/ssh/ssh_host_*_key`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` /etc/ssh/ssh_host_*_key.pub`)),`\n`)))),mdx(\"p\",{\"className\":\"g-type-long-body\"},`Once the cleanup is complete, you must discard the now unused blocks from the disk. This can be done with the following:`),mdx(\"pre\",null,mdx(\"code\",{parentName:\"pre\"},mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`dd`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` if=/dev/zero`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` of=/zero`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` bs=4M`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},` ||`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},` true`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`sync`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-function)\"}},`rm`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` -f`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` /zero`)),`\n`)),mdx(\"p\",{\"className\":\"g-type-long-body\"},`To speed up the process above, you may configure cloud-init to not grow the system partition to the server disk size during the boot process, leaving you with a 4GB system partition:`),mdx(\"pre\",null,mdx(\"code\",{parentName:\"pre\"},mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-comment)\"}},`#cloud-config`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`growpart`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`:`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`  mode`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`:`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-string)\"}},` \"off\"`)),`\n`,mdx(\"span\",{parentName:\"code\"},mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`resize_rootfs`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-keyword)\"}},`:`),mdx(\"span\",{parentName:\"span\",\"style\":{\"color\":\"var(--hds-code-block-color-constant)\"}},` false`)),`\n`)),mdx(\"p\",{\"className\":\"g-type-long-body\"},`See the `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hetznercloud/packer-plugin-hcloud/tree/main/example/docker\"},`docker example`),` in the Packer project for more details.`))};MDXContent.isMDXComponent=true;","scope":{}},"breadcrumbLinks":[{"title":"Developer","url":"/"},{"title":"Packer","url":"/packer"},{"title":"Integrations","url":"/packer/integrations"},{"title":"Hetzner Cloud","url":"/packer/integrations/hetznercloud/hcloud","isCurrentPage":false},{"title":"v1.6.0","url":"/packer/integrations/hetznercloud/hcloud/v1.6.0","isCurrentPage":false},{"title":"Components"},{"title":"Builder"},{"title":"Hetzner Cloud","url":"/packer/integrations/hetznercloud/hcloud/latest/components/builder/hcloud","isCurrentPage":true}]},"__N_SSG":true}