<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><title>Ansible Provisioner | Integrations | Packer | HashiCorp Developer</title><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="website"/><meta property="article:publisher" content="https://www.facebook.com/HashiCorp/"/><meta name="twitter:site" content="@HashiCorp"/><meta name="twitter:card" content="summary_large_image"/><meta name="theme-color" content="#000"/><meta name="description" property="og:description" content="Explore Packer product documentation, tutorials, and examples."/><meta name="twitter:description" content="Explore Packer product documentation, tutorials, and examples."/><meta property="og:site_name" content="Ansible Provisioner | Integrations | Packer | HashiCorp Developer"/><meta property="og:title" content="Ansible Provisioner | Integrations | Packer | HashiCorp Developer"/><meta property="og:image" content="https://developer.hashicorp.com/og-image/packer.jpg"/><link rel="canonical" href="https://developer.hashicorp.com/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible"/><link rel="icon" href="/favicon.ico" sizes="any"/><link rel="icon" href="/icon.svg" type="image/svg+xml"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="google-site-verification" content="zRQZqfAsOX-ypXfU0mzAIzb5rUvj5fA4Zw2jWJRN-JI"/><meta name="zd-site-verification" content="xnvnvv1i0wl4tf0pzaymb" data-product="hcp"/><meta name="zd-site-verification" content="36fp2i1pj67d8cjtzf4fi9" data-product="terraform"/><meta name="zd-site-verification" content="nbe87kfyp1sck7b13vj1i" data-product="packer"/><meta name="zd-site-verification" content="wvsmmqa1cfb9am9zlwfj" data-product="consul"/><meta name="zd-site-verification" content="cw22oopfwr68ujj0n5pn9i" data-product="boundary"/><meta name="zd-site-verification" content="lkslvganwfgfqfwpdeicgh" data-product="vault"/><meta name="zd-site-verification" content="jl2wp2hoej9rz6c8rmqdns" data-product="nomad"/><meta name="zd-site-verification" content="2eb0cu6xceo73t0038m0tb" data-product="waypoint"/><meta name="zd-site-verification" content="n52xisxdf3higs2q9kuogd" data-product="vagrant"/><meta name="twitter:image" content="https://developer.hashicorp.com/og-image/packer.jpg"/><link rel="prefetch" href="https://www.datadoghq-browser-agent.com/datadog-rum-v4.js"/><script type="application/ld+json">[{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Developer","item":"https://developer.hashicorp.com/"},{"@type":"ListItem","position":2,"name":"Packer","item":"https://developer.hashicorp.com/packer"},{"@type":"ListItem","position":3,"name":"Integrations","item":"https://developer.hashicorp.com/packer/integrations"},{"@type":"ListItem","position":4,"name":"Ansible","item":"https://developer.hashicorp.com/packer/integrations/hashicorp/ansible"},{"@type":"ListItem","position":5,"name":"v1.1.1","item":"https://developer.hashicorp.com/packer/integrations/hashicorp/ansible/v1.1.1"},{"@type":"ListItem","position":6,"name":"Ansible","item":"https://developer.hashicorp.com/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible"}]}]</script><meta name="next-head-count" content="31"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/hashicorp-vault/_next/static/css/7d6380dc3c2892f0.css" as="style" crossorigin=""/><link rel="stylesheet" href="/hashicorp-vault/_next/static/css/7d6380dc3c2892f0.css" crossorigin="" data-n-g=""/><link rel="preload" href="/hashicorp-vault/_next/static/css/63deaa568623a226.css" as="style" crossorigin=""/><link rel="stylesheet" href="/hashicorp-vault/_next/static/css/63deaa568623a226.css" crossorigin="" data-n-p=""/><link rel="preload" href="/hashicorp-vault/_next/static/css/e6c79edad9f1145a.css" as="style" crossorigin=""/><link rel="stylesheet" href="/hashicorp-vault/_next/static/css/e6c79edad9f1145a.css" crossorigin="" data-n-p=""/><link rel="preload" href="/hashicorp-vault/_next/static/css/5734d1b25a4d4e7f.css" as="style" crossorigin=""/><link rel="stylesheet" href="/hashicorp-vault/_next/static/css/5734d1b25a4d4e7f.css" crossorigin="" data-n-p=""/><link rel="preload" href="/hashicorp-vault/_next/static/css/d84fe9967a765e18.css" as="style" crossorigin=""/><link rel="stylesheet" href="/hashicorp-vault/_next/static/css/d84fe9967a765e18.css" crossorigin="" data-n-p=""/><link rel="preload" href="/hashicorp-vault/_next/static/css/def171e8e14cab7c.css" as="style" crossorigin=""/><link rel="stylesheet" href="/hashicorp-vault/_next/static/css/def171e8e14cab7c.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/hashicorp-vault/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/hashicorp-vault/_next/static/chunks/webpack-0273ed7d7259ded1.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/framework-314c182fa7e2bf37.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/main-73392622e310e33c.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/pages/_app-d64f6e366399db98.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/3262-36f5b0cb83bee60e.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/9547-de090b52af7ba1ea.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/1525-1f498930a8249e9e.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/9873-0473bff1fc3fb810.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/5665-db60618a811e4f85.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/62-c057cd57b8b1ff03.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/6517-fbf40a8ad08e1173.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/1151-988429f2096a886d.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/5044-1418005e37ce10ae.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/5765-a7b4415bf53b3f18.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/9913-f57823d12ca48e78.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/chunks/pages/%5BproductSlug%5D/integrations/%5BorganizationSlug%5D/%5BintegrationSlug%5D/%5BintegrationVersion%5D/components/%5BcomponentType%5D/%5BcomponentSlug%5D-c2b2832a5364f15e.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/V7v-fhXeCmiHNFDH8cxwc/_buildManifest.js" defer="" crossorigin=""></script><script src="/hashicorp-vault/_next/static/V7v-fhXeCmiHNFDH8cxwc/_ssgManifest.js" defer="" crossorigin=""></script></head><body><script>!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement("script");n.type="text/javascript";n.async=!0;n.src="https://artemis.hashicorp.com/script/"+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(n,a);analytics._loadOptions=e};analytics._cdn="https://artemis.hashicorp.com";analytics.SNIPPET_VERSION="4.1.0";}}();</script><div id="__next"><div class="style_root__dZhZu"><a href="https://hashi.co/dev-ai-signup" class="style_linkElem__hCESK"><span class="style_textContainer__6CuI7 g-grid-container"><span class="style_tag__jbHGz g-type-body-small-x-strong">HashiCorp Developer AI<!-- --> </span><span class="style_text__rwS0u g-type-body-small">Private beta now available<span class="style_linkText__E8GJf g-type-body-small-x-strong"> <!-- -->Sign up today</span></span></span></a><button class="style_closeButton__57J9w"><div><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 5L5 15M5 5l10 10" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div><span style="position:absolute;border:0;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;word-wrap:normal">Dismiss alert</span></button></div><script type="text/javascript">
(function checkDismissAlertBanner() {
  try {
    if (document.cookie.includes('banner_private-beta-now-available=1')) {
      const element = document.querySelector('.style_root__dZhZu')
      element.classList.remove('style_isShown__D4mb6')
    }
  } catch (_) {
    // do nothing
  }
})()
</script><script>!function(){try{var d=document.documentElement,n='data-theme',s='setAttribute';var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';d[s](n,'dark')}else{d.style.colorScheme = 'light';d[s](n,'light')}}else if(e){d[s](n,e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="core-dev-dot-layout_root__MT1PZ"><div class="base-layout_root___qiZs" data-layout="base-new"><div class="base-layout_header__XhkxS"><header class="navigation-header_root__oE_HT"><div class="navigation-header_leftSide__V0xlc"><div class="product-page-content_productsDropdown__haUyw"><div class="dropdown-menu_root__Hwy5S"><div class="dropdown-menu_activatorWrapper__LxPRt"><button aria-controls="navigation-header-menu-react-aria-1" aria-expanded="false" aria-label="Main menu" class="dropdown-menu_activator__xXb00 g-focus-ring-from-box-shadow-dark product-page-content_productsDropdownButton__bnKKs" data-heap-track="navigation-header-dropdown-menu-activator"><span class="dropdown-menu_activatorLeadingIcon__YQQlH"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-hidden="true" class="product-page-content_productsDropdownIcon__gXtly"><g fill="currentColor"><path d="M10.336 1.5L2 6.268v11.456l3.131 1.793V8.061l5.205-2.979V1.5z"></path><path d="M13.664 1.5v9.123h-3.328V7.219L7.203 9.012V20.7l3.133 1.796V13.4h3.328v3.381l3.131-1.793V3.293L13.664 1.5z"></path><path d="M22 17.732L13.664 22.5v-3.582l5.203-2.98V4.484L22 6.276v11.456z"></path></g></svg></span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="dropdown-menu_activatorTrailingIcon__r_cCd"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></button></div><div class="dropdown-menu_dropdownContainer__AZWxN product-page-content_productsDropdownPane__bcdWz" id="navigation-header-menu-react-aria-1" style="display:none"><ul class="dropdown-menu_itemGroup__GEq4r"><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" href="/hashicorp-vault"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M7.846 2.574a.25.25 0 01.308 0l5.25 4.12a.25.25 0 01.096.196v7.36a.75.75 0 001.5 0V6.89a1.75 1.75 0 00-.67-1.377L9.08 1.394a1.75 1.75 0 00-2.16 0l-5.25 4.12A1.75 1.75 0 001 6.89v7.36a.75.75 0 001.5 0V6.89a.25.25 0 01.096-.196l5.25-4.12z"></path><path d="M6.5 14.25V10.5h3v3.75a.75.75 0 001.5 0v-4C11 9.56 10.44 9 9.75 9h-3.5C5.56 9 5 9.56 5 10.25v4a.75.75 0 001.5 0z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">HashiCorp Developer</span></div></div></a></li></ul><hr class="dropdown-menu_itemGroupDivider__X38aR"/><ul class="dropdown-menu_itemGroup__GEq4r"><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" href="/hashicorp-vault/hcp"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M6.835.6L1 3.96v8.074l2.192 1.264V5.224l3.643-2.1V.6z"></path><path d="M9.165.6v6.43h-2.33v-2.4L4.642 5.894v8.237l2.193 1.266v-6.41h2.33v2.383l2.192-1.264V1.864L9.165.6z"></path><path d="M15 12.04L9.165 15.4v-2.525l3.642-2.1V2.703L15 3.966v8.073z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">HashiCorp Cloud Platform</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" href="/hashicorp-vault/terraform"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-terraform-brand)"><path d="M1 0v5.05l4.349 2.527V2.526L1 0zM10.175 5.344l-4.35-2.525v5.05l4.35 2.527V5.344zM10.651 10.396V5.344L15 2.819v5.05l-4.349 2.527zM10.174 16l-4.349-2.526v-5.05l4.349 2.525V16z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Terraform</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" href="/hashicorp-vault/packer"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-packer-brand)"><path d="M5.163 0l5.762 3.247c1.138.646 2.074 2.085 2.075 3.2v4.963c0 1.123-.933 1.502-2.074.858L9.083 11.23V4.469l-3.92-2.216V0z"></path><path d="M8.3 4.953L3 1.956v11.047L8.3 16V4.953z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Packer</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" href="/hashicorp-vault/consul"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-consul-brand)"><path d="M4.737 14.193A7 7 0 008.006 15a6.98 6.98 0 004.735-1.847l-1.66-1.737a4.6 4.6 0 110-6.828l1.66-1.738a7 7 0 10-8.004 11.343zM13.32 11.402a.573.573 0 10.637-.953.573.573 0 00-.637.953z"></path><path d="M7.96 9.517a1.517 1.517 0 11-.012-3.034 1.517 1.517 0 01.013 3.034zM13.978 9.447a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 9.472a.574.574 0 110-1.148.574.574 0 010 1.148zM13.978 7.514a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 7.675a.574.574 0 110-1.148.574.574 0 010 1.148zM13.353 5.585a.574.574 0 10.635-.956.574.574 0 00-.635.956z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Consul</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" href="/hashicorp-vault/vault"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="var(--token-color-vault-brand)" d="M0 0l7.971 15.516L16 0H0zm6.732 6.16h-1.27V4.89h1.27v1.27zm0-1.906h-1.27V2.985h1.27v1.269zm1.904 3.81h-1.27v-1.27h1.27v1.27zm0-1.905h-1.27V4.89h1.27v1.27zm0-1.905h-1.27V2.985h1.27v1.269zm1.894 1.905H9.26V4.89h1.27v1.27zM9.26 4.254V2.985h1.27v1.269H9.26z"></path></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Vault</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" href="/hashicorp-vault/boundary"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-boundary-brand)"><path d="M4.81 15v-1.085h2.25v-.67H5.968v-1.093h5.149L8.726 8l2.392-4.154H5.84v5.76H3V1h9.775l1.631 2.832L12.006 8l2.448 4.252L12.872 15H4.81z"></path><path d="M5.248 12.152h-1.09v1.092h1.09v-1.092zM3 13.907h1.09v1.092H3v-1.092z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Boundary</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" href="/hashicorp-vault/nomad"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="var(--token-color-nomad-brand)" d="M8 0L1 4v8l7 4 7-4V4L8 0zm3.119 8.797L9.254 9.863 7.001 8.65v2.549l-2.118 1.33v-5.33l1.68-1.018 2.332 1.216V4.794l2.23-1.322-.006 5.325z"></path></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Nomad</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" href="/hashicorp-vault/waypoint"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-waypoint-brand)"><path d="M4 5.312h1.334L10 13.4l3.334-5.777L10.666 3H8l2.666 4.623L10 8.778 6.667 3H0l6 10.4 1.333-2.31L4 5.311zM14.002 6.463L16 3h-3.996l1.998 3.463z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Waypoint</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" href="/hashicorp-vault/vagrant"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="#1868F2" d="M13.08.75L9.924 2.58v1.123L8 8.245 6.076 3.703V2.58L2.92.75 1 1.864v1.293l4.276 10.514L8 15.25l2.724-1.579L15 3.157V1.864L13.08.75z"></path><path fill="#0850C5" d="M15 1.865l-3.157 1.829v1.124L9.28 10.57 8 11.312v3.939l2.724-1.579L15 3.158V1.865zM6.076 3.703V2.58l-1.92 1.113v1.125l2.564 5.751L8 9.827V8.245L6.076 3.703z"></path></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Vagrant</span></div></div></a></li></ul></div></div></div><div class="product-page-content_productLinkAndNav__YTzcr"><a aria-label="Packer home" class="product-icon-text-link_root__bNTSz g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-product-logo-link" href="/hashicorp-vault/packer"><div class="product-icon-text-lockup_root__358wV"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="product-icon-text-lockup_icon__Zp_5o"><g fill="var(--token-color-packer-brand)"><path d="M5.163 0l5.762 3.247c1.138.646 2.074 2.085 2.075 3.2v4.963c0 1.123-.933 1.502-2.074.858L9.083 11.23V4.469l-3.92-2.216V0z"></path><path d="M8.3 4.953L3 1.956v11.047L8.3 16V4.953z"></path></g></svg><span class="product-icon-text-lockup_text__nHTL7 hds-typography-body-200">Packer</span></div></a><nav class="nav-bar-list-container_nav__C_i0_"><ul class="nav-bar-list-container_ul___04HI"><li><a aria-label="Packer Install" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" href="/hashicorp-vault/packer/install"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">Install</span></a></li><li><a aria-label="Packer Tutorials" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" href="/hashicorp-vault/packer/tutorials"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">Tutorials</span></a></li><li><a aria-label="Packer Documentation" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" href="/hashicorp-vault/packer/docs"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">Documentation</span></a></li><li><a aria-label="Packer Guides" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" href="/hashicorp-vault/packer/guides"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">Guides</span></a></li><li><a aria-label="Packer Integrations" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" href="/hashicorp-vault/packer/integrations"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">Integrations</span></a></li><li><a aria-label="Packer Try Cloud" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" aria-describedby="undefinedopens-in-new-tab-label-react-aria-18" target="_blank" href="https://portal.cloud.hashicorp.com/sign-up"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">Try Cloud</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M9 .75A.75.75 0 019.75 0h4.5c.206 0 .393.083.529.218l.001.002.002.001A.748.748 0 0115 .75v4.5a.75.75 0 01-1.5 0V2.56L7.28 8.78a.75.75 0 01-1.06-1.06l6.22-6.22H9.75A.75.75 0 019 .75z"></path><path d="M3.25 3.5a.75.75 0 00-.75.75v7.5c0 .414.336.75.75.75h7.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0110.75 14h-7.5A2.25 2.25 0 011 11.75v-7.5A2.25 2.25 0 013.25 2h4a.75.75 0 010 1.5h-4z"></path></g></svg></a><span class="g-screen-reader-only" id="opens-in-new-tab-label-react-aria-18">(opens in new tab)</span></li></ul></nav></div></div><div class="navigation-header_rightSide___Vvh_"><button aria-label="Search" class="command-bar-activator_root__qgVMy g-focus-ring-from-box-shadow-dark"><span class="command-bar-activator_left__ATQTg"><span class="command-bar-activator_leadingIcon__jECP5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M7.25 2a5.25 5.25 0 103.144 9.455l2.326 2.325a.75.75 0 101.06-1.06l-2.325-2.326A5.25 5.25 0 007.25 2zM3.5 7.25a3.75 3.75 0 117.5 0 3.75 3.75 0 01-7.5 0z" clip-rule="evenodd"></path></svg></span><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular command-bar-activator_text__pTZN_">Search</span></span><span class="command-bar-activator_right__XejfJ"><span class="g-screen-reader-only">Command or control key</span><span aria-hidden="true" class="badge_root___Z7Nt badge_small__GI0Zk badge_filled-neutral-dark-mode__VC3Ba command-bar-activator_keyBadge__xnKpi"><div class="cmd-ctrl-icon_root___TToz"><svg width="41" height="11" viewBox="0 0 41 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.125 2.063V3h2.25v-.938a2.062 2.062 0 112.063 2.063H7.5v2.25h.938a2.062 2.062 0 11-2.063 2.063V7.5h-2.25v.938a2.062 2.062 0 11-2.063-2.063H3v-2.25h-.938a2.062 2.062 0 112.063-2.063zm-2.063-.938a.937.937 0 100 1.875H3v-.938a.937.937 0 00-.938-.937zM7.5 7.5v.938a.937.937 0 10.938-.938H7.5zM6.375 6.375v-2.25h-2.25v2.25h2.25zM2.062 7.5H3v.938a.937.937 0 11-.938-.938zM7.5 3h.938a.937.937 0 10-.938-.938V3z" fill="#fff"/><path d="M15.09 10.5L18.085 0h-1.097L14 10.5h1.09zm11.297-5.192c-.183-1.445-1.263-2.534-3.05-2.534C21.264 2.774 20 4.247 20 6.61c0 2.41 1.27 3.89 3.344 3.89 1.76 0 2.86-1.034 3.043-2.5H25.02c-.184.808-.792 1.247-1.682 1.247-1.172 0-1.898-.994-1.898-2.637 0-1.61.72-2.583 1.898-2.583.942 0 1.518.555 1.681 1.281h1.368zM28.6 1.041v1.897h-1.133v1.178H28.6v4.281c0 1.432.622 2.007 2.186 2.007.275 0 .537-.034.766-.075V9.158c-.196.02-.32.034-.537.034-.7 0-1.008-.35-1.008-1.15V4.115h1.545V2.938h-1.545V1.041H28.6zm4.607 9.315h1.407V5.911c0-1.048.752-1.767 1.819-1.767.249 0 .667.048.785.082V2.842a3.372 3.372 0 00-.628-.054c-.93 0-1.721.527-1.924 1.26h-.105v-1.13h-1.354v7.438zm5.431 0h1.407V0h-1.407v10.356z" fill="#fff"/></svg></div></span><span class="g-screen-reader-only">K key</span><span aria-hidden="true" class="badge_root___Z7Nt badge_small__GI0Zk badge_filled-neutral-dark-mode__VC3Ba command-bar-activator_keyBadge__xnKpi"><div class="k-icon_root__a_5pR"><svg width="8" height="10" viewBox="0 0 8 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.512 9.84v-3l.986-1.147L5.445 9.84h1.704L3.46 4.745 6.857.84H5.244L1.61 5.094h-.098V.84H.15v9h1.363z" fill="#fff"/></svg></div></span></span></button><div class="navigation-header_authenticationControls__EP1LY"><div class="disclosure_root__rcBaW dropdown-disclosure_root__pzZlN dropdown-disclosure_list-position--right__WP_Kj"><button aria-controls="disclosure-react-aria-19-content" aria-expanded="false" aria-label="User menu" class="disclosure_activator__pORI0 activator_root__pOfAQ dropdown-disclosure_activator__nGgNo navigation-header_userDropdownDisclosureActivator__RayIV g-focus-ring-from-box-shadow-dark activator_hasIcon__5HO6W g-focus-ring-from-box-shadow"><span class="activator_childrenWrapper__kaK0w"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-hidden="true"><g fill="currentColor"><path fill-rule="evenodd" d="M12 3a5 5 0 100 10 5 5 0 000-10zM8.5 8a3.5 3.5 0 117 0 3.5 3.5 0 01-7 0z" clip-rule="evenodd"></path><path d="M7.75 14.5A4.75 4.75 0 003 19.25v1a.75.75 0 001.5 0v-1A3.25 3.25 0 017.75 16h8.5a3.25 3.25 0 013.25 3.25v1a.75.75 0 001.5 0v-1a4.75 4.75 0 00-4.75-4.75h-8.5z"></path></g></svg></span><span class="activator_chevronWrapper__4_AVG"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></span></button><div class="disclosure_contentContainer__QQ4kt dropdown-disclosure_content__ZZRPG undefined" id="disclosure-react-aria-19-content"><ul class="dropdown-disclosure_list__urBXU"><li class="list-item_root__ZdUej"><button class="list-item_button__nXy5K g-focus-ring-from-box-shadow"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium">Sign in</span></button></li><li class="list-item_root__ZdUej"><a class="list-item_link__l6lDd g-focus-ring-from-box-shadow" href="/hashicorp-vault/sign-up"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium">Sign up</span></a></li><li class="list-item_root__ZdUej"><hr class="list-item_separator__cBVLs"/></li><li class="list-item_root__ZdUej user-dropdown-switcher_listItem__Q_GIj hds-font-weight-medium"><label class="theme-switcher_label__7Boh2 hds-typography-body-200" for="react-aria-21">Theme</label></li></ul></div></div></div><button aria-label="Open navigation menu" class="navigation-header_mobileMenuButton__74S4w"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-hidden="true"><g fill="currentColor"><path d="M2 5.75A.75.75 0 012.75 5h18.5a.75.75 0 010 1.5H2.75A.75.75 0 012 5.75zM2 11.75a.75.75 0 01.75-.75h18.5a.75.75 0 010 1.5H2.75a.75.75 0 01-.75-.75zM2.75 17a.75.75 0 000 1.5h18.5a.75.75 0 000-1.5H2.75z"></path></g></svg></button></div></header></div><div class="base-layout_contentArea__BMvQn"><div class="sidebar-sidecar-layout_root__h5rD8 sidebar-sidecar-layout_mainWidth-wide__TwGq8"><div class="mobile-menu-container_root__fPUFu sidebar-sidecar-layout_sidebarContainer__4fcF8"><div class="sidebar-sidecar-layout_sidebarContentWrapper__ftn5q"><div class="sidebar_sidebar___fTlC"><div class="sidebar_backToLinkWrapper__F6iLs"><div class="sidebar-back-to-link_root__z_Hj1"><a class="standalone-link_standaloneLink__ahuej g-focus-ring-from-box-shadow standalone-link_primary__ESNCA" data-heap-track="standalone-link sidebar-back-to-link" href="/hashicorp-vault/packer/integrations"><div class="standalone-link_standaloneLinkContents__4I2XN standalone-link_medium__J2yVM"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M10.795 3.235a.75.75 0 01-.03 1.06L6.842 8l3.923 3.705a.75.75 0 01-1.03 1.09l-4.5-4.25a.75.75 0 010-1.09l4.5-4.25a.75.75 0 011.06.03z" clip-rule="evenodd"></path></svg><span class="standalone-link_text__7GEyG">Packer Integrations</span></div></a></div></div><nav aria-labelledby="sidebar-label" class="sidebar_nav__IworY" id="sidebar-nav"><div><h2 class="sidebar-headings_root__tGfxC" id="sidebar-label"></h2></div><ul class="sidebar_navList__4Rg4g"><li><a class="sidebar-nav-highlight-item_root___pPhp g-focus-ring-from-box-shadow sidebar-nav-highlight-item_theme-packer__I5KHY" href="/hashicorp-vault/packer/integrations/hashicorp/ansible"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="sidebar-nav-highlight-item_icon__G8JxG"><g fill="var(--token-color-packer-brand)"><path d="M5.163 0l5.762 3.247c1.138.646 2.074 2.085 2.075 3.2v4.963c0 1.123-.933 1.502-2.074.858L9.083 11.23V4.469l-3.92-2.216V0z"></path><path d="M8.3 4.953L3 1.956v11.047L8.3 16V4.953z"></path></g></svg><span class="sidebar-nav-highlight-item_text__VORFJ hds-typography-body-200">Ansible</span></a></li><li><button aria-controls="undefined-list" aria-expanded="true" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="undefined-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Provisioners</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button><ul id="undefined-list"><li><a class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible-local"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Ansible Local</span></a></li><li><a aria-current="page" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Ansible</span></a></li></ul></li></ul><hr class="sidebar-horizontal-rule_root__UY7oh"/><ul class="sidebar_navList__4Rg4g"><li><h3 class="sidebar-headings_root__tGfxC">Resources</h3></li><li><a class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" href="/hashicorp-vault/tutorials/library?product=packer"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Tutorial Library</span></a></li><li><a aria-label="Community Forum. Opens in a new tab." class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" rel="noreferrer noopener" aria-describedby="undefinedopens-in-new-tab-label-react-aria-27" target="_blank" href="https://discuss.hashicorp.com/c/packer/23"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Community Forum</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M9 .75A.75.75 0 019.75 0h4.5c.206 0 .393.083.529.218l.001.002.002.001A.748.748 0 0115 .75v4.5a.75.75 0 01-1.5 0V2.56L7.28 8.78a.75.75 0 01-1.06-1.06l6.22-6.22H9.75A.75.75 0 019 .75z"></path><path d="M3.25 3.5a.75.75 0 00-.75.75v7.5c0 .414.336.75.75.75h7.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0110.75 14h-7.5A2.25 2.25 0 011 11.75v-7.5A2.25 2.25 0 013.25 2h4a.75.75 0 010 1.5h-4z"></path></g></svg></div></a><span class="g-screen-reader-only" id="opens-in-new-tab-label-react-aria-27">(opens in new tab)</span></li><li><a aria-label="Support. Opens in a new tab." class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" rel="noreferrer noopener" aria-describedby="undefinedopens-in-new-tab-label-react-aria-28" target="_blank" href="https://www.hashicorp.com/customer-success"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Support</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M9 .75A.75.75 0 019.75 0h4.5c.206 0 .393.083.529.218l.001.002.002.001A.748.748 0 0115 .75v4.5a.75.75 0 01-1.5 0V2.56L7.28 8.78a.75.75 0 01-1.06-1.06l6.22-6.22H9.75A.75.75 0 019 .75z"></path><path d="M3.25 3.5a.75.75 0 00-.75.75v7.5c0 .414.336.75.75.75h7.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0110.75 14h-7.5A2.25 2.25 0 011 11.75v-7.5A2.25 2.25 0 013.25 2h4a.75.75 0 010 1.5h-4z"></path></g></svg></div></a><span class="g-screen-reader-only" id="opens-in-new-tab-label-react-aria-28">(opens in new tab)</span></li><li><a aria-label="GitHub. Opens in a new tab." class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" rel="noreferrer noopener" aria-describedby="undefinedopens-in-new-tab-label-react-aria-29" target="_blank" href="https://github.com/hashicorp/packer"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">GitHub</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M9 .75A.75.75 0 019.75 0h4.5c.206 0 .393.083.529.218l.001.002.002.001A.748.748 0 0115 .75v4.5a.75.75 0 01-1.5 0V2.56L7.28 8.78a.75.75 0 01-1.06-1.06l6.22-6.22H9.75A.75.75 0 019 .75z"></path><path d="M3.25 3.5a.75.75 0 00-.75.75v7.5c0 .414.336.75.75.75h7.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0110.75 14h-7.5A2.25 2.25 0 011 11.75v-7.5A2.25 2.25 0 013.25 2h4a.75.75 0 010 1.5h-4z"></path></g></svg></div></a><span class="g-screen-reader-only" id="opens-in-new-tab-label-react-aria-29">(opens in new tab)</span></li></ul></nav></div></div></div><div class="sidebar-sidecar-layout_contentWrapper__Z5BK4"><div class="sidebar-sidecar-layout_paddedAreaWrapper___S_Ff"><div class="sidebar-sidecar-layout_breadcrumbContainer__3uz7P"><div class="sidebar-sidecar-layout_breadcrumbMaxWidth__coOcu"><nav aria-label="Breadcrumb" class="breadcrumb-bar_root__wd_C5"><ol class="breadcrumb-bar_listRoot__8eupO"><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><a class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" data-heap-track="breadcrumb-bar-item" href="/hashicorp-vault">Developer</a></li><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><a class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" data-heap-track="breadcrumb-bar-item" href="/hashicorp-vault/packer">Packer</a></li><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><a class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" data-heap-track="breadcrumb-bar-item" href="/hashicorp-vault/packer/integrations">Integrations</a></li><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><a class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" data-heap-track="breadcrumb-bar-item" href="/hashicorp-vault/packer/integrations/hashicorp/ansible">Ansible</a></li><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><a class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" data-heap-track="breadcrumb-bar-item" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/v1.1.1">v1.1.1</a></li><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><span class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" data-heap-track="breadcrumb-bar-item">Components</span></li><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><span class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" data-heap-track="breadcrumb-bar-item">Provisioner</span></li><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><span class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" aria-current="page" data-heap-track="breadcrumb-bar-item">Ansible</span></li></ol></nav></div></div><div class="sidebar-sidecar-layout_mainAndSidecar__UDm3Z"><main id="main" class="sidebar-sidecar-layout_main__0SN51"><div class="hds-surface-base card_root__RyqjV content-header-card_contentHeaderCard__SDMMP style_header__b3NdM"><div class="content-header-card_cardTop__GTpii"><span class="icon-tile_root__ShC0s icon-tile_size-large__NxGIv icon-tile_color-packer__LRaQF content-header-card_icon__A1Xna"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-packer-brand)"><path d="M5.163 0l5.762 3.247c1.138.646 2.074 2.085 2.075 3.2v4.963c0 1.123-.933 1.502-2.074.858L9.083 11.23V4.469l-3.92-2.216V0z"></path><path d="M8.3 4.953L3 1.956v11.047L8.3 16V4.953z"></path></g></svg></span><div class="content-header-card_content__XPCtf"><div class="content-header-card_upper__PQsUG"><div class="disclosure_root__rcBaW dropdown-disclosure_root__pzZlN dropdown-disclosure_list-position--right__WP_Kj content-header-card_dropdown__Gt1Vp g-hide-on-desktop g-hide-on-tablet"><button aria-controls="disclosure-react-aria-35-content" aria-expanded="false" class="button_root__itF9E hds-font-weight-medium button_medium__Cm2eg button_secondary__m5f7i disclosure_activator__pORI0 activator_root__pOfAQ dropdown-disclosure_activator__nGgNo" data-heap-track="button " type="button"><span>v1.1.1 (latest)</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="activator_chevronWrapper__4_AVG"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></button><div class="disclosure_contentContainer__QQ4kt dropdown-disclosure_content__ZZRPG undefined" id="disclosure-react-aria-35-content"><ul class="dropdown-disclosure_list__urBXU"><li class="list-item_root__ZdUej"><a class="list-item_link__l6lDd g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/v1.1.0/components/provisioner/ansible"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium">v1.1.0</span></a></li><li class="list-item_root__ZdUej"><a class="list-item_link__l6lDd g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/v0.0.1/components/provisioner/ansible"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium">v0.0.1</span></a></li></ul></div></div><div class="content-header-card_left__FSNcW"><div class="content-header-card_titleWrap__IAC6o"><span class="content-header-card_title__HGHfo hds-typography-display-300 from global, hds-font-weight-bold">Ansible</span><p class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium content-header-card_attribution__yKU4q">@hashicorp</p></div><p class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular content-header-card_description__M_DkB">The Ansible plugin allows users to execute as a provisioner during a Packer build.</p></div><div class="disclosure_root__rcBaW dropdown-disclosure_root__pzZlN dropdown-disclosure_list-position--right__WP_Kj content-header-card_dropdown__Gt1Vp g-hide-on-mobile"><button aria-controls="disclosure-react-aria-38-content" aria-expanded="false" class="button_root__itF9E hds-font-weight-medium button_medium__Cm2eg button_secondary__m5f7i disclosure_activator__pORI0 activator_root__pOfAQ dropdown-disclosure_activator__nGgNo" data-heap-track="button " type="button"><span>v1.1.1 (latest)</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="activator_chevronWrapper__4_AVG"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></button><div class="disclosure_contentContainer__QQ4kt dropdown-disclosure_content__ZZRPG undefined" id="disclosure-react-aria-38-content"><ul class="dropdown-disclosure_list__urBXU"><li class="list-item_root__ZdUej"><a class="list-item_link__l6lDd g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/v1.1.0/components/provisioner/ansible"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium">v1.1.0</span></a></li><li class="list-item_root__ZdUej"><a class="list-item_link__l6lDd g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/v0.0.1/components/provisioner/ansible"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium">v0.0.1</span></a></li></ul></div></div></div><div class="content-header-card_lower__ut_Dv"><ul class="badge-list_badgeList__l_z6s content-header-card_badgeList__I_FGK"><li class="badge-list_badge__mQSlF"><span data-state="tooltip-hidden" data-reach-tooltip-trigger=""><span class="g-screen-reader-only">Official</span><span aria-hidden="true" class="badge_root___Z7Nt badge_small__GI0Zk badge_filled-neutral__NhUW0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M6.835.6L1 3.96v8.074l2.192 1.264V5.224l3.643-2.1V.6z"></path><path d="M9.165.6v6.43h-2.33v-2.4L4.642 5.894v8.237l2.193 1.266v-6.41h2.33v2.383l2.192-1.264V1.864L9.165.6z"></path><path d="M15 12.04L9.165 15.4v-2.525l3.642-2.1V2.703L15 3.966v8.073z"></path></g></svg><span>Official</span></span></span></li></ul><p class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular content-header-card_note__QTtmc">Updated 8 months ago</p></div></div></div><div class="content-header-card_cardBottom__ndKDE"><ul class="content-header-card_linksList__vaxQ3"><li class="content-header-card_link___8sUH"><a class="standalone-link_standaloneLink__ahuej g-focus-ring-from-box-shadow standalone-link_secondary__H0E0A" data-heap-track="standalone-link " rel="noreferrer noopener" aria-describedby="undefinedopens-in-new-tab-label-react-aria-41" target="_blank" href="https://github.com/hashicorp/packer-plugin-ansible/tree/main/docs"><div class="standalone-link_standaloneLinkContents__4I2XN standalone-link_medium__J2yVM"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M8 1C4.133 1 1 4.13 1 7.993c0 3.09 2.006 5.71 4.787 6.635.35.064.478-.152.478-.337 0-.166-.006-.606-.01-1.19-1.947.423-2.357-.937-2.357-.937-.319-.808-.778-1.023-.778-1.023-.635-.434.048-.425.048-.425.703.05 1.073.72 1.073.72.624 1.07 1.638.76 2.037.582.063-.452.244-.76.444-.935-1.554-.176-3.188-.776-3.188-3.456 0-.763.273-1.388.72-1.876-.072-.177-.312-.888.07-1.85 0 0 .586-.189 1.924.716A6.711 6.711 0 018 4.381c.595.003 1.194.08 1.753.236 1.336-.905 1.923-.717 1.923-.717.382.963.142 1.674.07 1.85.448.49.72 1.114.72 1.877 0 2.686-1.638 3.278-3.197 3.45.251.216.475.643.475 1.296 0 .934-.009 1.688-.009 1.918 0 .187.127.404.482.336A6.996 6.996 0 0015 7.993 6.997 6.997 0 008 1z" clip-rule="evenodd"></path></svg><span class="standalone-link_text__7GEyG">GitHub</span></div></a><span class="g-screen-reader-only" id="opens-in-new-tab-label-react-aria-41">(opens in new tab)</span></li></ul></div></div><h1>Ansible</h1><div class="style_integrationComponentView__dxO7C"><div class="style_mdxWrapper__6wQJC"><div class="dev-dot-content_root__UJDct hds-typography-body-300"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Type: <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible</code></p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible</code> Packer provisioner runs Ansible playbooks. It dynamically creates
an Ansible inventory file configured to use SSH, runs an SSH server, executes
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible-playbook</code>, and marshals Ansible plays through the SSH server to the
machine being provisioned by Packer.</p><div class="alert alert-info g-type-body"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>Note:</strong> Any <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">remote_user</code> defined in tasks will be ignored. Packer
will always connect with the user given in the json config for this
provisioner.</p></div><div class="alert alert-info g-type-body"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>Note:</strong> Options below that use the Packer template engine won&#x27;t be able to
accept jinja2 <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">{{ function }}</code> macro syntax in a way that can be preserved to
the Ansible run. If you need to set variables using Ansible macros, you need to
do so inside your playbooks or inventory files.</p></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Please see the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#debugging">Debugging</a>, <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#limitations">Limitations</a>, or <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#troubleshooting">Troubleshooting</a> if you are having trouble
getting started.</p><h2 class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_" id="user-content-basic-example"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="Basic Example permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#basic-example"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Basic Example</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This is a fully functional template that will provision an image on
DigitalOcean. Replace the mock <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">api_token</code> value with your own.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Example Packer template:</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>HCL2</strong></p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">source <span class="token string">&quot;digitalocean&quot;</span> <span class="token string">&quot;example&quot;</span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">api_token</span> <span class="token punctuation">=</span> <span class="token string">&quot;6a561151587389c7cf8faa2d83e94150a4202da0e2bad34dd2bf236018ffaeeb&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">image</span>     <span class="token punctuation">=</span> <span class="token string">&quot;ubuntu-20-04-x64&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">region</span>    <span class="token punctuation">=</span> <span class="token string">&quot;sfo1&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">build</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">sources</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;source.digitalocean.example&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token keyword">provisioner<span class="token type variable"> &quot;ansible&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">playbook_file</span> <span class="token punctuation">=</span> <span class="token string">&quot;./playbook.yml&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>JSON</strong></p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;builders&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;digitalocean&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;api_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6a561151587389c7cf8faa2d83e94150a4202da0e2bad34dd2bf236018ffaeeb&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ubuntu-20-04-x64&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;region&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sfo1&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;provisioners&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ansible&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;playbook_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./playbook.yml&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Example playbook:</p><div class="g-code-block style_root__i1k0c language-yaml mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-yaml mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-yaml mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">---</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token comment"># playbook.yml</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#x27;Provision Image&#x27;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> default<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token key atrule">become</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install Apache<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token key atrule">package</span><span class="token punctuation">:</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#x27;httpd&#x27;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token key atrule">state</span><span class="token punctuation">:</span> present<!-- -->
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><h2 class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_" id="user-content-configuration-reference"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="Configuration Reference permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#configuration-reference"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Configuration Reference</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Required Parameters:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">playbook_file</code> (string) - The playbook to be run by Ansible.</li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Optional Parameters:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">command</code> (string) - The command to invoke ansible. Defaults to
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible-playbook</code>. If you would like to provide a more complex command,
for example, something that sets up a virtual environment before calling
ansible, take a look at the ansible wrapper guide below for inspiration.
Please note that Packer expects Command to be a path to an executable.
Arbitrary bash scripting will not work and needs to go inside an
executable script.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">extra_arguments</code> ([]string) - Extra arguments to pass to Ansible. These arguments <em>will not</em> be passed
through a shell and arguments should not be quoted. Usage example:</p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">   <span class="token property">&quot;extra_arguments&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;--extra-vars&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Region={{user `Region`}} Stage={{user `Stage`}}&quot;</span> <span class="token punctuation">]</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In certain scenarios where you want to pass ansible command line
arguments that include parameter and value (for example
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">--vault-password-file pwfile</code>), from ansible documentation this is
correct format but that is NOT accepted here. Instead you need to do it
like <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">--vault-password-file=pwfile</code>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If you are running a Windows build on AWS, Azure, Google Compute, or
OpenStack and would like to access the auto-generated password that
Packer uses to connect to a Windows instance via WinRM, you can use the
template variable</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">build.Password</code> in HCL templates or <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">{{ build `Password`}}</code> in
legacy JSON templates. For example:</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">in JSON templates:</p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">&quot;extra_arguments&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">   <span class="token string">&quot;--extra-vars&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;winrm_password={{ build `Password`}}&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">]</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">in HCL templates:</p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">extra_arguments</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">   <span class="token string">&quot;--extra-vars&quot;</span>, <span class="token string">&quot;winrm_password=<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>build<span class="token punctuation">.</span>Password<span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">]</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If the lefthand side of a value contains &#x27;secret&#x27; or &#x27;password&#x27; (case
insensitive) it will be hidden from output. For example, passing
&quot;my_password=secr3t&quot; will hide &quot;secr3t&quot; from output.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible_env_vars</code> ([]string) - Environment variables to set before
running Ansible. Usage example:</p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;ansible_env_vars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;ANSIBLE_HOST_KEY_CHECKING=False&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ANSIBLE_SSH_ARGS=&#x27;-o ForwardAgent=yes -o ControlMaster=auto -o ControlPersist=60s&#x27;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ANSIBLE_NOCOLOR=True&quot;</span> <span class="token punctuation">]</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">  This is a <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="/hashicorp-vault/packer/docs/templates/legacy_json_templates/engine">template engine</a>. Therefore, you
may use user variables and template functions in this field.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">  For example, if you are running a Windows build on AWS, Azure,
Google Compute, or OpenStack and would like to access the auto-generated
password that Packer uses to connect to a Windows instance via WinRM, you
can use the template variable <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">{{.WinRMPassword}}</code> in this option. Example:</p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">&quot;ansible_env_vars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;WINRM_PASSWORD={{.WinRMPassword}}&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible_ssh_extra_args</code> ([]string) - Specifies --ssh-extra-args on command line defaults to -o IdentitiesOnly=yes</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">groups</code> ([]string) - The groups into which the Ansible host should
be placed. When unspecified, the host is not associated with any groups.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">empty_groups</code> ([]string) - The groups which should be present in
inventory file but remain empty.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">host_alias</code> (string) - The alias by which the Ansible host should be
known. Defaults to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">default</code>. This setting is ignored when using a custom
inventory file.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">user</code> (string) - The <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible_user</code> to use. Defaults to the user running
packer, NOT the user set for your communicator. If you want to use the same
user as the communicator, you will need to manually set it again in this
field.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">local_port</code> (int) - The port on which to attempt to listen for SSH
connections. This value is a starting point. The provisioner will attempt
listen for SSH connections on the first available of ten ports, starting at
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">local_port</code>. A system-chosen port is used when <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">local_port</code> is missing or
empty.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ssh_host_key_file</code> (string) - The SSH key that will be used to run the SSH
server on the host machine to forward commands to the target machine.
Ansible connects to this server and will validate the identity of the
server using the system known_hosts. The default behavior is to generate
and use a onetime key. Host key checking is disabled via the
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ANSIBLE_HOST_KEY_CHECKING</code> environment variable if the key is generated.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ssh_authorized_key_file</code> (string) - The SSH public key of the Ansible
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ssh_user</code>. The default behavior is to generate and use a onetime key. If
this key is generated, the corresponding private key is passed to
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible-playbook</code> with the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-e ansible_ssh_private_key_file</code> option.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible_proxy_key_type</code> (string) - Change the key type used for the adapter.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Supported values:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg">ECDSA (default)</li><li class="mdx-lists_listItem__nkqhg">RSA</li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">NOTE: using RSA may cause problems if the key is used to authenticate with rsa-sha1
as modern OpenSSH versions reject this by default as it is unsafe.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">sftp_command</code> (string) - The command to run on the machine being
provisioned by Packer to handle the SFTP protocol that Ansible will use to
transfer files. The command should read and write on stdin and stdout,
respectively. Defaults to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">/usr/lib/sftp-server -e</code>.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">skip_version_check</code> (bool) - Check if ansible is installed prior to
running. Set this to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">true</code>, for example, if you&#x27;re going to install
ansible during the packer run.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">use_sftp</code> (bool) - Use SFTP</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">inventory_directory</code> (string) - The directory in which to place the
temporary generated Ansible inventory file. By default, this is the
system-specific temporary file location. The fully-qualified name of this
temporary file will be passed to the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-i</code> argument of the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible</code> command
when this provisioner runs ansible. Specify this if you have an existing
inventory directory with <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">host_vars</code> <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">group_vars</code> that you would like to
use in the playbook that this provisioner will run.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">inventory_file_template</code> (string) - This template represents the format for the lines added to the temporary
inventory file that Packer will create to run Ansible against your image.
The default for recent versions of Ansible is:
&quot;{{ .HostAlias }} ansible_host={{ .Host }} ansible_user={{ .User }} ansible_port={{ .Port }}\n&quot;
Available template engines are: This option is a template engine;
variables available to you include the examples in the default (Host,
HostAlias, User, Port) as well as any variables available to you via the
&quot;build&quot; template engine.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">inventory_file</code> (string) - The inventory file to use during provisioning.
When unspecified, Packer will create a temporary inventory file and will
use the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">host_alias</code>.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">keep_inventory_file</code> (bool) - If <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">true</code>, the Ansible provisioner will
not delete the temporary inventory file it creates in order to connect to
the instance. This is useful if you are trying to debug your ansible run
and using &quot;--on-error=ask&quot; in order to leave your instance running while you
test your playbook. this option is not used if you set an <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">inventory_file</code>.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">galaxy_file</code> (string) - A requirements file which provides a way to
install roles or collections with the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="https://docs.ansible.com/ansible/latest/galaxy/user_guide.html#the-ansible-galaxy-command-line-tool">ansible-galaxy
cli</a>
on the local machine before executing <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible-playbook</code>. By default, this is empty.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">galaxy_command</code> (string) - The command to invoke ansible-galaxy. By default, this is
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible-galaxy</code>.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">galaxy_force_install</code> (bool) - Force overwriting an existing role.
Adds <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">--force</code> option to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible-galaxy</code> command. By default, this is
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code>.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">galaxy_force_with_deps</code> (bool) - Force overwriting an existing role and its dependencies.
Adds <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">--force-with-deps</code> option to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible-galaxy</code> command. By default,
this is <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code>.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">roles_path</code> (string) - The path to the directory on your local system in which to
install the roles. Adds <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">--roles-path /path/to/your/roles</code> to
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible-galaxy</code> command. By default, this is empty, and thus <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">--roles-path</code>
option is not added to the command.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">collections_path</code> (string) - The path to the directory on your local system in which to
install the collections. Adds <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">--collections-path /path/to/your/collections</code> to
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible-galaxy</code> command. By default, this is empty, and thus <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">--collections-path</code>
option is not added to the command.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">use_proxy</code> (boolean) - When <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">true</code>, set up a localhost proxy adapter
so that Ansible has an IP address to connect to, even if your guest does not
have an IP address. For example, the adapter is necessary for Docker builds
to use the Ansible provisioner. If you set this option to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code>, but
Packer cannot find an IP address to connect Ansible to, it will
automatically set up the adapter anyway.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"> In order for Ansible to connect properly even when use_proxy is false, you
need to make sure that you are either providing a valid username and ssh key
to the ansible provisioner directly, or that the username and ssh key
being used by the ssh communicator will work for your needs. If you do not
provide a user to ansible, it will use the user associated with your
builder, not the user running Packer.
use_proxy=false is currently only supported for SSH and WinRM.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Currently, this defaults to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">true</code> for all connection types. In the future,
this option will be changed to default to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code> for SSH and WinRM
connections where the provisioner has access to a host IP.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible_winrm_use_http</code> (bool) - Force WinRM to use HTTP instead of HTTPS.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Set this to true to force Ansible to use HTTP instead of HTTPS to communicate
over WinRM to the destination host.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Ansible uses the port as a heuristic to determine whether to use HTTP
or not. In the current state, Packer assigns a random port for connecting
to WinRM and Ansible&#x27;s heuristic fails to determine that it should be
using HTTP, even when the communicator is setup to use it.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Alternatively, you may also directly add the following arguments to the
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">extra_arguments</code> section for ansible: <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">&quot;-e&quot;, &quot;ansible_winrm_scheme=http&quot;</code>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Default: <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code></p></li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Parameters common to all provisioners:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">pause_before</code> (duration) - Sleep for duration before execution.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">max_retries</code> (int) - Max times the provisioner will retry in case of failure. Defaults to zero (0). Zero means an error will not be retried.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">only</code> (array of string) - Only run the provisioner for listed builder(s)
by name.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">override</code> (object) - Override the builder with different settings for a
specific builder, eg :</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In HCL2:</p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">source <span class="token string">&quot;null&quot;</span> <span class="token string">&quot;example1&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">communicator</span> <span class="token punctuation">=</span> <span class="token string">&quot;none&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">source <span class="token string">&quot;null&quot;</span> <span class="token string">&quot;example2&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">communicator</span> <span class="token punctuation">=</span> <span class="token string">&quot;none&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">build</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">sources</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;source.null.example1&quot;</span>, <span class="token string">&quot;source.null.example2&quot;</span><span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token keyword">provisioner<span class="token type variable"> &quot;shell-local&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">inline</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;echo not overridden&quot;</span><span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">override</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">example1</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token property">inline</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;echo yes overridden&quot;</span><span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In JSON:</p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;builders&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;example1&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;communicator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;example2&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;communicator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;provisioners&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shell-local&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;inline&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;echo not overridden&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;override&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token property">&quot;example1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token property">&quot;inline&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;echo yes overridden&quot;</span><span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">timeout</code> (duration) - If the provisioner takes more than for example
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">1h10m1s</code> or <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">10m</code> to finish, the provisioner will timeout and fail.</p></li></ul><h2 class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_" id="user-content-default-extra-variables"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="Default Extra Variables permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#default-extra-variables"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Default Extra Variables</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In addition to being able to specify extra arguments using the
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">extra_arguments</code> configuration, the provisioner automatically defines certain
commonly useful Ansible variables:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">packer_build_name</code> is set to the name of the build that Packer is running.
This is most useful when Packer is making multiple builds and you want to
distinguish them slightly when using a common playbook.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">packer_builder_type</code> is the type of the builder that was used to create
the machine that the script is running on. This is useful if you want to
run only certain parts of the playbook on systems built with certain
builders.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">packer_http_addr</code> If using a builder that provides an HTTP server for file
transfer (such as <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">hyperv</code>, <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">parallels</code>, <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">qemu</code>, <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">virtualbox</code>, and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">vmware</code>), this
will be set to the address. You can use this address in your provisioner to
download large files over HTTP. This may be useful if you&#x27;re experiencing
slower speeds using the default file provisioner. A file provisioner using
the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">winrm</code> communicator may experience these types of difficulties.</p></li></ul><h2 class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_" id="user-content-debugging"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="Debugging permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#debugging"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Debugging</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">To debug underlying issues with Ansible, add <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">&quot;-vvvv&quot;</code> to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">&quot;extra_arguments&quot;</code>
to enable verbose logging.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>HCL2</strong></p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">extra_arguments</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;-vvvv&quot;</span> <span class="token punctuation">]</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>JSON</strong></p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;extra_arguments&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;-vvvv&quot;</span> <span class="token punctuation">]</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><h2 class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_" id="user-content-limitations"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="Limitations permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#limitations"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Limitations</h2><h3 class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z" id="user-content-redhat-centos"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="Redhat  CentOS permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#redhat-centos"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Redhat / CentOS</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Redhat / CentOS builds have been known to fail with the following error due to
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">sftp_command</code>, which should be set to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">/usr/libexec/openssh/sftp-server -e</code>:</p><div class="g-code-block style_root__i1k0c language-text mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-text mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-text mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">==&gt; virtualbox-ovf: starting sftp subsystem<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    virtualbox-ovf: fatal: [default]: UNREACHABLE! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;SSH Error: data could not be sent to the remote host. Make sure this host can be reached over ssh&quot;, &quot;unreachable&quot;: true}<!-- -->
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><h3 class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z" id="user-content-chroot-communicator"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="chroot communicator permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#chroot-communicator"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>chroot communicator</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Building within a chroot (e.g. <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">amazon-chroot</code>) requires changing the Ansible
connection to chroot and running Ansible as root/sudo.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>HCL2</strong></p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">source <span class="token string">&quot;amazon-chroot&quot;</span> <span class="token string">&quot;example&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">mount_path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/mnt/packer-amazon-chroot&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">region</span>     <span class="token punctuation">=</span> <span class="token string">&quot;us-east-1&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">source_ami</span> <span class="token punctuation">=</span> <span class="token string">&quot;ami-123456&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">build</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">sources</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token string">&quot;source.amazon-chroot.example&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token keyword">provisioner<span class="token type variable"> &quot;ansible&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">extra_arguments</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;--connection=chroot&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;--inventory-file=/mnt/packer-amazon-chroot&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">playbook_file</span> <span class="token punctuation">=</span> <span class="token string">&quot;main.yml&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>JSON</strong></p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;builders&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;amazon-chroot&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;mount_path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/mnt/packer-amazon-chroot&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;region&quot;</span><span class="token operator">:</span> <span class="token string">&quot;us-east-1&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;source_ami&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ami-123456&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;provisioners&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ansible&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;extra_arguments&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;--connection=chroot&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;--inventory-file=/mnt/packer-amazon-chroot&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;playbook_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;main.yml&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><h3 class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z" id="user-content-winrm-communicator"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="WinRM Communicator permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#winrm-communicator"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>WinRM Communicator</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">There are two possible methods for using Ansible with the WinRM communicator.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Please note that if you&#x27;re having trouble getting Ansible to connect, you may
want to take a look at the script that the Ansible project provides to help
configure remoting for Ansible:
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1">https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1</a></p><h4 class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716" id="user-content-method-1-(recommended)"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="Method 1 recommended permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#method-1-(recommended)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Method 1 (recommended)</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The recommended way to use the WinRM communicator is to set <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">&quot;use_proxy&quot;: false</code>
and let the Ansible provisioner handle the rest for you. If you
are using WinRM with HTTPS, and you are using a self-signed certificate you
will also have to set <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible_winrm_server_cert_validation=ignore</code> in your
extra_arguments.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Below is a fully functioning Ansible example for amazon-ebs using WinRM:</p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">variable <span class="token string">&quot;aws_region&quot;</span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">type</span>    <span class="token punctuation">=</span> string<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">&quot;us-east-1&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">variable <span class="token string">&quot;aws_access_key&quot;</span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">type</span> <span class="token punctuation">=</span> string<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">variable <span class="token string">&quot;aws_secret_key&quot;</span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">type</span> <span class="token punctuation">=</span> string<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">data <span class="token type variable">&quot;amazon-ami&quot;</span></span> <span class="token string">&quot;windows&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">filters</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">name</span>                <span class="token punctuation">=</span> <span class="token string">&quot;*Windows_Server-2012*English-64Bit-Base*&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">root-device-type</span>    <span class="token punctuation">=</span> <span class="token string">&quot;ebs&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">virtualization-type</span> <span class="token punctuation">=</span> <span class="token string">&quot;hvm&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">most_recent</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">owners</span>      <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;099720109477&quot;</span><span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">region</span>      <span class="token punctuation">=</span> var.aws_region<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">access_key</span>  <span class="token punctuation">=</span> var.aws_access_key<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">secret_key</span>  <span class="token punctuation">=</span> var.aws_secret_key<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">source <span class="token string">&quot;amazon-ebs&quot;</span> <span class="token string">&quot;example&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">region</span>      <span class="token punctuation">=</span> var.aws_region<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">instance_type</span> <span class="token punctuation">=</span> <span class="token string">&quot;t2.micro&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">source_ami</span>       <span class="token punctuation">=</span> data.amazon-ami.windows.id<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">ami_name</span>         <span class="token punctuation">=</span> <span class="token string">&quot;test-ansible-packer&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">user_data_file</span>   <span class="token punctuation">=</span> <span class="token string">&quot;windows_bootstrap.txt&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">communicator</span>     <span class="token punctuation">=</span> <span class="token string">&quot;winrm&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">force_deregister</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">winrm_username</span>   <span class="token punctuation">=</span> <span class="token string">&quot;Administrator&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">winrm_insecure</span>   <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">winrm_use_ssl</span>    <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">build</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">sources</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;source.amazon-ebs.example&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token keyword">provisioner<span class="token type variable"> &quot;ansible&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">playbook_file</span>   <span class="token punctuation">=</span> <span class="token string">&quot;./playbooks/playbook-windows.yml&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">user</span>            <span class="token punctuation">=</span> <span class="token string">&quot;Administrator&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">use_proxy</span>       <span class="token punctuation">=</span> <span class="token boolean">false</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">extra_arguments</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;-e&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;ansible_winrm_server_cert_validation=ignore&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Below is a fully functioning Ansible example for azure-arm using WinRM.
Note: pywinrm needs to be installed into the python environment on your local build machine if it&#x27;s not already installed.
Note: The ConfigureRemotingForAnsible.ps1 script can be found here <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1">https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1</a>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>HCL2</strong></p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">source <span class="token string">&quot;azure-arm&quot;</span> <span class="token string">&quot;server_2019&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">use_azure_cli_auth</span>                               <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">build_resource_group_name</span>                        <span class="token punctuation">=</span> <span class="token string">&quot;ManagedImages-RGP&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">build_key_vault_name</span>                             <span class="token punctuation">=</span> <span class="token string">&quot;Example-Packer-Keyvault&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">os_type</span>                                          <span class="token punctuation">=</span> <span class="token string">&quot;Windows&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">image_publisher</span>                                  <span class="token punctuation">=</span> <span class="token string">&quot;MicrosoftWindowsServer&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">image_offer</span>                                      <span class="token punctuation">=</span> <span class="token string">&quot;WindowsServer&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">image_sku</span>                                        <span class="token punctuation">=</span> <span class="token string">&quot;2019-Datacenter&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">vm_size</span>                                          <span class="token punctuation">=</span> <span class="token string">&quot;Standard_D2as_v5&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">os_disk_size_gb</span>                                  <span class="token punctuation">=</span> <span class="token number">130</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">shared_gallery_image_version_exclude_from_latest</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">virtual_network_resource_group_name</span>              <span class="token punctuation">=</span> <span class="token string">&quot;VNET-Resource-Group&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">virtual_network_name</span>                             <span class="token punctuation">=</span> <span class="token string">&quot;My-VNET&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">virtual_network_subnet_name</span>                      <span class="token punctuation">=</span> <span class="token string">&quot;My-Subnet&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">private_virtual_network_with_public_ip</span>           <span class="token punctuation">=</span> <span class="token boolean">false</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">communicator</span>                                     <span class="token punctuation">=</span> <span class="token string">&quot;winrm&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">winrm_use_ssl</span>                                    <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">winrm_insecure</span>                                   <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">winrm_timeout</span>                                    <span class="token punctuation">=</span> <span class="token string">&quot;3m&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">winrm_username</span>                                   <span class="token punctuation">=</span> <span class="token string">&quot;Packer&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">managed_image_name</span>                               <span class="token punctuation">=</span> <span class="token string">&quot;Managed-Image-Name&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">managed_image_resource_group_name</span>                <span class="token punctuation">=</span> <span class="token string">&quot;ManagedImages-RGP&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">managed_image_storage_account_type</span>               <span class="token punctuation">=</span> <span class="token string">&quot;Standard_LRS&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token keyword">shared_image_gallery_destination</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">resource_group</span>       <span class="token punctuation">=</span> <span class="token string">&quot;ManagedImages-RGP&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">gallery_name</span>         <span class="token punctuation">=</span> <span class="token string">&quot;MyGallery&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">image_name</span>           <span class="token punctuation">=</span> <span class="token string">&quot;Server2019&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">storage_account_type</span> <span class="token punctuation">=</span> <span class="token string">&quot;Standard_LRS&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">build</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">sources</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token string">&quot;sources.azure-arm.server_2019&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token keyword">provisioner<span class="token type variable"> &quot;shell-local&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">inline_shebang</span> <span class="token punctuation">=</span> <span class="token string">&quot;/bin/bash -e&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">inline</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token string">&quot;pipx inject python-env-name \&quot;pywinrm\&quot;&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token keyword">provisioner<span class="token type variable"> &quot;powershell&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">script</span> <span class="token punctuation">=</span> <span class="token string">&quot;../../scripts/ConfigureRemotingForAnsible.ps1&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token keyword">provisioner<span class="token type variable"> &quot;ansible&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">skip_version_check</span>  <span class="token punctuation">=</span> <span class="token boolean">false</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">user</span>                <span class="token punctuation">=</span> <span class="token string">&quot;Packer&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">use_proxy</span>           <span class="token punctuation">=</span> <span class="token boolean">false</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">playbook_file</span>       <span class="token punctuation">=</span> <span class="token string">&quot;windows2019.yml&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">extra_arguments</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token string">&quot;-e&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token string">&quot;ansible_winrm_server_cert_validation=ignore&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token string">&quot;-e&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token string">&quot;ansible_winrm_transport=ntlm&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>JSON</strong></p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;builders&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;amazon-ebs&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;region&quot;</span><span class="token operator">:</span> <span class="token string">&quot;us-east-1&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;instance_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t2.micro&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;source_ami_filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token property">&quot;filters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token property">&quot;virtualization-type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hvm&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*Windows_Server-2012*English-64Bit-Base*&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token property">&quot;root-device-type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ebs&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token property">&quot;most_recent&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token property">&quot;owners&quot;</span><span class="token operator">:</span> <span class="token string">&quot;amazon&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;ami_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test-ansible-packer&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;user_data_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;windows_bootstrap.txt&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;communicator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;winrm&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;force_deregister&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;winrm_insecure&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;winrm_username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Administrator&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;winrm_use_ssl&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;provisioners&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ansible&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;playbook_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./playbook.yml&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;user&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Administrator&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;use_proxy&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;extra_arguments&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;-e&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ansible_winrm_server_cert_validation=ignore&quot;</span><span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Note that you do have to set the &quot;Administrator&quot; user, because otherwise Ansible
will default to using the user that is calling Packer, rather than the user
configured inside of the Packer communicator. For the contents of
windows_bootstrap.txt, see the WinRM docs for the amazon-ebs communicator.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When running from OSX, you may see an error like:</p><div class="g-code-block style_root__i1k0c language-text mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-text mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-text mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    amazon-ebs: objc[9752]: +[__NSCFConstantString initialize] may have been in progress in another thread when fork() was called.<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    amazon-ebs: objc[9752]: +[__NSCFConstantString initialize] may have been in progress in another thread when fork() was called. We cannot safely call it or ignore it in the fork() child process. Crashing instead. Set a breakpoint on objc_initializeAfterForkError to debug.<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    amazon-ebs: ERROR! A worker was found in a dead state<!-- -->
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If you see this, you may be able to work around the issue by telling Ansible to
explicitly not use any proxying; you can do this by setting the template option</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>HCL2</strong></p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">ansible_env_vars</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;no_proxy=\&quot;*\&quot;&quot;</span><span class="token punctuation">]</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>JSON</strong></p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">&quot;ansible_env_vars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;no_proxy=\&quot;*\&quot;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">in the above Ansible template.</p><h4 class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716" id="user-content-method-2-(not-recommended)"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="Method 2 Not recommended permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#method-2-(not-recommended)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Method 2 (Not recommended)</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If you want to use the Packer SSH proxy, then you need a custom Ansible
connection plugin and a particular configuration. You need a directory named
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">connection_plugins</code> next to the playbook which contains a file named
packer.py` which implements the connection plugin. On versions of Ansible
before 2.4.x, the following works as the connection plugin:</p><div class="g-code-block style_root__i1k0c language-python mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-python mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-python mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> <span class="token punctuation">(</span>absolute_import<span class="token punctuation">,</span> division<span class="token punctuation">,</span> print_function<span class="token punctuation">)</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">__metaclass__ <span class="token operator">=</span> <span class="token builtin">type</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">from</span> ansible<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>ssh <span class="token keyword">import</span> Connection <span class="token keyword">as</span> SSHConnection<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">class</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span>SSHConnection<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token triple-quoted-string string">&#x27;&#x27;&#x27; ssh based connections for powershell via packer&#x27;&#x27;&#x27;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    transport <span class="token operator">=</span> <span class="token string">&#x27;packer&#x27;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    has_pipelining <span class="token operator">=</span> <span class="token boolean">True</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    become_methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    allow_executable <span class="token operator">=</span> <span class="token boolean">False</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    module_implementation_preferences <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#x27;.ps1&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token builtin">super</span><span class="token punctuation">(</span>Connection<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Newer versions of Ansible require all plugins to have a documentation string.
You can see if there is a plugin available for the version of Ansible you are
using
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="https://github.com/hashicorp/packer/tree/master/provisioner/ansible/examples/connection-plugin">here</a>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">To create the plugin yourself, you will need to copy all of the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">options</code> from
the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">DOCUMENTATION</code> string from the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="https://github.com/ansible/ansible/blob/devel/lib/ansible/plugins/connection/ssh.py">ssh.py Ansible connection
plugin</a>
of the Ansible version you are using and add it to a packer.py file similar to
as follows</p><div class="g-code-block style_root__i1k0c language-python mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-python mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-python mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> <span class="token punctuation">(</span>absolute_import<span class="token punctuation">,</span> division<span class="token punctuation">,</span> print_function<span class="token punctuation">)</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">__metaclass__ <span class="token operator">=</span> <span class="token builtin">type</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">from</span> ansible<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>ssh <span class="token keyword">import</span> Connection <span class="token keyword">as</span> SSHConnection<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">DOCUMENTATION <span class="token operator">=</span> <span class="token triple-quoted-string string">&#x27;&#x27;&#x27;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token triple-quoted-string string">    connection: packer</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token triple-quoted-string string">    short_description: ssh based connections for powershell via packer</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token triple-quoted-string string">    description:</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token triple-quoted-string string">        - This connection plugin allows ansible to communicate to the target packer machines via ssh based connections for powershell.</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token triple-quoted-string string">    author: Packer</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token triple-quoted-string string">    version_added: na</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token triple-quoted-string string">    options:</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token triple-quoted-string string">      **** Copy ALL the options from</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token triple-quoted-string string">      https://github.com/ansible/ansible/blob/devel/lib/ansible/plugins/connection/ssh.py</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token triple-quoted-string string">      for the version of Ansible you are using ****</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token triple-quoted-string string">&#x27;&#x27;&#x27;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">class</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span>SSHConnection<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token triple-quoted-string string">&#x27;&#x27;&#x27; ssh based connections for powershell via packer&#x27;&#x27;&#x27;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    transport <span class="token operator">=</span> <span class="token string">&#x27;packer&#x27;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    has_pipelining <span class="token operator">=</span> <span class="token boolean">True</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    become_methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    allow_executable <span class="token operator">=</span> <span class="token boolean">False</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    module_implementation_preferences <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#x27;.ps1&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token builtin">super</span><span class="token punctuation">(</span>Connection<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This template should build a Windows Server 2012 image on Google Cloud
Platform:</p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;variables&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;provisioners&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ansible&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;playbook_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./win-playbook.yml&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;extra_arguments&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;--connection&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;packer&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;--extra-vars&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;\&quot;ansible_shell_type=powershell ansible_shell_executable=None\&quot;&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;builders&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;googlecompute&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;account_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{ user `account_file`}}&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;project_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{user `project_id`}}&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;source_image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;windows-server-2012-r2-dc-v20160916&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;communicator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;winrm&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;zone&quot;</span><span class="token operator">:</span> <span class="token string">&quot;us-central1-a&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;disk_size&quot;</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;winrm_username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packer&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;winrm_use_ssl&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;winrm_insecure&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;metadata&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token property">&quot;sysprep-specialize-script-cmd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;winrm set winrm/config/service/auth @{Basic=\&quot;true\&quot;}&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><div class="alert alert-info g-type-body"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>Warning:</strong> Please note that if you&#x27;re setting up WinRM for provisioning, you&#x27;ll probably want to turn it off or restrict its permissions as part of a shutdown script at the end of Packer&#x27;s provisioning process. For more details on the why/how, check out this useful blog post and the associated code:
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="https://cloudywindows.io/post/winrm-for-provisioning-close-the-door-on-the-way-out-eh/">https://cloudywindows.io/post/winrm-for-provisioning-close-the-door-on-the-way-out-eh/</a></p></div><h3 class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z" id="user-content-post-io-timeout-errors"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="Post io timeout errors permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#post-io-timeout-errors"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Post i/o timeout errors</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If you see
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">unknown error: Post http://&lt;ip&gt;:&lt;port&gt;/wsman:dial tcp &lt;ip&gt;:&lt;port&gt;: i/o timeout</code>
errors while provisioning a Windows machine, try setting Ansible to copy files
over <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#envvar-ANSIBLE_SCP_IF_SSH">ssh instead of
sftp</a>.</p><h3 class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z" id="user-content-too-many-ssh-keys"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="Too many SSH keys permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#too-many-ssh-keys"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Too many SSH keys</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">SSH servers only allow you to attempt to authenticate a certain number of
times. All of your loaded keys will be tried before the dynamically generated
key. If you have too many SSH keys loaded in your <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ssh-agent</code>, the Ansible
provisioner may fail authentication with a message similar to this:</p><div class="g-code-block style_root__i1k0c language-text mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-text mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-text mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    googlecompute: fatal: [default]: UNREACHABLE! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;Failed to connect to the host via ssh: Warning: Permanently added &#x27;[127.0.0.1]:62684&#x27; (RSA) to the list of known hosts.\r\nReceived disconnect from 127.0.0.1 port 62684:2: too many authentication failures\r\nAuthentication failed.\r\n&quot;, &quot;unreachable&quot;: true}<!-- -->
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">To unload all keys from your <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ssh-agent</code>, run:</p><div class="g-code-block style_root__i1k0c language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">ssh-add -D</span></span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><h3 class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z" id="user-content-become:-yes"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="Become yes permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#become:-yes"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Become: yes</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">We recommend against running Packer as root; if you do then you won&#x27;t be able
to successfully run your Ansible playbook as root; <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">become: yes</code> will fail.</p><h3 class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z" id="user-content-using-a-wrapping-script-for-your-ansible-call"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="Using a wrapping script for your Ansible call permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#using-a-wrapping-script-for-your-ansible-call"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Using a wrapping script for your Ansible call</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Sometimes, you may have extra setup that needs to be called as part of your
ansible run. The easiest way to do this is by writing a small bash script and
using that bash script in your <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">command</code> in place of the default
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ansible-playbook</code>. For example, you may need to launch a Python <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">virtualenv</code>
before calling Ansible. To do this, you&#x27;d want to create a bash script like</p><div class="g-code-block style_root__i1k0c language-shell mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-shell mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-shell mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token shebang important">#!/bin/bash</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token builtin class-name">source</span> /tmp/venv/bin/activate <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">ANSIBLE_FORCE_COLOR</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">PYTHONUNBUFFERED</span><span class="token operator">=</span><span class="token number">1</span> /tmp/venv/bin/ansible-playbook <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The Ansible provisioner template remains very simple. For example:</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>HCL2</strong></p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">provisioner<span class="token type variable"> &quot;ansible&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">command</span>       <span class="token punctuation">=</span> <span class="token string">&quot;/Path/To/call_ansible.sh&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">playbook_file</span> <span class="token punctuation">=</span> <span class="token string">&quot;./playbook.yml&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>JSON</strong></p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ansible&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/Path/To/call_ansible.sh&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;playbook_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./playbook.yml&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Note that we&#x27;re calling ansible-playbook at the end of this command and passing
all command line arguments through into this call; this is necessary for
making sure that --extra-vars and other important Ansible arguments get set.
Note the quoting around the bash array, too; if you don&#x27;t use quotes, any
arguments with spaces will not be read properly.</p><h2 class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_" id="user-content-docker"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="Docker permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#docker"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Docker</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When trying to use Ansible with Docker, it should &quot;just work&quot; but if it doesn&#x27;t
you may need to tweak a few options.</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg">Change the ansible_connection from &quot;ssh&quot; to &quot;docker&quot;</li><li class="mdx-lists_listItem__nkqhg">Set a Docker container name via the --name option.</li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">On a CI server you probably want to overwrite ansible_host with a random name.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Example Packer template:</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>HCL2</strong></p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">variable<span class="token type variable"> &quot;ansible_host&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">&quot;default&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">variable<span class="token type variable"> &quot;ansible_connection&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">&quot;docker&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">source <span class="token string">&quot;docker&quot;</span> <span class="token string">&quot;example&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">image</span>       <span class="token punctuation">=</span> <span class="token string">&quot;centos:7&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">commit</span>      <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">run_command</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;-d&quot;</span>, <span class="token string">&quot;-i&quot;</span>, <span class="token string">&quot;-t&quot;</span>, <span class="token string">&quot;--name&quot;</span>, var.ansible_host, <span class="token string">&quot;{{.Image}}&quot;</span>, <span class="token string">&quot;/bin/bash&quot;</span> <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">build</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">sources</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token string">&quot;source.docker.example&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token keyword">provisioner<span class="token type variable"> &quot;ansible&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">groups</span>          <span class="token punctuation">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;webserver&quot;</span> <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">playbook_file</span>   <span class="token punctuation">=</span> <span class="token string">&quot;./webserver.yml&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">extra_arguments</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token string">&quot;--extra-vars&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token string">&quot;ansible_host=<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">ansible_host</span><span class="token punctuation">}</span></span> ansible_connection=<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">ansible_connection</span><span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>JSON</strong></p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;variables&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">&quot;ansible_host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">&quot;ansible_connection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;builders&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;centos:7&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;commit&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;run_command&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;-d&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;-i&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;-t&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;--name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;{{user `ansible_host`}}&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;{{.Image}}&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;/bin/bash&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;provisioners&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ansible&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;groups&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;webserver&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;playbook_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./webserver.yml&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;extra_arguments&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;--extra-vars&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token string">&quot;ansible_host={{user `ansible_host`}} ansible_connection={{user `ansible_connection`}}&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Example playbook:</p><div class="g-code-block style_root__i1k0c language-yaml mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-yaml mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-yaml mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> configure webserver<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> webserver<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install Apache<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token key atrule">yum</span><span class="token punctuation">:</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd<!-- -->
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><h2 class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_" id="user-content-amazon-session-manager"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="Amazon Session Manager permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#amazon-session-manager"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Amazon Session Manager</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When trying to use Ansible with Amazon&#x27;s Session Manager, you may run into an error where Ansible
is unable to connect to the remote Amazon instance if the local proxy adapter for Ansible <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#use_proxy">use_proxy</a> is false.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The error may look something like the following:</p><div class="g-code-block style_root__i1k0c mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">amazon-ebs: fatal: [default]: UNREACHABLE! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;Failed to connect to the host via ssh: ssh: connect to host 127.0.0.1 port 8362: Connection timed out&quot;, &quot;unreachable&quot;: true}<!-- -->
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The error is caused by a limitation on using Amazon&#x27;s SSM default Port Forwarding session which only allows for one
remote connection on the forwarded port. Since Ansible&#x27;s SSH communication is not using the local proxy adapter
it will try to make a new SSH connection to the same forwarded localhost port and fail.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In order to workaround this issue Ansible can be configured via a custom inventory file to use the AWS session-manager-plugin
directly to create a new session, separate from the one created by Packer, at runtime to connect and remotely provision the instance.</p><div class="alert alert-info g-type-body"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>Warning:</strong> Please note that the default region configured for the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">aws</code> cli must match the build region where the instance is being
provisioned otherwise you may run into a TargetNotConnected error. Users can use <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">AWS_DEFAULT_REGION</code> to temporarily override
their configured region.</p></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>HCL2</strong></p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token keyword">provisioner<span class="token type variable"> &quot;ansible&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">use_proxy</span>               <span class="token punctuation">=</span>  <span class="token boolean">false</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">playbook_file</span>           <span class="token punctuation">=</span>  <span class="token string">&quot;./playbooks/playbook_remote.yml&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">ansible_env_vars</span>        <span class="token punctuation">=</span>  <span class="token punctuation">[</span><span class="token string">&quot;PACKER_BUILD_NAME={{ build_name }}&quot;</span><span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">inventory_file_template</span> <span class="token punctuation">=</span>  <span class="token string">&quot;{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args=&#x27;-o StrictHostKeyChecking=no -o ProxyCommand=\&quot;sh -c \\\&quot;aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\&quot;\&quot;&#x27;\n&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>JSON</strong></p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;provisioners&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ansible&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;use_proxy&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;ansible_env_vars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;PACKER_BUILD_NAME={{ build_name }}&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;playbook_file&quot;</span><span class="token operator">:</span>   <span class="token string">&quot;./playbooks/playbook_remote.yml&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;inventory_file_template&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args=&#x27;-o StrictHostKeyChecking=no -o ProxyCommand=\&quot;sh -c \\\&quot;aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\&quot;\&quot;&#x27;\n&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Full Packer template example:</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>HCL2</strong></p><div class="g-code-block style_root__i1k0c language-hcl mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-hcl mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">variables</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">instance_role</span> <span class="token punctuation">=</span> <span class="token string">&quot;SSMInstanceProfile&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">source <span class="token string">&quot;amazon-ebs&quot;</span> <span class="token string">&quot;ansible-example&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">region</span>        <span class="token punctuation">=</span> <span class="token string">&quot;us-east-1&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">ami_name</span>      <span class="token punctuation">=</span> <span class="token string">&quot;packer-ami-ansible&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">instance_type</span> <span class="token punctuation">=</span> <span class="token string">&quot;t2.micro&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token keyword">source_ami_filter</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">filters</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token property">name</span>                <span class="token punctuation">=</span> <span class="token string">&quot;ubuntu/images/*ubuntu-xenial-16.04-amd64-server-*&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token property">virtualization-type</span> <span class="token punctuation">=</span> <span class="token string">&quot;hvm&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token property">root-device-type</span>    <span class="token punctuation">=</span> <span class="token string">&quot;ebs&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">owners</span>      <span class="token punctuation">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;099720109477&quot;</span> <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">most_recent</span> <span class="token punctuation">=</span>  <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">communicator</span>         <span class="token punctuation">=</span> <span class="token string">&quot;ssh&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">ssh_username</span>         <span class="token punctuation">=</span> <span class="token string">&quot;ubuntu&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">ssh_interface</span>        <span class="token punctuation">=</span> <span class="token string">&quot;session_manager&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">iam_instance_profile</span> <span class="token punctuation">=</span> var.instance_role<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token keyword">build</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">sources</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;source.amazon-ebs.ansible-example&quot;</span><span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token keyword">provisioner<span class="token type variable"> &quot;ansible&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">use_proxy</span>               <span class="token punctuation">=</span>  <span class="token boolean">false</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">playbook_file</span>           <span class="token punctuation">=</span>    <span class="token string">&quot;./playbooks/playbook_remote.yml&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">ansible_env_vars</span>        <span class="token punctuation">=</span>  <span class="token punctuation">[</span><span class="token string">&quot;PACKER_BUILD_NAME={{ build_name }}&quot;</span><span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">inventory_file_template</span> <span class="token punctuation">=</span>  <span class="token string">&quot;{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args=&#x27;-o StrictHostKeyChecking=no -o ProxyCommand=\&quot;sh -c \\\&quot;aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\&quot;\&quot;&#x27;\n&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>JSON</strong></p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;variables&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">&quot;instance_role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SSMInstanceProfile&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;builders&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;amazon-ebs&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;region&quot;</span><span class="token operator">:</span> <span class="token string">&quot;us-east-1&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;ami_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packer-ami-ansible&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;instance_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t2.micro&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;source_ami_filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token property">&quot;filters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token property">&quot;virtualization-type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hvm&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ubuntu/images/*ubuntu-xenial-16.04-amd64-server-*&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">          <span class="token property">&quot;root-device-type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ebs&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token property">&quot;owners&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;099720109477&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">        <span class="token property">&quot;most_recent&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;communicator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ssh&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;ssh_username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ubuntu&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;ssh_interface&quot;</span><span class="token operator">:</span> <span class="token string">&quot;session_manager&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;iam_instance_profile&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{user `instance_role`}}&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;provisioners&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ansible&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;use_proxy&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;ansible_env_vars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;PACKER_BUILD_NAME={{ build_name }}&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;playbook_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./playbooks/playbook_remote.yml&quot;</span><span class="token punctuation">,</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">      <span class="token property">&quot;inventory_file_template&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args=&#x27;-o StrictHostKeyChecking=no -o ProxyCommand=\&quot;sh -c \\\&quot;aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\&quot;\&quot;&#x27;\n&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><h2 class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_" id="user-content-troubleshooting"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="Troubleshooting permalink" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#troubleshooting"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Troubleshooting</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If you are using an Ansible version &gt;= 2.8 and Packer hangs in the
&quot;Gathering Facts&quot; stage, this could be the result of a pipelineing issue with
the proxy adapter that Packer uses. Setting <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">use_proxy</code> to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code> in the ansible
provisioner block of your Packer config should resolve the issue. In the future
we will default to setting this, so you won&#x27;t have to but for now it is a manual
change you must make.</p></div></div></div></main><div class="sidebar-sidecar-layout_sidecarPosition__WtTq0"><div class="sidebar-sidecar-layout_sidecarTopSlot__qRAEI"></div><div class="sidecar-scroll-container_root__a8nIj"><div class="sidecar-scroll-container_scrollContainer__Dw9id"><div><nav aria-labelledby="react-aria-54"><p id="react-aria-54" class="outline-nav_navLabel__HrjQb hds-typography-body-100">On this page:</p><ol class="outline-nav_listRoot__Sm1fr"><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#basic-example">Basic Example</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#configuration-reference">Configuration Reference</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#default-extra-variables">Default Extra Variables</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#debugging">Debugging</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#limitations">Limitations</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#redhat-centos">Redhat / CentOS</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#chroot-communicator">chroot communicator</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#winrm-communicator">WinRM Communicator</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#method-1-(recommended)">Method 1 (recommended)</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#method-2-(not-recommended)">Method 2 (Not recommended)</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#post-io-timeout-errors">Post i/o timeout errors</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#too-many-ssh-keys">Too many SSH keys</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#become:-yes">Become: yes</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#using-a-wrapping-script-for-your-ansible-call">Using a wrapping script for your Ansible call</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#docker">Docker</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#amazon-session-manager">Amazon Session Manager</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" href="/hashicorp-vault/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible#troubleshooting">Troubleshooting</a></li></ol></nav></div></div></div></div></div></div></div></div></div><div class="base-layout_footer__HGqK8 base-layout_showFooterTopBorder__4_CwH"><footer class="footer_root__qJO_k"><span class="footer_logoAndSwitcher__CJkN3"><a href="https://www.hashicorp.com/" aria-label="Go to HashiCorp home page" class="footer_logo__pe9i3 g-focus-ring-from-box-shadow"><div><svg width="317" height="88" viewBox="0 0 317 88" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M107.692 64.421V47.4h-14.97v17.02h-7.623V24.06h7.622v16.602h14.971V24.06h7.622v40.36h-7.622zm35.567-.001h-6.053l-.548-1.996a16.137 16.137 0 01-8.789 2.607c-5.397 0-7.699-3.697-7.699-8.79 0-5.998 2.607-8.3 8.606-8.3h7.089v-3.095c0-3.27-.907-4.421-5.633-4.421a41.255 41.255 0 00-8.179.877l-.907-5.634a38.496 38.496 0 0110.122-1.395c9.269 0 11.998 3.27 11.998 10.672l-.007 19.476zm-7.394-11.151h-5.45c-2.424 0-3.087.663-3.087 2.912 0 2.058.663 2.973 2.972 2.973a11.629 11.629 0 005.572-1.525l-.007-4.36zm21.701 11.754a34.776 34.776 0 01-10.183-1.7l1.029-5.633a33.038 33.038 0 008.788 1.273c3.271 0 3.758-.762 3.758-2.973 0-1.814-.366-2.729-5.152-3.88-7.211-1.76-8.058-3.575-8.058-9.269 0-5.938 2.607-8.545 11.03-8.545 2.98.003 5.949.348 8.85 1.03l-.762 5.876a51.98 51.98 0 00-8.118-.846c-3.209 0-3.758.763-3.758 2.546 0 2.363.183 2.546 4.185 3.575 8.263 2.188 9.055 3.278 9.055 9.307 0 5.725-1.761 9.239-10.664 9.239zm32.663-.602V43.84c0-1.578-.663-2.363-2.363-2.363-1.814 0-5.031 1.09-7.699 2.485v20.459h-7.394V22.847l7.394-1.029v15.33a26.045 26.045 0 0110.786-2.852c4.909 0 6.662 3.453 6.662 8.728v21.397h-7.386zm12.844-33.692v-8.545h7.394v8.545h-7.394zm0 33.692V34.906h7.394v29.515h-7.394zM215.62 35.15c0-7.394 4.299-11.693 14.361-11.693 3.697 0 7.38.447 10.969 1.334l-.839 6.601a59.517 59.517 0 00-9.909-1.029c-5.275 0-6.967 1.822-6.967 6.098v15.512c0 4.3 1.7 6.098 6.967 6.098a59.506 59.506 0 009.909-1.029l.846 6.609a45.672 45.672 0 01-10.968 1.334c-10.062 0-14.361-4.3-14.361-11.693l-.008-18.142zm40.499 29.873c-10.123 0-12.844-5.572-12.844-11.632v-7.455c0-6.06 2.728-11.632 12.844-11.632 10.115 0 12.844 5.572 12.844 11.632v7.455c-.023 6.06-2.744 11.632-12.844 11.632zm0-24.392c-3.941 0-5.45 1.76-5.45 5.092v7.912c0 3.331 1.524 5.092 5.45 5.092 3.925 0 5.45-1.76 5.45-5.092v-7.943c-.015-3.33-1.532-5.092-5.45-5.092v.03zm32.457.457a57.835 57.835 0 00-7.821 4.3v19.056h-7.394V34.906h6.243l.488 3.27a33.064 33.064 0 017.76-3.88l.724 6.792zm28.035 13.515c0 6.548-2.911 10.42-9.756 10.42a40.76 40.76 0 01-7.882-.853v12.196l-7.394 1.029V34.906h5.877l.762 2.485a15.535 15.535 0 019.33-3.087c5.938 0 9.086 3.514 9.086 10.245l-.023 10.054zm-17.631 3.331c2.152.474 4.346.73 6.548.763 2.668 0 3.697-1.274 3.697-3.941V44.35c0-2.424-.907-3.758-3.636-3.758a10.46 10.46 0 00-6.609 2.668v14.673zM29.134 7L0 23.808v40.361l10.946 6.32V30.127l18.188-10.504V7z" fill="#000"/><path d="M40.758 7v32.144H29.133V27.147l-10.945 6.319V74.65l10.946 6.335V48.932h11.624v11.914l10.946-6.312V13.32L40.758 7z" fill="#000"/><path d="M40.758 81L69.89 64.192V23.831l-10.946-6.32v40.362L40.758 68.377V81z" fill="#000"/></svg></div></a><span class="footer_themeSwitcher__CPJxw hds-font-weight-regular"><label class="theme-switcher_label__7Boh2 hds-typography-body-200" for="react-aria-72">Theme</label></span></span><ul class="footer_links__t81SU"><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" href="/hashicorp-vault/certifications"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Certifications</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" href="https://status.hashicorp.com"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">System Status</span></a></li><li><button class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Cookie Manager</span></button></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" href="https://www.hashicorp.com/terms-of-service"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Terms of Use</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" href="https://www.hashicorp.com/security"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Security</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" href="https://www.hashicorp.com/privacy"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Privacy</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" href="https://www.hashicorp.com/trademark-policy"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Trademark Policy</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" href="https://www.hashicorp.com/trade-controls"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Trade Controls</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" aria-describedby="undefinedopens-in-new-tab-label-react-aria-80" target="_blank" href="https://forms.gle/fnHLuNahLEhjuKvE6"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Give Feedback</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M9 .75A.75.75 0 019.75 0h4.5c.206 0 .393.083.529.218l.001.002.002.001A.748.748 0 0115 .75v4.5a.75.75 0 01-1.5 0V2.56L7.28 8.78a.75.75 0 01-1.06-1.06l6.22-6.22H9.75A.75.75 0 019 .75z"></path><path d="M3.25 3.5a.75.75 0 00-.75.75v7.5c0 .414.336.75.75.75h7.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0110.75 14h-7.5A2.25 2.25 0 011 11.75v-7.5A2.25 2.25 0 013.25 2h4a.75.75 0 010 1.5h-4z"></path></g></svg></a><span class="g-screen-reader-only" id="opens-in-new-tab-label-react-aria-80">(opens in new tab)</span></li></ul></footer></div></div></div><div class="style_root__owpNH"></div><div style="position:fixed;z-index:99;top:16px;left:16px;right:16px;bottom:16px;pointer-events:none;inset:24px"></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"metadata":{"title":"Ansible Provisioner | Integrations"},"product":{"name":"Packer","slug":"packer","algoliaConfig":{"indexName":"product_PACKER","searchOnlyApiKey":"4e1ea7f4bf4335ac43d9f28463e42148"},"analyticsConfig":{"includedDomains":"packer.io www.packer.io","segmentWriteKey":"AjXdfmTTk1I9q9dfyePuDFHBrz1tCO3l"},"datoToken":"88b4984480dad56295a8aadae6caad","metadata":{"title":"Packer by HashiCorp","description":"Packer helps you create golden images for multiple platforms from a single source configuration.","image":"https://www.packer.io/packer-public/img/og-image.png","icon":[{"href":"/packer-public/_favicon.ico"}]},"alertBannerActive":true,"alertBanner":{"tag":"HashiConf","url":"https://hashiconf.com/2023?utm_source=direct\u0026utm_medium=banner\u0026utm_campaign=23Q3_HASHICONFGLOBAL_EVENT\u0026utm_content=\u0026utm_offer=event","text":"Our community conference is taking place in San Francisco and online October 10-12.","linkText":"Register now","expirationDate":""},"version":"1.7.10","basePaths":["docs","guides","intro","downloads"],"rootDocsPaths":[{"iconName":"docs","name":"Documentation","path":"docs"},{"iconName":"guide","name":"Guides","path":"guides"}],"integrationsConfig":{"description":"A curated collection of official, partner, and community Packer Integrations."}},"integration":{"id":"5a550293-a170-4a30-994a-5f8e889fcef0","slug":"ansible","name":"Ansible","description":"The Ansible plugin allows users to execute as a provisioner during a Packer build.","license_type":null,"license_url":null,"external_only":false,"external_url":null,"tier":"official","repo_url":"https://github.com/hashicorp/packer-plugin-ansible","subdirectory":"/.web-docs","created_at":"2023-06-15T19:02:40.836Z","updated_at":"2023-08-08T17:01:03.611Z","hide_versions":false,"organization":{"id":"a4a0551a-1451-4d89-9f56-8031c8350c77","slug":"hashicorp","created_at":"2022-11-09T22:56:32.391Z","updated_at":"2022-11-09T22:56:32.391Z"},"product":{"id":"4c2b00c6-7cc1-4e4c-b596-4ab57e319f21","slug":"packer","name":"Packer","created_at":"2022-11-09T22:56:29.896Z","updated_at":"2022-11-09T22:56:29.896Z"},"versions":["1.1.1","1.1.0","0.0.1"],"components":[{"id":"418417de-2c71-46a1-8dbc-7e9ae777a22e","slug":"provisioner","name":"Provisioner","plural_name":"Provisioners"},{"id":"418417de-2c71-46a1-8dbc-7e9ae777a22e","slug":"provisioner","name":"Provisioner","plural_name":"Provisioners"}],"flags":[],"integration_type":null},"activeRelease":{"id":"96ffc6eb-eb8e-4901-b710-bf88921b9095","integration_id":"5a550293-a170-4a30-994a-5f8e889fcef0","version":"1.1.1","readme":"The Ansible plugin allows users to execute as a provisioner during a Packer build.\n\n\n### Installation\nTo install this plugin add this code into your Packer configuration and run [packer init](/packer/docs/commands/init)\n\n```hcl\npacker {\n  required_plugins {\n    ansible = {\n      version = \"~\u003e 1\"\n      source = \"github.com/hashicorp/ansible\"\n    }\n  }\n}\n```\n\nAlternatively, you can use `packer plugins install` to manage installation of this plugin.\n\n```sh\npacker plugins install github.com/hashicorp/ansible\n```\n\n### Components\n\n**Note:** Ansible will _not_ be installed automatically by this provisioner. This provisioner expects that Ansible is already installed on the guest/remote machine.\nIt is common practice to use the [shell provisioner](/packer/docs/provisioners/shell) before the Ansible provisioner to do this.\n\n#### Provisioners:\n\n- [ansible](/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible) - The Packer provisioner runs Ansible playbooks. It dynamically creates an Ansible inventory file configured to use SSH, runs an SSH server, executes ansible-playbook, and marshals Ansible plays through the SSH server to the machine being provisioned by Packer.\n\n- [ansible-local](/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible-local) - The Packer provisioner will run ansible in ansible's \"local\" mode on the remote/guest VM using Playbook and Role files that exist on the guest VM. This means ansible must be installed on the remote/guest VM.\n","created_at":"2023-11-27T18:58:18.236Z","updated_at":"2023-11-27T18:58:18.236Z","components":[{"id":"4ed8f0f7-1a71-4775-b940-e68d12ea517e","integration_release_id":"96ffc6eb-eb8e-4901-b710-bf88921b9095","component_id":"418417de-2c71-46a1-8dbc-7e9ae777a22e","readme":"Type: `ansible-local`\n\nThe `ansible-local` Packer provisioner will execute `ansible` in Ansible's \"local\"\nmode on the remote/guest VM using Playbook and Role files that exist on the\nguest VM. This means Ansible must be installed on the remote/guest VM.\nPlaybooks and Roles can be uploaded from your build machine (the one running\nPacker) to the vm. Ansible is then run on the guest machine in [local\nmode](https://docs.ansible.com/ansible/latest/playbooks_delegation.html#local-playbooks)\nvia the `ansible-playbook` command.\n\n-\u003e **Note:** Ansible will _not_ be installed automatically by this\nprovisioner. This provisioner expects that Ansible is already installed on the\nguest/remote machine. It is common practice to use the [shell\nprovisioner](/packer/docs/provisioner/shell) before the Ansible provisioner to\ndo this.\n\n## Basic Example\n\nThe example below is fully functional.\n\n**HCL2**\n\n```hcl\nvariable \"topping\" {\n  type    = string\n  default = \"mushroom\"\n}\n\nsource \"docker\" \"example\" {\n  image       = \"williamyeh/ansible:ubuntu14.04\"\n  export_path = \"packer_example\"\n  run_command = [\"-d\", \"-i\", \"-t\", \"--entrypoint=/bin/bash\", \"{{.Image}}\"]\n}\n\nbuild {\n  sources = [\n    \"source.docker.example\"\n  ]\n\n  provisioner \"ansible-local\" {\n    playbook_file   = \"./playbook.yml\"\n    extra_arguments = [\"--extra-vars\", \"\\\"pizza_toppings=${var.topping}\\\"\"]\n  }\n}\n```\n\n**JSON**\n\n```json\n{\n  \"builders\": [\n    {\n      \"type\": \"docker\",\n      \"image\": \"williamyeh/ansible:ubuntu14.04\",\n      \"export_path\": \"packer_example\",\n      \"run_command\": [\"-d\", \"-i\", \"-t\", \"--entrypoint=/bin/bash\", \"{{.Image}}\"]\n    }\n  ],\n  \"variables\": {\n    \"topping\": \"mushroom\"\n  },\n  \"provisioners\": [\n    {\n      \"type\": \"ansible-local\",\n      \"playbook_file\": \"./playbook.yml\",\n      \"extra_arguments\": [\n        \"--extra-vars\",\n        \"\\\"pizza_toppings={{ user `topping`}}\\\"\"\n      ]\n    }\n  ]\n}\n```\n\n\nwhere ./playbook.yml contains\n\n```\n---\n- name: hello world\n  hosts: 127.0.0.1\n  connection: local\n\n  tasks:\n    - command: echo {{ pizza_toppings }}\n    - debug: msg=\"{{ pizza_toppings }}\"\n\n```\n\n## Configuration Reference\n\nThe reference of available configuration options is listed below.\n\nRequired:\n\n- `playbook_file` (string) - The playbook file to be executed by ansible.\n  This file must exist on your local system and will be uploaded to the\n  remote machine. This option is exclusive with `playbook_files`.\n\n- `playbook_files` (array of strings) - The playbook files to be executed by\n  ansible. These files must exist on your local system. If the files don't\n  exist in the `playbook_dir` or you don't set `playbook_dir` they will be\n  uploaded to the remote machine. This option is exclusive with\n  `playbook_file`.\n\nOptional:\n\n\u003c!-- Code generated from the comments of the Config struct in provisioner/ansible-local/provisioner.go; DO NOT EDIT MANUALLY --\u003e\n\n- `command` (string) - The command to invoke ansible. Defaults to\n   `ansible-playbook`. If you would like to provide a more complex command,\n   for example, something that sets up a virtual environment before calling\n   ansible, take a look at the ansible wrapper guide below for inspiration.\n   Please note that Packer expects Command to be a path to an executable.\n   Arbitrary bash scripting will not work and needs to go inside an\n   executable script.\n\n- `extra_arguments` ([]string) - Extra arguments to pass to Ansible.\n  These arguments _will not_ be passed through a shell and arguments should\n  not be quoted. Usage example:\n  \n  ```json\n     \"extra_arguments\": [ \"--extra-vars\", \"Region={{user `Region`}} Stage={{user `Stage`}}\" ]\n  ```\n  \n  In certain scenarios where you want to pass ansible command line arguments\n  that include parameter and value (for example `--vault-password-file pwfile`),\n  from ansible documentation this is correct format but that is NOT accepted here.\n  Instead you need to do it like `--vault-password-file=pwfile`.\n  \n  If you are running a Windows build on AWS, Azure, Google Compute, or OpenStack\n  and would like to access the auto-generated password that Packer uses to\n  connect to a Windows instance via WinRM, you can use the template variable\n  \n  ```build.Password``` in HCL templates or ```{{ build `Password`}}``` in\n  legacy JSON templates. For example:\n  \n  in JSON templates:\n  \n  ```json\n  \"extra_arguments\": [\n     \"--extra-vars\", \"winrm_password={{ build `Password`}}\"\n  ]\n  ```\n  \n  in HCL templates:\n  ```hcl\n  extra_arguments = [\n     \"--extra-vars\", \"winrm_password=${build.Password}\"\n  ]\n  ```\n\n- `group_vars` (string) - A path to the directory containing ansible group\n  variables on your local system to be copied to the remote machine. By\n  default, this is empty.\n\n- `host_vars` (string) - A path to the directory containing ansible host variables on your local\n  system to be copied to the remote machine. By default, this is empty.\n\n- `playbook_dir` (string) - A path to the complete ansible directory structure on your local system\n  to be copied to the remote machine as the `staging_directory` before all\n  other files and directories.\n\n- `playbook_file` (string) - The playbook file to be executed by ansible. This file must exist on your\n  local system and will be uploaded to the remote machine. This option is\n  exclusive with `playbook_files`.\n\n- `playbook_files` ([]string) - The playbook files to be executed by ansible. These files must exist on\n  your local system. If the files don't exist in the `playbook_dir` or you\n  don't set `playbook_dir` they will be uploaded to the remote machine. This\n  option is exclusive with `playbook_file`.\n\n- `playbook_paths` ([]string) - An array of directories of playbook files on your local system. These\n  will be uploaded to the remote machine under `staging_directory`/playbooks.\n  By default, this is empty.\n\n- `role_paths` ([]string) - An array of paths to role directories on your local system. These will be\n  uploaded to the remote machine under `staging_directory`/roles. By default,\n  this is empty.\n\n- `collection_paths` ([]string) - An array of local paths of collections to upload.\n\n- `staging_directory` (string) - The directory where files will be uploaded. Packer requires write\n  permissions in this directory.\n\n- `clean_staging_directory` (bool) - If set to `true`, the content of the `staging_directory` will be removed after\n  executing ansible. By default this is set to `false`.\n\n- `inventory_file` (string) - The inventory file to be used by ansible. This\n  file must exist on your local system and will be uploaded to the remote\n  machine.\n  \n  When using an inventory file, it's also required to `--limit` the hosts to the\n  specified host you're building. The `--limit` argument can be provided in the\n  `extra_arguments` option.\n  \n  An example inventory file may look like:\n  \n  ```text\n  [chi-dbservers]\n  db-01 ansible_connection=local\n  db-02 ansible_connection=local\n  \n  [chi-appservers]\n  app-01 ansible_connection=local\n  app-02 ansible_connection=local\n  \n  [chi:children]\n  chi-dbservers\n  chi-appservers\n  \n  [dbservers:children]\n  chi-dbservers\n  \n  [appservers:children]\n  chi-appservers\n  ```\n\n- `inventory_groups` ([]string) - `inventory_groups` (string) - A comma-separated list of groups to which\n  packer will assign the host `127.0.0.1`. A value of `my_group_1,my_group_2`\n  will generate an Ansible inventory like:\n  \n  ```text\n  [my_group_1]\n  127.0.0.1\n  [my_group_2]\n  127.0.0.1\n  ```\n\n- `galaxy_file` (string) - A requirements file which provides a way to\n   install roles or collections with the [ansible-galaxy\n   cli](https://docs.ansible.com/ansible/latest/galaxy/user_guide.html#the-ansible-galaxy-command-line-tool)\n   on the local machine before executing `ansible-playbook`. By default, this is empty.\n\n- `galaxy_command` (string) - The command to invoke ansible-galaxy. By default, this is\n  `ansible-galaxy`.\n\n- `galaxy_force_install` (bool) - Force overwriting an existing role.\n   Adds `--force` option to `ansible-galaxy` command. By default, this is\n   `false`.\n\n- `galaxy_roles_path` (string) - The path to the directory on the remote system in which to\n    install the roles. Adds `--roles-path /path/to/your/roles` to\n    `ansible-galaxy` command. By default, this will install to a 'galaxy_roles' subfolder in the\n    staging/roles directory.\n\n- `galaxy_collections_path` (string) - The path to the directory on the remote system in which to\n    install the collections. Adds `--collections-path /path/to/your/collections` to\n    `ansible-galaxy` command. By default, this will install to a 'galaxy_collections' subfolder in the\n    staging/collections directory.\n\n\u003c!-- End of code generated from the comments of the Config struct in provisioner/ansible-local/provisioner.go; --\u003e\n\n\nParameters common to all provisioners:\n\n- `pause_before` (duration) - Sleep for duration before execution.\n\n- `max_retries` (int) - Max times the provisioner will retry in case of failure. Defaults to zero (0). Zero means an error will not be retried.\n\n- `only` (array of string) - Only run the provisioner for listed builder(s)\n  by name.\n\n- `override` (object) - Override the builder with different settings for a\n  specific builder, eg :\n\n  In HCL2:\n\n  ```hcl\n  source \"null\" \"example1\" {\n    communicator = \"none\"\n  }\n\n  source \"null\" \"example2\" {\n    communicator = \"none\"\n  }\n\n  build {\n    sources = [\"source.null.example1\", \"source.null.example2\"]\n    provisioner \"shell-local\" {\n      inline = [\"echo not overridden\"]\n      override = {\n        example1 = {\n          inline = [\"echo yes overridden\"]\n        }\n      }\n    }\n  }\n  ```\n\n  In JSON:\n\n  ```json\n  {\n    \"builders\": [\n      {\n        \"type\": \"null\",\n        \"name\": \"example1\",\n        \"communicator\": \"none\"\n      },\n      {\n        \"type\": \"null\",\n        \"name\": \"example2\",\n        \"communicator\": \"none\"\n      }\n    ],\n    \"provisioners\": [\n      {\n        \"type\": \"shell-local\",\n        \"inline\": [\"echo not overridden\"],\n        \"override\": {\n          \"example1\": {\n            \"inline\": [\"echo yes overridden\"]\n          }\n        }\n      }\n    ]\n  }\n  ```\n\n- `timeout` (duration) - If the provisioner takes more than for example\n  `1h10m1s` or `10m` to finish, the provisioner will timeout and fail.\n\n\n## Default Extra Variables\n\nIn addition to being able to specify extra arguments using the\n`extra_arguments` configuration, the provisioner automatically defines certain\ncommonly useful Ansible variables:\n\n- `packer_build_name` is set to the name of the build that Packer is running.\n  This is most useful when Packer is making multiple builds and you want to\n  distinguish them slightly when using a common playbook.\n\n- `packer_builder_type` is the type of the builder that was used to create\n  the machine that the script is running on. This is useful if you want to\n  run only certain parts of the playbook on systems built with certain\n  builders.\n\n- `packer_http_addr` If using a builder that provides an HTTP server for file\n  transfer (such as `hyperv`, `parallels`, `qemu`, `virtualbox`, and `vmware`), this\n  will be set to the address. You can use this address in your provisioner to\n  download large files over HTTP. This may be useful if you're experiencing\n  slower speeds using the default file provisioner. A file provisioner using\n  the `winrm` communicator may experience these types of difficulties.\n","created_at":"2023-11-27T18:58:19.334Z","updated_at":"2023-11-27T18:58:19.334Z","name":"Ansible Local","slug":"ansible-local","component":{"id":"418417de-2c71-46a1-8dbc-7e9ae777a22e","slug":"provisioner","name":"Provisioner","plural_name":"Provisioners","product_id":"4c2b00c6-7cc1-4e4c-b596-4ab57e319f21","created_at":"2022-11-09T22:56:31.054Z","updated_at":"2022-11-09T22:56:31.054Z"},"variable_groups":[]},{"id":"9a62b63e-3c08-4b3f-adb8-3616fa851e09","integration_release_id":"96ffc6eb-eb8e-4901-b710-bf88921b9095","component_id":"418417de-2c71-46a1-8dbc-7e9ae777a22e","readme":"Type: `ansible`\n\nThe `ansible` Packer provisioner runs Ansible playbooks. It dynamically creates\nan Ansible inventory file configured to use SSH, runs an SSH server, executes\n`ansible-playbook`, and marshals Ansible plays through the SSH server to the\nmachine being provisioned by Packer.\n\n-\u003e **Note:** Any `remote_user` defined in tasks will be ignored. Packer\nwill always connect with the user given in the json config for this\nprovisioner.\n\n-\u003e **Note:** Options below that use the Packer template engine won't be able to\naccept jinja2 `{{ function }}` macro syntax in a way that can be preserved to\nthe Ansible run. If you need to set variables using Ansible macros, you need to\ndo so inside your playbooks or inventory files.\n\nPlease see the [Debugging](#debugging), [Limitations](#limitations), or [Troubleshooting](#troubleshooting) if you are having trouble\ngetting started.\n\n## Basic Example\n\nThis is a fully functional template that will provision an image on\nDigitalOcean. Replace the mock `api_token` value with your own.\n\nExample Packer template:\n\n**HCL2**\n\n```hcl\nsource \"digitalocean\" \"example\"{\n    api_token = \"6a561151587389c7cf8faa2d83e94150a4202da0e2bad34dd2bf236018ffaeeb\"\n    image     = \"ubuntu-20-04-x64\"\n    region    = \"sfo1\"\n}\n\nbuild {\n    sources = [\n        \"source.digitalocean.example\"\n    ]\n\n    provisioner \"ansible\" {\n      playbook_file = \"./playbook.yml\"\n    }\n}\n```\n\n**JSON**\n\n```json\n{\n  \"builders\": [\n    {\n      \"type\": \"digitalocean\",\n      \"api_token\": \"6a561151587389c7cf8faa2d83e94150a4202da0e2bad34dd2bf236018ffaeeb\",\n      \"image\": \"ubuntu-20-04-x64\",\n      \"region\": \"sfo1\"\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"playbook_file\": \"./playbook.yml\"\n    }\n  ]\n}\n```\n\n\nExample playbook:\n\n```yaml\n---\n# playbook.yml\n- name: 'Provision Image'\n  hosts: default\n  become: true\n\n  tasks:\n    - name: install Apache\n      package:\n        name: 'httpd'\n        state: present\n```\n\n## Configuration Reference\n\nRequired Parameters:\n\n\u003c!-- Code generated from the comments of the Config struct in provisioner/ansible/provisioner.go; DO NOT EDIT MANUALLY --\u003e\n\n- `playbook_file` (string) - The playbook to be run by Ansible.\n\n\u003c!-- End of code generated from the comments of the Config struct in provisioner/ansible/provisioner.go; --\u003e\n\n\nOptional Parameters:\n\n\u003c!-- Code generated from the comments of the Config struct in provisioner/ansible/provisioner.go; DO NOT EDIT MANUALLY --\u003e\n\n- `command` (string) - The command to invoke ansible. Defaults to\n   `ansible-playbook`. If you would like to provide a more complex command,\n   for example, something that sets up a virtual environment before calling\n   ansible, take a look at the ansible wrapper guide below for inspiration.\n   Please note that Packer expects Command to be a path to an executable.\n   Arbitrary bash scripting will not work and needs to go inside an\n   executable script.\n\n- `extra_arguments` ([]string) - Extra arguments to pass to Ansible. These arguments _will not_ be passed\n  through a shell and arguments should not be quoted. Usage example:\n  \n  ```json\n     \"extra_arguments\": [ \"--extra-vars\", \"Region={{user `Region`}} Stage={{user `Stage`}}\" ]\n  ```\n  \n  In certain scenarios where you want to pass ansible command line\n  arguments that include parameter and value (for example\n  `--vault-password-file pwfile`), from ansible documentation this is\n  correct format but that is NOT accepted here. Instead you need to do it\n  like `--vault-password-file=pwfile`.\n  \n  If you are running a Windows build on AWS, Azure, Google Compute, or\n  OpenStack and would like to access the auto-generated password that\n  Packer uses to connect to a Windows instance via WinRM, you can use the\n  template variable\n  \n  ```build.Password``` in HCL templates or ```{{ build `Password`}}``` in\n  legacy JSON templates. For example:\n  \n  in JSON templates:\n  \n  ```json\n  \"extra_arguments\": [\n     \"--extra-vars\", \"winrm_password={{ build `Password`}}\"\n  ]\n  ```\n  \n  in HCL templates:\n  \n  ```hcl\n  extra_arguments = [\n     \"--extra-vars\", \"winrm_password=${build.Password}\"\n  ]\n  ```\n  \n  If the lefthand side of a value contains 'secret' or 'password' (case\n  insensitive) it will be hidden from output. For example, passing\n  \"my_password=secr3t\" will hide \"secr3t\" from output.\n\n- `ansible_env_vars` ([]string) - Environment variables to set before\n    running Ansible. Usage example:\n  \n    ```json\n      \"ansible_env_vars\": [ \"ANSIBLE_HOST_KEY_CHECKING=False\", \"ANSIBLE_SSH_ARGS='-o ForwardAgent=yes -o ControlMaster=auto -o ControlPersist=60s'\", \"ANSIBLE_NOCOLOR=True\" ]\n    ```\n  \n    This is a [template engine](/packer/docs/templates/legacy_json_templates/engine). Therefore, you\n    may use user variables and template functions in this field.\n  \n    For example, if you are running a Windows build on AWS, Azure,\n    Google Compute, or OpenStack and would like to access the auto-generated\n    password that Packer uses to connect to a Windows instance via WinRM, you\n    can use the template variable `{{.WinRMPassword}}` in this option. Example:\n  \n    ```json\n    \"ansible_env_vars\": [ \"WINRM_PASSWORD={{.WinRMPassword}}\" ],\n    ```\n\n- `ansible_ssh_extra_args` ([]string) - Specifies --ssh-extra-args on command line defaults to -o IdentitiesOnly=yes\n\n- `groups` ([]string) - The groups into which the Ansible host should\n   be placed. When unspecified, the host is not associated with any groups.\n\n- `empty_groups` ([]string) - The groups which should be present in\n   inventory file but remain empty.\n\n- `host_alias` (string) - The alias by which the Ansible host should be\n  known. Defaults to `default`. This setting is ignored when using a custom\n  inventory file.\n\n- `user` (string) - The `ansible_user` to use. Defaults to the user running\n   packer, NOT the user set for your communicator. If you want to use the same\n   user as the communicator, you will need to manually set it again in this\n   field.\n\n- `local_port` (int) - The port on which to attempt to listen for SSH\n   connections. This value is a starting point. The provisioner will attempt\n   listen for SSH connections on the first available of ten ports, starting at\n   `local_port`. A system-chosen port is used when `local_port` is missing or\n   empty.\n\n- `ssh_host_key_file` (string) - The SSH key that will be used to run the SSH\n   server on the host machine to forward commands to the target machine.\n   Ansible connects to this server and will validate the identity of the\n   server using the system known_hosts. The default behavior is to generate\n   and use a onetime key. Host key checking is disabled via the\n   `ANSIBLE_HOST_KEY_CHECKING` environment variable if the key is generated.\n\n- `ssh_authorized_key_file` (string) - The SSH public key of the Ansible\n   `ssh_user`. The default behavior is to generate and use a onetime key. If\n   this key is generated, the corresponding private key is passed to\n   `ansible-playbook` with the `-e ansible_ssh_private_key_file` option.\n\n- `ansible_proxy_key_type` (string) - Change the key type used for the adapter.\n  \n  Supported values:\n  \n  * ECDSA (default)\n  * RSA\n  \n  NOTE: using RSA may cause problems if the key is used to authenticate with rsa-sha1\n  as modern OpenSSH versions reject this by default as it is unsafe.\n\n- `sftp_command` (string) - The command to run on the machine being\n   provisioned by Packer to handle the SFTP protocol that Ansible will use to\n   transfer files. The command should read and write on stdin and stdout,\n   respectively. Defaults to `/usr/lib/sftp-server -e`.\n\n- `skip_version_check` (bool) - Check if ansible is installed prior to\n   running. Set this to `true`, for example, if you're going to install\n   ansible during the packer run.\n\n- `use_sftp` (bool) - Use SFTP\n\n- `inventory_directory` (string) - The directory in which to place the\n   temporary generated Ansible inventory file. By default, this is the\n   system-specific temporary file location. The fully-qualified name of this\n   temporary file will be passed to the `-i` argument of the `ansible` command\n   when this provisioner runs ansible. Specify this if you have an existing\n   inventory directory with `host_vars` `group_vars` that you would like to\n   use in the playbook that this provisioner will run.\n\n- `inventory_file_template` (string) - This template represents the format for the lines added to the temporary\n  inventory file that Packer will create to run Ansible against your image.\n  The default for recent versions of Ansible is:\n  \"{{ .HostAlias }} ansible_host={{ .Host }} ansible_user={{ .User }} ansible_port={{ .Port }}\\n\"\n  Available template engines are: This option is a template engine;\n  variables available to you include the examples in the default (Host,\n  HostAlias, User, Port) as well as any variables available to you via the\n  \"build\" template engine.\n\n- `inventory_file` (string) - The inventory file to use during provisioning.\n   When unspecified, Packer will create a temporary inventory file and will\n   use the `host_alias`.\n\n- `keep_inventory_file` (bool) - If `true`, the Ansible provisioner will\n   not delete the temporary inventory file it creates in order to connect to\n   the instance. This is useful if you are trying to debug your ansible run\n   and using \"--on-error=ask\" in order to leave your instance running while you\n   test your playbook. this option is not used if you set an `inventory_file`.\n\n- `galaxy_file` (string) - A requirements file which provides a way to\n   install roles or collections with the [ansible-galaxy\n   cli](https://docs.ansible.com/ansible/latest/galaxy/user_guide.html#the-ansible-galaxy-command-line-tool)\n   on the local machine before executing `ansible-playbook`. By default, this is empty.\n\n- `galaxy_command` (string) - The command to invoke ansible-galaxy. By default, this is\n  `ansible-galaxy`.\n\n- `galaxy_force_install` (bool) - Force overwriting an existing role.\n   Adds `--force` option to `ansible-galaxy` command. By default, this is\n   `false`.\n\n- `galaxy_force_with_deps` (bool) - Force overwriting an existing role and its dependencies.\n   Adds `--force-with-deps` option to `ansible-galaxy` command. By default,\n   this is `false`.\n\n- `roles_path` (string) - The path to the directory on your local system in which to\n    install the roles. Adds `--roles-path /path/to/your/roles` to\n    `ansible-galaxy` command. By default, this is empty, and thus `--roles-path`\n    option is not added to the command.\n\n- `collections_path` (string) - The path to the directory on your local system in which to\n    install the collections. Adds `--collections-path /path/to/your/collections` to\n    `ansible-galaxy` command. By default, this is empty, and thus `--collections-path`\n    option is not added to the command.\n\n- `use_proxy` (boolean) - When `true`, set up a localhost proxy adapter\n  so that Ansible has an IP address to connect to, even if your guest does not\n  have an IP address. For example, the adapter is necessary for Docker builds\n  to use the Ansible provisioner. If you set this option to `false`, but\n  Packer cannot find an IP address to connect Ansible to, it will\n  automatically set up the adapter anyway.\n  \n   In order for Ansible to connect properly even when use_proxy is false, you\n  need to make sure that you are either providing a valid username and ssh key\n  to the ansible provisioner directly, or that the username and ssh key\n  being used by the ssh communicator will work for your needs. If you do not\n  provide a user to ansible, it will use the user associated with your\n  builder, not the user running Packer.\n   use_proxy=false is currently only supported for SSH and WinRM.\n  \n  Currently, this defaults to `true` for all connection types. In the future,\n  this option will be changed to default to `false` for SSH and WinRM\n  connections where the provisioner has access to a host IP.\n\n- `ansible_winrm_use_http` (bool) - Force WinRM to use HTTP instead of HTTPS.\n  \n  Set this to true to force Ansible to use HTTP instead of HTTPS to communicate\n  over WinRM to the destination host.\n  \n  Ansible uses the port as a heuristic to determine whether to use HTTP\n  or not. In the current state, Packer assigns a random port for connecting\n  to WinRM and Ansible's heuristic fails to determine that it should be\n  using HTTP, even when the communicator is setup to use it.\n  \n  Alternatively, you may also directly add the following arguments to the\n  `extra_arguments` section for ansible: `\"-e\", \"ansible_winrm_scheme=http\"`.\n  \n  Default: `false`\n\n\u003c!-- End of code generated from the comments of the Config struct in provisioner/ansible/provisioner.go; --\u003e\n\n\nParameters common to all provisioners:\n\n- `pause_before` (duration) - Sleep for duration before execution.\n\n- `max_retries` (int) - Max times the provisioner will retry in case of failure. Defaults to zero (0). Zero means an error will not be retried.\n\n- `only` (array of string) - Only run the provisioner for listed builder(s)\n  by name.\n\n- `override` (object) - Override the builder with different settings for a\n  specific builder, eg :\n\n  In HCL2:\n\n  ```hcl\n  source \"null\" \"example1\" {\n    communicator = \"none\"\n  }\n\n  source \"null\" \"example2\" {\n    communicator = \"none\"\n  }\n\n  build {\n    sources = [\"source.null.example1\", \"source.null.example2\"]\n    provisioner \"shell-local\" {\n      inline = [\"echo not overridden\"]\n      override = {\n        example1 = {\n          inline = [\"echo yes overridden\"]\n        }\n      }\n    }\n  }\n  ```\n\n  In JSON:\n\n  ```json\n  {\n    \"builders\": [\n      {\n        \"type\": \"null\",\n        \"name\": \"example1\",\n        \"communicator\": \"none\"\n      },\n      {\n        \"type\": \"null\",\n        \"name\": \"example2\",\n        \"communicator\": \"none\"\n      }\n    ],\n    \"provisioners\": [\n      {\n        \"type\": \"shell-local\",\n        \"inline\": [\"echo not overridden\"],\n        \"override\": {\n          \"example1\": {\n            \"inline\": [\"echo yes overridden\"]\n          }\n        }\n      }\n    ]\n  }\n  ```\n\n- `timeout` (duration) - If the provisioner takes more than for example\n  `1h10m1s` or `10m` to finish, the provisioner will timeout and fail.\n\n\n## Default Extra Variables\n\nIn addition to being able to specify extra arguments using the\n`extra_arguments` configuration, the provisioner automatically defines certain\ncommonly useful Ansible variables:\n\n- `packer_build_name` is set to the name of the build that Packer is running.\n  This is most useful when Packer is making multiple builds and you want to\n  distinguish them slightly when using a common playbook.\n\n- `packer_builder_type` is the type of the builder that was used to create\n  the machine that the script is running on. This is useful if you want to\n  run only certain parts of the playbook on systems built with certain\n  builders.\n\n- `packer_http_addr` If using a builder that provides an HTTP server for file\n  transfer (such as `hyperv`, `parallels`, `qemu`, `virtualbox`, and `vmware`), this\n  will be set to the address. You can use this address in your provisioner to\n  download large files over HTTP. This may be useful if you're experiencing\n  slower speeds using the default file provisioner. A file provisioner using\n  the `winrm` communicator may experience these types of difficulties.\n\n## Debugging\n\nTo debug underlying issues with Ansible, add `\"-vvvv\"` to `\"extra_arguments\"`\nto enable verbose logging.\n\n**HCL2**\n\n```hcl\n  extra_arguments = [ \"-vvvv\" ]\n```\n\n**JSON**\n\n```json\n  \"extra_arguments\": [ \"-vvvv\" ]\n```\n\n\n## Limitations\n\n### Redhat / CentOS\n\nRedhat / CentOS builds have been known to fail with the following error due to\n`sftp_command`, which should be set to `/usr/libexec/openssh/sftp-server -e`:\n\n```text\n==\u003e virtualbox-ovf: starting sftp subsystem\n    virtualbox-ovf: fatal: [default]: UNREACHABLE! =\u003e {\"changed\": false, \"msg\": \"SSH Error: data could not be sent to the remote host. Make sure this host can be reached over ssh\", \"unreachable\": true}\n```\n\n### chroot communicator\n\nBuilding within a chroot (e.g. `amazon-chroot`) requires changing the Ansible\nconnection to chroot and running Ansible as root/sudo.\n\n**HCL2**\n\n```hcl\nsource \"amazon-chroot\" \"example\" {\n  mount_path = \"/mnt/packer-amazon-chroot\"\n  region     = \"us-east-1\"\n  source_ami = \"ami-123456\"\n}\n\nbuild {\n  sources = [\n    \"source.amazon-chroot.example\"\n  ]\n\n  provisioner \"ansible\" {\n    extra_arguments = [\n        \"--connection=chroot\",\n        \"--inventory-file=/mnt/packer-amazon-chroot\"\n      ]\n\n    playbook_file = \"main.yml\"\n  }\n}\n```\n\n**JSON**\n\n```json\n{\n  \"builders\": [\n    {\n      \"type\": \"amazon-chroot\",\n      \"mount_path\": \"/mnt/packer-amazon-chroot\",\n      \"region\": \"us-east-1\",\n      \"source_ami\": \"ami-123456\"\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"extra_arguments\": [\n        \"--connection=chroot\",\n        \"--inventory-file=/mnt/packer-amazon-chroot\"\n      ],\n      \"playbook_file\": \"main.yml\"\n    }\n  ]\n}\n```\n\n\n### WinRM Communicator\n\nThere are two possible methods for using Ansible with the WinRM communicator.\n\nPlease note that if you're having trouble getting Ansible to connect, you may\nwant to take a look at the script that the Ansible project provides to help\nconfigure remoting for Ansible:\nhttps://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1\n\n#### Method 1 (recommended)\n\nThe recommended way to use the WinRM communicator is to set `\"use_proxy\": false`\nand let the Ansible provisioner handle the rest for you. If you\nare using WinRM with HTTPS, and you are using a self-signed certificate you\nwill also have to set `ansible_winrm_server_cert_validation=ignore` in your\nextra_arguments.\n\nBelow is a fully functioning Ansible example for amazon-ebs using WinRM:\n\n```hcl\n\nvariable \"aws_region\"{\n  type    = string\n  default = \"us-east-1\"\n}\n\nvariable \"aws_access_key\"{\n  type = string\n}\n\nvariable \"aws_secret_key\"{\n  type = string\n}\n\ndata \"amazon-ami\" \"windows\" {\n\n  filters = {\n    name                = \"*Windows_Server-2012*English-64Bit-Base*\"\n    root-device-type    = \"ebs\"\n    virtualization-type = \"hvm\"\n  }\n\n  most_recent = true\n  owners      = [\"099720109477\"]\n\n  region      = var.aws_region\n  access_key  = var.aws_access_key\n  secret_key  = var.aws_secret_key\n}\n\nsource \"amazon-ebs\" \"example\" {\n    region      = var.aws_region\n    instance_type = \"t2.micro\"\n\n    source_ami       = data.amazon-ami.windows.id\n\n    ami_name         = \"test-ansible-packer\"\n    user_data_file   = \"windows_bootstrap.txt\"\n    communicator     = \"winrm\"\n    force_deregister = true\n    winrm_username   = \"Administrator\"\n    winrm_insecure   = true\n    winrm_use_ssl    = true\n}\n\nbuild {\n    sources = [\n        \"source.amazon-ebs.example\",\n    ]\n\n    provisioner \"ansible\" {\n      playbook_file   = \"./playbooks/playbook-windows.yml\"\n      user            = \"Administrator\"\n      use_proxy       = false\n      extra_arguments = [\n        \"-e\",\n        \"ansible_winrm_server_cert_validation=ignore\"\n      ]\n    }\n}\n```\n\nBelow is a fully functioning Ansible example for azure-arm using WinRM.\nNote: pywinrm needs to be installed into the python environment on your local build machine if it's not already installed.\nNote: The ConfigureRemotingForAnsible.ps1 script can be found here https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1.\n\n**HCL2**\n\n```hcl\nsource \"azure-arm\" \"server_2019\" {\n  use_azure_cli_auth                               = true\n  build_resource_group_name                        = \"ManagedImages-RGP\"\n  build_key_vault_name                             = \"Example-Packer-Keyvault\"\n  os_type                                          = \"Windows\"\n  image_publisher                                  = \"MicrosoftWindowsServer\"\n  image_offer                                      = \"WindowsServer\"\n  image_sku                                        = \"2019-Datacenter\"\n  vm_size                                          = \"Standard_D2as_v5\"\n  os_disk_size_gb                                  = 130\n  shared_gallery_image_version_exclude_from_latest = false\n  virtual_network_resource_group_name              = \"VNET-Resource-Group\"\n  virtual_network_name                             = \"My-VNET\"\n  virtual_network_subnet_name                      = \"My-Subnet\"\n  private_virtual_network_with_public_ip           = false\n  communicator                                     = \"winrm\"\n  winrm_use_ssl                                    = true\n  winrm_insecure                                   = true\n  winrm_timeout                                    = \"3m\"\n  winrm_username                                   = \"Packer\"\n  managed_image_name                               = \"Managed-Image-Name\"\n  managed_image_resource_group_name                = \"ManagedImages-RGP\"\n  managed_image_storage_account_type               = \"Standard_LRS\"\n\n  shared_image_gallery_destination {\n    resource_group       = \"ManagedImages-RGP\"\n    gallery_name         = \"MyGallery\"\n    image_name           = \"Server2019\"\n    storage_account_type = \"Standard_LRS\"\n  }\n}\n\nbuild {\n  sources = [\n    \"sources.azure-arm.server_2019\",\n  ]\n\n  provisioner \"shell-local\" {\n    inline_shebang = \"/bin/bash -e\"\n    inline = [\n      \"pipx inject python-env-name \\\"pywinrm\\\"\",\n    ]\n  }\n\n  provisioner \"powershell\" {\n    script = \"../../scripts/ConfigureRemotingForAnsible.ps1\"\n  }\n\n  provisioner \"ansible\" {\n    skip_version_check  = false\n    user                = \"Packer\"\n    use_proxy           = false\n    playbook_file       = \"windows2019.yml\"\n    extra_arguments = [\n      \"-e\",\n      \"ansible_winrm_server_cert_validation=ignore\",\n      \"-e\",\n      \"ansible_winrm_transport=ntlm\",\n    ]\n  }\n```\n\n**JSON**\n\n```json\n{\n  \"builders\": [\n    {\n      \"type\": \"amazon-ebs\",\n      \"region\": \"us-east-1\",\n      \"instance_type\": \"t2.micro\",\n      \"source_ami_filter\": {\n        \"filters\": {\n          \"virtualization-type\": \"hvm\",\n          \"name\": \"*Windows_Server-2012*English-64Bit-Base*\",\n          \"root-device-type\": \"ebs\"\n        },\n        \"most_recent\": true,\n        \"owners\": \"amazon\"\n      },\n      \"ami_name\": \"test-ansible-packer\",\n      \"user_data_file\": \"windows_bootstrap.txt\",\n      \"communicator\": \"winrm\",\n      \"force_deregister\": true,\n      \"winrm_insecure\": true,\n      \"winrm_username\": \"Administrator\",\n      \"winrm_use_ssl\": true\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"playbook_file\": \"./playbook.yml\",\n      \"user\": \"Administrator\",\n      \"use_proxy\": false,\n      \"extra_arguments\": [\"-e\", \"ansible_winrm_server_cert_validation=ignore\"]\n    }\n  ]\n}\n```\n\n\nNote that you do have to set the \"Administrator\" user, because otherwise Ansible\nwill default to using the user that is calling Packer, rather than the user\nconfigured inside of the Packer communicator. For the contents of\nwindows_bootstrap.txt, see the WinRM docs for the amazon-ebs communicator.\n\nWhen running from OSX, you may see an error like:\n\n```text\n    amazon-ebs: objc[9752]: +[__NSCFConstantString initialize] may have been in progress in another thread when fork() was called.\n    amazon-ebs: objc[9752]: +[__NSCFConstantString initialize] may have been in progress in another thread when fork() was called. We cannot safely call it or ignore it in the fork() child process. Crashing instead. Set a breakpoint on objc_initializeAfterForkError to debug.\n    amazon-ebs: ERROR! A worker was found in a dead state\n```\n\nIf you see this, you may be able to work around the issue by telling Ansible to\nexplicitly not use any proxying; you can do this by setting the template option\n\n**HCL2**\n\n```hcl\nansible_env_vars = [\"no_proxy=\\\"*\\\"\"]\n```\n\n**JSON**\n\n```json\n\"ansible_env_vars\": [\"no_proxy=\\\"*\\\"\"],\n```\n\n\nin the above Ansible template.\n\n#### Method 2 (Not recommended)\n\nIf you want to use the Packer SSH proxy, then you need a custom Ansible\nconnection plugin and a particular configuration. You need a directory named\n`connection_plugins` next to the playbook which contains a file named\npacker.py` which implements the connection plugin. On versions of Ansible\nbefore 2.4.x, the following works as the connection plugin:\n\n```python\nfrom __future__ import (absolute_import, division, print_function)\n__metaclass__ = type\n\nfrom ansible.plugins.connection.ssh import Connection as SSHConnection\n\nclass Connection(SSHConnection):\n    ''' ssh based connections for powershell via packer'''\n\n    transport = 'packer'\n    has_pipelining = True\n    become_methods = []\n    allow_executable = False\n    module_implementation_preferences = ('.ps1', '')\n\n    def __init__(self, *args, **kwargs):\n        super(Connection, self).__init__(*args, **kwargs)\n```\n\nNewer versions of Ansible require all plugins to have a documentation string.\nYou can see if there is a plugin available for the version of Ansible you are\nusing\n[here](https://github.com/hashicorp/packer/tree/master/provisioner/ansible/examples/connection-plugin).\n\nTo create the plugin yourself, you will need to copy all of the `options` from\nthe `DOCUMENTATION` string from the [ssh.py Ansible connection\nplugin](https://github.com/ansible/ansible/blob/devel/lib/ansible/plugins/connection/ssh.py)\nof the Ansible version you are using and add it to a packer.py file similar to\nas follows\n\n```python\nfrom __future__ import (absolute_import, division, print_function)\n__metaclass__ = type\n\nfrom ansible.plugins.connection.ssh import Connection as SSHConnection\n\nDOCUMENTATION = '''\n    connection: packer\n    short_description: ssh based connections for powershell via packer\n    description:\n        - This connection plugin allows ansible to communicate to the target packer machines via ssh based connections for powershell.\n    author: Packer\n    version_added: na\n    options:\n      **** Copy ALL the options from\n      https://github.com/ansible/ansible/blob/devel/lib/ansible/plugins/connection/ssh.py\n      for the version of Ansible you are using ****\n'''\n\nclass Connection(SSHConnection):\n    ''' ssh based connections for powershell via packer'''\n\n    transport = 'packer'\n    has_pipelining = True\n    become_methods = []\n    allow_executable = False\n    module_implementation_preferences = ('.ps1', '')\n\n    def __init__(self, *args, **kwargs):\n        super(Connection, self).__init__(*args, **kwargs)\n```\n\nThis template should build a Windows Server 2012 image on Google Cloud\nPlatform:\n\n```json\n{\n  \"variables\": {},\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"playbook_file\": \"./win-playbook.yml\",\n      \"extra_arguments\": [\n        \"--connection\",\n        \"packer\",\n        \"--extra-vars\",\n        \"\\\"ansible_shell_type=powershell ansible_shell_executable=None\\\"\"\n      ]\n    }\n  ],\n  \"builders\": [\n    {\n      \"type\": \"googlecompute\",\n      \"account_file\": \"{{ user `account_file`}}\",\n      \"project_id\": \"{{user `project_id`}}\",\n      \"source_image\": \"windows-server-2012-r2-dc-v20160916\",\n      \"communicator\": \"winrm\",\n      \"zone\": \"us-central1-a\",\n      \"disk_size\": 50,\n      \"winrm_username\": \"packer\",\n      \"winrm_use_ssl\": true,\n      \"winrm_insecure\": true,\n      \"metadata\": {\n        \"sysprep-specialize-script-cmd\": \"winrm set winrm/config/service/auth @{Basic=\\\"true\\\"}\"\n      }\n    }\n  ]\n}\n```\n\n-\u003e **Warning:** Please note that if you're setting up WinRM for provisioning, you'll probably want to turn it off or restrict its permissions as part of a shutdown script at the end of Packer's provisioning process. For more details on the why/how, check out this useful blog post and the associated code:\nhttps://cloudywindows.io/post/winrm-for-provisioning-close-the-door-on-the-way-out-eh/\n\n### Post i/o timeout errors\n\nIf you see\n`unknown error: Post http://\u003cip\u003e:\u003cport\u003e/wsman:dial tcp \u003cip\u003e:\u003cport\u003e: i/o timeout`\nerrors while provisioning a Windows machine, try setting Ansible to copy files\nover [ssh instead of\nsftp](https://docs.ansible.com/ansible/latest/reference_appendices/config.html#envvar-ANSIBLE_SCP_IF_SSH).\n\n### Too many SSH keys\n\nSSH servers only allow you to attempt to authenticate a certain number of\ntimes. All of your loaded keys will be tried before the dynamically generated\nkey. If you have too many SSH keys loaded in your `ssh-agent`, the Ansible\nprovisioner may fail authentication with a message similar to this:\n\n```text\n    googlecompute: fatal: [default]: UNREACHABLE! =\u003e {\"changed\": false, \"msg\": \"Failed to connect to the host via ssh: Warning: Permanently added '[127.0.0.1]:62684' (RSA) to the list of known hosts.\\r\\nReceived disconnect from 127.0.0.1 port 62684:2: too many authentication failures\\r\\nAuthentication failed.\\r\\n\", \"unreachable\": true}\n```\n\nTo unload all keys from your `ssh-agent`, run:\n\n```shell-session\n$ ssh-add -D\n```\n\n### Become: yes\n\nWe recommend against running Packer as root; if you do then you won't be able\nto successfully run your Ansible playbook as root; `become: yes` will fail.\n\n### Using a wrapping script for your Ansible call\n\nSometimes, you may have extra setup that needs to be called as part of your\nansible run. The easiest way to do this is by writing a small bash script and\nusing that bash script in your `command` in place of the default\n`ansible-playbook`. For example, you may need to launch a Python `virtualenv`\nbefore calling Ansible. To do this, you'd want to create a bash script like\n\n```shell\n#!/bin/bash\nsource /tmp/venv/bin/activate \u0026\u0026 ANSIBLE_FORCE_COLOR=1 PYTHONUNBUFFERED=1 /tmp/venv/bin/ansible-playbook \"$@\"\n```\n\nThe Ansible provisioner template remains very simple. For example:\n\n**HCL2**\n\n```hcl\nprovisioner \"ansible\" {\n  command       = \"/Path/To/call_ansible.sh\"\n  playbook_file = \"./playbook.yml\"\n}\n```\n\n**JSON**\n\n```json\n{\n  \"type\": \"ansible\",\n  \"command\": \"/Path/To/call_ansible.sh\",\n  \"playbook_file\": \"./playbook.yml\"\n}\n```\n\n\nNote that we're calling ansible-playbook at the end of this command and passing\nall command line arguments through into this call; this is necessary for\nmaking sure that --extra-vars and other important Ansible arguments get set.\nNote the quoting around the bash array, too; if you don't use quotes, any\narguments with spaces will not be read properly.\n\n## Docker\n\nWhen trying to use Ansible with Docker, it should \"just work\" but if it doesn't\nyou may need to tweak a few options.\n\n- Change the ansible_connection from \"ssh\" to \"docker\"\n- Set a Docker container name via the --name option.\n\nOn a CI server you probably want to overwrite ansible_host with a random name.\n\nExample Packer template:\n\n**HCL2**\n\n```hcl\nvariable \"ansible_host\" {\n  default = \"default\"\n}\n\nvariable \"ansible_connection\" {\n  default = \"docker\"\n}\n\nsource \"docker\" \"example\" {\n      image       = \"centos:7\"\n      commit      = true\n      run_command = [ \"-d\", \"-i\", \"-t\", \"--name\", var.ansible_host, \"{{.Image}}\", \"/bin/bash\" ]\n}\n\nbuild {\n  sources = [\n    \"source.docker.example\"\n  ]\n\n  provisioner \"ansible\" {\n      groups          = [ \"webserver\" ]\n      playbook_file   = \"./webserver.yml\"\n      extra_arguments = [\n          \"--extra-vars\",\n          \"ansible_host=${var.ansible_host} ansible_connection=${var.ansible_connection}\"\n      ]\n  }\n}\n```\n\n**JSON**\n\n```json\n{\n  \"variables\": {\n    \"ansible_host\": \"default\",\n    \"ansible_connection\": \"docker\"\n  },\n  \"builders\": [\n    {\n      \"type\": \"docker\",\n      \"image\": \"centos:7\",\n      \"commit\": true,\n      \"run_command\": [\n        \"-d\",\n        \"-i\",\n        \"-t\",\n        \"--name\",\n        \"{{user `ansible_host`}}\",\n        \"{{.Image}}\",\n        \"/bin/bash\"\n      ]\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"groups\": [\"webserver\"],\n      \"playbook_file\": \"./webserver.yml\",\n      \"extra_arguments\": [\n        \"--extra-vars\",\n        \"ansible_host={{user `ansible_host`}} ansible_connection={{user `ansible_connection`}}\"\n      ]\n    }\n  ]\n}\n```\n\n\nExample playbook:\n\n```yaml\n- name: configure webserver\n  hosts: webserver\n  tasks:\n    - name: install Apache\n      yum:\n        name: httpd\n```\n\n## Amazon Session Manager\n\nWhen trying to use Ansible with Amazon's Session Manager, you may run into an error where Ansible\nis unable to connect to the remote Amazon instance if the local proxy adapter for Ansible [use_proxy](#use_proxy) is false.\n\nThe error may look something like the following:\n\n```\namazon-ebs: fatal: [default]: UNREACHABLE! =\u003e {\"changed\": false, \"msg\": \"Failed to connect to the host via ssh: ssh: connect to host 127.0.0.1 port 8362: Connection timed out\", \"unreachable\": true}\n```\n\nThe error is caused by a limitation on using Amazon's SSM default Port Forwarding session which only allows for one\nremote connection on the forwarded port. Since Ansible's SSH communication is not using the local proxy adapter\nit will try to make a new SSH connection to the same forwarded localhost port and fail.\n\nIn order to workaround this issue Ansible can be configured via a custom inventory file to use the AWS session-manager-plugin\ndirectly to create a new session, separate from the one created by Packer, at runtime to connect and remotely provision the instance.\n\n-\u003e **Warning:** Please note that the default region configured for the `aws` cli must match the build region where the instance is being\nprovisioned otherwise you may run into a TargetNotConnected error. Users can use `AWS_DEFAULT_REGION` to temporarily override\ntheir configured region.\n\n**HCL2**\n\n```hcl\n  provisioner \"ansible\" {\n      use_proxy               =  false\n      playbook_file           =  \"./playbooks/playbook_remote.yml\"\n      ansible_env_vars        =  [\"PACKER_BUILD_NAME={{ build_name }}\"]\n      inventory_file_template =  \"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\"sh -c \\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\"\\\"'\\n\"\n  }\n```\n\n**JSON**\n\n```json\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"use_proxy\": false,\n      \"ansible_env_vars\": [\"PACKER_BUILD_NAME={{ build_name }}\"],\n      \"playbook_file\":   \"./playbooks/playbook_remote.yml\",\n      \"inventory_file_template\": \"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\"sh -c \\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\"\\\"'\\n\"\n    }\n  ]\n```\n\n\nFull Packer template example:\n\n**HCL2**\n\n```hcl\n\nvariables {\n  instance_role = \"SSMInstanceProfile\"\n}\n\nsource \"amazon-ebs\" \"ansible-example\" {\n  region        = \"us-east-1\"\n  ami_name      = \"packer-ami-ansible\"\n  instance_type = \"t2.micro\"\n\n  source_ami_filter {\n      filters = {\n          name                = \"ubuntu/images/*ubuntu-xenial-16.04-amd64-server-*\"\n          virtualization-type = \"hvm\"\n          root-device-type    = \"ebs\"\n      }\n      owners      = [ \"099720109477\" ]\n      most_recent =  true\n  }\n  communicator         = \"ssh\"\n  ssh_username         = \"ubuntu\"\n  ssh_interface        = \"session_manager\"\n  iam_instance_profile = var.instance_role\n}\n\nbuild {\n  sources = [\"source.amazon-ebs.ansible-example\"]\n\n  provisioner \"ansible\" {\n      use_proxy               =  false\n      playbook_file           =    \"./playbooks/playbook_remote.yml\"\n      ansible_env_vars        =  [\"PACKER_BUILD_NAME={{ build_name }}\"]\n      inventory_file_template =  \"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\"sh -c \\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\"\\\"'\\n\"\n    }\n}\n```\n\n**JSON**\n\n```json\n{\n  \"variables\": {\n    \"instance_role\": \"SSMInstanceProfile\"\n  },\n\n  \"builders\": [\n    {\n      \"type\": \"amazon-ebs\",\n      \"region\": \"us-east-1\",\n      \"ami_name\": \"packer-ami-ansible\",\n      \"instance_type\": \"t2.micro\",\n      \"source_ami_filter\": {\n        \"filters\": {\n          \"virtualization-type\": \"hvm\",\n          \"name\": \"ubuntu/images/*ubuntu-xenial-16.04-amd64-server-*\",\n          \"root-device-type\": \"ebs\"\n        },\n        \"owners\": [\"099720109477\"],\n        \"most_recent\": true\n      },\n      \"communicator\": \"ssh\",\n      \"ssh_username\": \"ubuntu\",\n      \"ssh_interface\": \"session_manager\",\n      \"iam_instance_profile\": \"{{user `instance_role`}}\"\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"use_proxy\": false,\n      \"ansible_env_vars\": [\"PACKER_BUILD_NAME={{ build_name }}\"],\n      \"playbook_file\": \"./playbooks/playbook_remote.yml\",\n      \"inventory_file_template\": \"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\"sh -c \\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\"\\\"'\\n\"\n    }\n  ]\n}\n```\n\n\n## Troubleshooting\n\nIf you are using an Ansible version \u003e= 2.8 and Packer hangs in the\n\"Gathering Facts\" stage, this could be the result of a pipelineing issue with\nthe proxy adapter that Packer uses. Setting `use_proxy` to `false` in the ansible\nprovisioner block of your Packer config should resolve the issue. In the future\nwe will default to setting this, so you won't have to but for now it is a manual\nchange you must make.\n","created_at":"2023-11-27T18:58:19.695Z","updated_at":"2023-11-27T18:58:19.695Z","name":"Ansible","slug":"ansible","component":{"id":"418417de-2c71-46a1-8dbc-7e9ae777a22e","slug":"provisioner","name":"Provisioner","plural_name":"Provisioners","product_id":"4c2b00c6-7cc1-4e4c-b596-4ab57e319f21","created_at":"2022-11-09T22:56:31.054Z","updated_at":"2022-11-09T22:56:31.054Z"},"variable_groups":[]}]},"component":{"id":"9a62b63e-3c08-4b3f-adb8-3616fa851e09","integration_release_id":"96ffc6eb-eb8e-4901-b710-bf88921b9095","component_id":"418417de-2c71-46a1-8dbc-7e9ae777a22e","readme":"Type: `ansible`\n\nThe `ansible` Packer provisioner runs Ansible playbooks. It dynamically creates\nan Ansible inventory file configured to use SSH, runs an SSH server, executes\n`ansible-playbook`, and marshals Ansible plays through the SSH server to the\nmachine being provisioned by Packer.\n\n-\u003e **Note:** Any `remote_user` defined in tasks will be ignored. Packer\nwill always connect with the user given in the json config for this\nprovisioner.\n\n-\u003e **Note:** Options below that use the Packer template engine won't be able to\naccept jinja2 `{{ function }}` macro syntax in a way that can be preserved to\nthe Ansible run. If you need to set variables using Ansible macros, you need to\ndo so inside your playbooks or inventory files.\n\nPlease see the [Debugging](#debugging), [Limitations](#limitations), or [Troubleshooting](#troubleshooting) if you are having trouble\ngetting started.\n\n## Basic Example\n\nThis is a fully functional template that will provision an image on\nDigitalOcean. Replace the mock `api_token` value with your own.\n\nExample Packer template:\n\n**HCL2**\n\n```hcl\nsource \"digitalocean\" \"example\"{\n    api_token = \"6a561151587389c7cf8faa2d83e94150a4202da0e2bad34dd2bf236018ffaeeb\"\n    image     = \"ubuntu-20-04-x64\"\n    region    = \"sfo1\"\n}\n\nbuild {\n    sources = [\n        \"source.digitalocean.example\"\n    ]\n\n    provisioner \"ansible\" {\n      playbook_file = \"./playbook.yml\"\n    }\n}\n```\n\n**JSON**\n\n```json\n{\n  \"builders\": [\n    {\n      \"type\": \"digitalocean\",\n      \"api_token\": \"6a561151587389c7cf8faa2d83e94150a4202da0e2bad34dd2bf236018ffaeeb\",\n      \"image\": \"ubuntu-20-04-x64\",\n      \"region\": \"sfo1\"\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"playbook_file\": \"./playbook.yml\"\n    }\n  ]\n}\n```\n\n\nExample playbook:\n\n```yaml\n---\n# playbook.yml\n- name: 'Provision Image'\n  hosts: default\n  become: true\n\n  tasks:\n    - name: install Apache\n      package:\n        name: 'httpd'\n        state: present\n```\n\n## Configuration Reference\n\nRequired Parameters:\n\n\u003c!-- Code generated from the comments of the Config struct in provisioner/ansible/provisioner.go; DO NOT EDIT MANUALLY --\u003e\n\n- `playbook_file` (string) - The playbook to be run by Ansible.\n\n\u003c!-- End of code generated from the comments of the Config struct in provisioner/ansible/provisioner.go; --\u003e\n\n\nOptional Parameters:\n\n\u003c!-- Code generated from the comments of the Config struct in provisioner/ansible/provisioner.go; DO NOT EDIT MANUALLY --\u003e\n\n- `command` (string) - The command to invoke ansible. Defaults to\n   `ansible-playbook`. If you would like to provide a more complex command,\n   for example, something that sets up a virtual environment before calling\n   ansible, take a look at the ansible wrapper guide below for inspiration.\n   Please note that Packer expects Command to be a path to an executable.\n   Arbitrary bash scripting will not work and needs to go inside an\n   executable script.\n\n- `extra_arguments` ([]string) - Extra arguments to pass to Ansible. These arguments _will not_ be passed\n  through a shell and arguments should not be quoted. Usage example:\n  \n  ```json\n     \"extra_arguments\": [ \"--extra-vars\", \"Region={{user `Region`}} Stage={{user `Stage`}}\" ]\n  ```\n  \n  In certain scenarios where you want to pass ansible command line\n  arguments that include parameter and value (for example\n  `--vault-password-file pwfile`), from ansible documentation this is\n  correct format but that is NOT accepted here. Instead you need to do it\n  like `--vault-password-file=pwfile`.\n  \n  If you are running a Windows build on AWS, Azure, Google Compute, or\n  OpenStack and would like to access the auto-generated password that\n  Packer uses to connect to a Windows instance via WinRM, you can use the\n  template variable\n  \n  ```build.Password``` in HCL templates or ```{{ build `Password`}}``` in\n  legacy JSON templates. For example:\n  \n  in JSON templates:\n  \n  ```json\n  \"extra_arguments\": [\n     \"--extra-vars\", \"winrm_password={{ build `Password`}}\"\n  ]\n  ```\n  \n  in HCL templates:\n  \n  ```hcl\n  extra_arguments = [\n     \"--extra-vars\", \"winrm_password=${build.Password}\"\n  ]\n  ```\n  \n  If the lefthand side of a value contains 'secret' or 'password' (case\n  insensitive) it will be hidden from output. For example, passing\n  \"my_password=secr3t\" will hide \"secr3t\" from output.\n\n- `ansible_env_vars` ([]string) - Environment variables to set before\n    running Ansible. Usage example:\n  \n    ```json\n      \"ansible_env_vars\": [ \"ANSIBLE_HOST_KEY_CHECKING=False\", \"ANSIBLE_SSH_ARGS='-o ForwardAgent=yes -o ControlMaster=auto -o ControlPersist=60s'\", \"ANSIBLE_NOCOLOR=True\" ]\n    ```\n  \n    This is a [template engine](/packer/docs/templates/legacy_json_templates/engine). Therefore, you\n    may use user variables and template functions in this field.\n  \n    For example, if you are running a Windows build on AWS, Azure,\n    Google Compute, or OpenStack and would like to access the auto-generated\n    password that Packer uses to connect to a Windows instance via WinRM, you\n    can use the template variable `{{.WinRMPassword}}` in this option. Example:\n  \n    ```json\n    \"ansible_env_vars\": [ \"WINRM_PASSWORD={{.WinRMPassword}}\" ],\n    ```\n\n- `ansible_ssh_extra_args` ([]string) - Specifies --ssh-extra-args on command line defaults to -o IdentitiesOnly=yes\n\n- `groups` ([]string) - The groups into which the Ansible host should\n   be placed. When unspecified, the host is not associated with any groups.\n\n- `empty_groups` ([]string) - The groups which should be present in\n   inventory file but remain empty.\n\n- `host_alias` (string) - The alias by which the Ansible host should be\n  known. Defaults to `default`. This setting is ignored when using a custom\n  inventory file.\n\n- `user` (string) - The `ansible_user` to use. Defaults to the user running\n   packer, NOT the user set for your communicator. If you want to use the same\n   user as the communicator, you will need to manually set it again in this\n   field.\n\n- `local_port` (int) - The port on which to attempt to listen for SSH\n   connections. This value is a starting point. The provisioner will attempt\n   listen for SSH connections on the first available of ten ports, starting at\n   `local_port`. A system-chosen port is used when `local_port` is missing or\n   empty.\n\n- `ssh_host_key_file` (string) - The SSH key that will be used to run the SSH\n   server on the host machine to forward commands to the target machine.\n   Ansible connects to this server and will validate the identity of the\n   server using the system known_hosts. The default behavior is to generate\n   and use a onetime key. Host key checking is disabled via the\n   `ANSIBLE_HOST_KEY_CHECKING` environment variable if the key is generated.\n\n- `ssh_authorized_key_file` (string) - The SSH public key of the Ansible\n   `ssh_user`. The default behavior is to generate and use a onetime key. If\n   this key is generated, the corresponding private key is passed to\n   `ansible-playbook` with the `-e ansible_ssh_private_key_file` option.\n\n- `ansible_proxy_key_type` (string) - Change the key type used for the adapter.\n  \n  Supported values:\n  \n  * ECDSA (default)\n  * RSA\n  \n  NOTE: using RSA may cause problems if the key is used to authenticate with rsa-sha1\n  as modern OpenSSH versions reject this by default as it is unsafe.\n\n- `sftp_command` (string) - The command to run on the machine being\n   provisioned by Packer to handle the SFTP protocol that Ansible will use to\n   transfer files. The command should read and write on stdin and stdout,\n   respectively. Defaults to `/usr/lib/sftp-server -e`.\n\n- `skip_version_check` (bool) - Check if ansible is installed prior to\n   running. Set this to `true`, for example, if you're going to install\n   ansible during the packer run.\n\n- `use_sftp` (bool) - Use SFTP\n\n- `inventory_directory` (string) - The directory in which to place the\n   temporary generated Ansible inventory file. By default, this is the\n   system-specific temporary file location. The fully-qualified name of this\n   temporary file will be passed to the `-i` argument of the `ansible` command\n   when this provisioner runs ansible. Specify this if you have an existing\n   inventory directory with `host_vars` `group_vars` that you would like to\n   use in the playbook that this provisioner will run.\n\n- `inventory_file_template` (string) - This template represents the format for the lines added to the temporary\n  inventory file that Packer will create to run Ansible against your image.\n  The default for recent versions of Ansible is:\n  \"{{ .HostAlias }} ansible_host={{ .Host }} ansible_user={{ .User }} ansible_port={{ .Port }}\\n\"\n  Available template engines are: This option is a template engine;\n  variables available to you include the examples in the default (Host,\n  HostAlias, User, Port) as well as any variables available to you via the\n  \"build\" template engine.\n\n- `inventory_file` (string) - The inventory file to use during provisioning.\n   When unspecified, Packer will create a temporary inventory file and will\n   use the `host_alias`.\n\n- `keep_inventory_file` (bool) - If `true`, the Ansible provisioner will\n   not delete the temporary inventory file it creates in order to connect to\n   the instance. This is useful if you are trying to debug your ansible run\n   and using \"--on-error=ask\" in order to leave your instance running while you\n   test your playbook. this option is not used if you set an `inventory_file`.\n\n- `galaxy_file` (string) - A requirements file which provides a way to\n   install roles or collections with the [ansible-galaxy\n   cli](https://docs.ansible.com/ansible/latest/galaxy/user_guide.html#the-ansible-galaxy-command-line-tool)\n   on the local machine before executing `ansible-playbook`. By default, this is empty.\n\n- `galaxy_command` (string) - The command to invoke ansible-galaxy. By default, this is\n  `ansible-galaxy`.\n\n- `galaxy_force_install` (bool) - Force overwriting an existing role.\n   Adds `--force` option to `ansible-galaxy` command. By default, this is\n   `false`.\n\n- `galaxy_force_with_deps` (bool) - Force overwriting an existing role and its dependencies.\n   Adds `--force-with-deps` option to `ansible-galaxy` command. By default,\n   this is `false`.\n\n- `roles_path` (string) - The path to the directory on your local system in which to\n    install the roles. Adds `--roles-path /path/to/your/roles` to\n    `ansible-galaxy` command. By default, this is empty, and thus `--roles-path`\n    option is not added to the command.\n\n- `collections_path` (string) - The path to the directory on your local system in which to\n    install the collections. Adds `--collections-path /path/to/your/collections` to\n    `ansible-galaxy` command. By default, this is empty, and thus `--collections-path`\n    option is not added to the command.\n\n- `use_proxy` (boolean) - When `true`, set up a localhost proxy adapter\n  so that Ansible has an IP address to connect to, even if your guest does not\n  have an IP address. For example, the adapter is necessary for Docker builds\n  to use the Ansible provisioner. If you set this option to `false`, but\n  Packer cannot find an IP address to connect Ansible to, it will\n  automatically set up the adapter anyway.\n  \n   In order for Ansible to connect properly even when use_proxy is false, you\n  need to make sure that you are either providing a valid username and ssh key\n  to the ansible provisioner directly, or that the username and ssh key\n  being used by the ssh communicator will work for your needs. If you do not\n  provide a user to ansible, it will use the user associated with your\n  builder, not the user running Packer.\n   use_proxy=false is currently only supported for SSH and WinRM.\n  \n  Currently, this defaults to `true` for all connection types. In the future,\n  this option will be changed to default to `false` for SSH and WinRM\n  connections where the provisioner has access to a host IP.\n\n- `ansible_winrm_use_http` (bool) - Force WinRM to use HTTP instead of HTTPS.\n  \n  Set this to true to force Ansible to use HTTP instead of HTTPS to communicate\n  over WinRM to the destination host.\n  \n  Ansible uses the port as a heuristic to determine whether to use HTTP\n  or not. In the current state, Packer assigns a random port for connecting\n  to WinRM and Ansible's heuristic fails to determine that it should be\n  using HTTP, even when the communicator is setup to use it.\n  \n  Alternatively, you may also directly add the following arguments to the\n  `extra_arguments` section for ansible: `\"-e\", \"ansible_winrm_scheme=http\"`.\n  \n  Default: `false`\n\n\u003c!-- End of code generated from the comments of the Config struct in provisioner/ansible/provisioner.go; --\u003e\n\n\nParameters common to all provisioners:\n\n- `pause_before` (duration) - Sleep for duration before execution.\n\n- `max_retries` (int) - Max times the provisioner will retry in case of failure. Defaults to zero (0). Zero means an error will not be retried.\n\n- `only` (array of string) - Only run the provisioner for listed builder(s)\n  by name.\n\n- `override` (object) - Override the builder with different settings for a\n  specific builder, eg :\n\n  In HCL2:\n\n  ```hcl\n  source \"null\" \"example1\" {\n    communicator = \"none\"\n  }\n\n  source \"null\" \"example2\" {\n    communicator = \"none\"\n  }\n\n  build {\n    sources = [\"source.null.example1\", \"source.null.example2\"]\n    provisioner \"shell-local\" {\n      inline = [\"echo not overridden\"]\n      override = {\n        example1 = {\n          inline = [\"echo yes overridden\"]\n        }\n      }\n    }\n  }\n  ```\n\n  In JSON:\n\n  ```json\n  {\n    \"builders\": [\n      {\n        \"type\": \"null\",\n        \"name\": \"example1\",\n        \"communicator\": \"none\"\n      },\n      {\n        \"type\": \"null\",\n        \"name\": \"example2\",\n        \"communicator\": \"none\"\n      }\n    ],\n    \"provisioners\": [\n      {\n        \"type\": \"shell-local\",\n        \"inline\": [\"echo not overridden\"],\n        \"override\": {\n          \"example1\": {\n            \"inline\": [\"echo yes overridden\"]\n          }\n        }\n      }\n    ]\n  }\n  ```\n\n- `timeout` (duration) - If the provisioner takes more than for example\n  `1h10m1s` or `10m` to finish, the provisioner will timeout and fail.\n\n\n## Default Extra Variables\n\nIn addition to being able to specify extra arguments using the\n`extra_arguments` configuration, the provisioner automatically defines certain\ncommonly useful Ansible variables:\n\n- `packer_build_name` is set to the name of the build that Packer is running.\n  This is most useful when Packer is making multiple builds and you want to\n  distinguish them slightly when using a common playbook.\n\n- `packer_builder_type` is the type of the builder that was used to create\n  the machine that the script is running on. This is useful if you want to\n  run only certain parts of the playbook on systems built with certain\n  builders.\n\n- `packer_http_addr` If using a builder that provides an HTTP server for file\n  transfer (such as `hyperv`, `parallels`, `qemu`, `virtualbox`, and `vmware`), this\n  will be set to the address. You can use this address in your provisioner to\n  download large files over HTTP. This may be useful if you're experiencing\n  slower speeds using the default file provisioner. A file provisioner using\n  the `winrm` communicator may experience these types of difficulties.\n\n## Debugging\n\nTo debug underlying issues with Ansible, add `\"-vvvv\"` to `\"extra_arguments\"`\nto enable verbose logging.\n\n**HCL2**\n\n```hcl\n  extra_arguments = [ \"-vvvv\" ]\n```\n\n**JSON**\n\n```json\n  \"extra_arguments\": [ \"-vvvv\" ]\n```\n\n\n## Limitations\n\n### Redhat / CentOS\n\nRedhat / CentOS builds have been known to fail with the following error due to\n`sftp_command`, which should be set to `/usr/libexec/openssh/sftp-server -e`:\n\n```text\n==\u003e virtualbox-ovf: starting sftp subsystem\n    virtualbox-ovf: fatal: [default]: UNREACHABLE! =\u003e {\"changed\": false, \"msg\": \"SSH Error: data could not be sent to the remote host. Make sure this host can be reached over ssh\", \"unreachable\": true}\n```\n\n### chroot communicator\n\nBuilding within a chroot (e.g. `amazon-chroot`) requires changing the Ansible\nconnection to chroot and running Ansible as root/sudo.\n\n**HCL2**\n\n```hcl\nsource \"amazon-chroot\" \"example\" {\n  mount_path = \"/mnt/packer-amazon-chroot\"\n  region     = \"us-east-1\"\n  source_ami = \"ami-123456\"\n}\n\nbuild {\n  sources = [\n    \"source.amazon-chroot.example\"\n  ]\n\n  provisioner \"ansible\" {\n    extra_arguments = [\n        \"--connection=chroot\",\n        \"--inventory-file=/mnt/packer-amazon-chroot\"\n      ]\n\n    playbook_file = \"main.yml\"\n  }\n}\n```\n\n**JSON**\n\n```json\n{\n  \"builders\": [\n    {\n      \"type\": \"amazon-chroot\",\n      \"mount_path\": \"/mnt/packer-amazon-chroot\",\n      \"region\": \"us-east-1\",\n      \"source_ami\": \"ami-123456\"\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"extra_arguments\": [\n        \"--connection=chroot\",\n        \"--inventory-file=/mnt/packer-amazon-chroot\"\n      ],\n      \"playbook_file\": \"main.yml\"\n    }\n  ]\n}\n```\n\n\n### WinRM Communicator\n\nThere are two possible methods for using Ansible with the WinRM communicator.\n\nPlease note that if you're having trouble getting Ansible to connect, you may\nwant to take a look at the script that the Ansible project provides to help\nconfigure remoting for Ansible:\nhttps://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1\n\n#### Method 1 (recommended)\n\nThe recommended way to use the WinRM communicator is to set `\"use_proxy\": false`\nand let the Ansible provisioner handle the rest for you. If you\nare using WinRM with HTTPS, and you are using a self-signed certificate you\nwill also have to set `ansible_winrm_server_cert_validation=ignore` in your\nextra_arguments.\n\nBelow is a fully functioning Ansible example for amazon-ebs using WinRM:\n\n```hcl\n\nvariable \"aws_region\"{\n  type    = string\n  default = \"us-east-1\"\n}\n\nvariable \"aws_access_key\"{\n  type = string\n}\n\nvariable \"aws_secret_key\"{\n  type = string\n}\n\ndata \"amazon-ami\" \"windows\" {\n\n  filters = {\n    name                = \"*Windows_Server-2012*English-64Bit-Base*\"\n    root-device-type    = \"ebs\"\n    virtualization-type = \"hvm\"\n  }\n\n  most_recent = true\n  owners      = [\"099720109477\"]\n\n  region      = var.aws_region\n  access_key  = var.aws_access_key\n  secret_key  = var.aws_secret_key\n}\n\nsource \"amazon-ebs\" \"example\" {\n    region      = var.aws_region\n    instance_type = \"t2.micro\"\n\n    source_ami       = data.amazon-ami.windows.id\n\n    ami_name         = \"test-ansible-packer\"\n    user_data_file   = \"windows_bootstrap.txt\"\n    communicator     = \"winrm\"\n    force_deregister = true\n    winrm_username   = \"Administrator\"\n    winrm_insecure   = true\n    winrm_use_ssl    = true\n}\n\nbuild {\n    sources = [\n        \"source.amazon-ebs.example\",\n    ]\n\n    provisioner \"ansible\" {\n      playbook_file   = \"./playbooks/playbook-windows.yml\"\n      user            = \"Administrator\"\n      use_proxy       = false\n      extra_arguments = [\n        \"-e\",\n        \"ansible_winrm_server_cert_validation=ignore\"\n      ]\n    }\n}\n```\n\nBelow is a fully functioning Ansible example for azure-arm using WinRM.\nNote: pywinrm needs to be installed into the python environment on your local build machine if it's not already installed.\nNote: The ConfigureRemotingForAnsible.ps1 script can be found here https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1.\n\n**HCL2**\n\n```hcl\nsource \"azure-arm\" \"server_2019\" {\n  use_azure_cli_auth                               = true\n  build_resource_group_name                        = \"ManagedImages-RGP\"\n  build_key_vault_name                             = \"Example-Packer-Keyvault\"\n  os_type                                          = \"Windows\"\n  image_publisher                                  = \"MicrosoftWindowsServer\"\n  image_offer                                      = \"WindowsServer\"\n  image_sku                                        = \"2019-Datacenter\"\n  vm_size                                          = \"Standard_D2as_v5\"\n  os_disk_size_gb                                  = 130\n  shared_gallery_image_version_exclude_from_latest = false\n  virtual_network_resource_group_name              = \"VNET-Resource-Group\"\n  virtual_network_name                             = \"My-VNET\"\n  virtual_network_subnet_name                      = \"My-Subnet\"\n  private_virtual_network_with_public_ip           = false\n  communicator                                     = \"winrm\"\n  winrm_use_ssl                                    = true\n  winrm_insecure                                   = true\n  winrm_timeout                                    = \"3m\"\n  winrm_username                                   = \"Packer\"\n  managed_image_name                               = \"Managed-Image-Name\"\n  managed_image_resource_group_name                = \"ManagedImages-RGP\"\n  managed_image_storage_account_type               = \"Standard_LRS\"\n\n  shared_image_gallery_destination {\n    resource_group       = \"ManagedImages-RGP\"\n    gallery_name         = \"MyGallery\"\n    image_name           = \"Server2019\"\n    storage_account_type = \"Standard_LRS\"\n  }\n}\n\nbuild {\n  sources = [\n    \"sources.azure-arm.server_2019\",\n  ]\n\n  provisioner \"shell-local\" {\n    inline_shebang = \"/bin/bash -e\"\n    inline = [\n      \"pipx inject python-env-name \\\"pywinrm\\\"\",\n    ]\n  }\n\n  provisioner \"powershell\" {\n    script = \"../../scripts/ConfigureRemotingForAnsible.ps1\"\n  }\n\n  provisioner \"ansible\" {\n    skip_version_check  = false\n    user                = \"Packer\"\n    use_proxy           = false\n    playbook_file       = \"windows2019.yml\"\n    extra_arguments = [\n      \"-e\",\n      \"ansible_winrm_server_cert_validation=ignore\",\n      \"-e\",\n      \"ansible_winrm_transport=ntlm\",\n    ]\n  }\n```\n\n**JSON**\n\n```json\n{\n  \"builders\": [\n    {\n      \"type\": \"amazon-ebs\",\n      \"region\": \"us-east-1\",\n      \"instance_type\": \"t2.micro\",\n      \"source_ami_filter\": {\n        \"filters\": {\n          \"virtualization-type\": \"hvm\",\n          \"name\": \"*Windows_Server-2012*English-64Bit-Base*\",\n          \"root-device-type\": \"ebs\"\n        },\n        \"most_recent\": true,\n        \"owners\": \"amazon\"\n      },\n      \"ami_name\": \"test-ansible-packer\",\n      \"user_data_file\": \"windows_bootstrap.txt\",\n      \"communicator\": \"winrm\",\n      \"force_deregister\": true,\n      \"winrm_insecure\": true,\n      \"winrm_username\": \"Administrator\",\n      \"winrm_use_ssl\": true\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"playbook_file\": \"./playbook.yml\",\n      \"user\": \"Administrator\",\n      \"use_proxy\": false,\n      \"extra_arguments\": [\"-e\", \"ansible_winrm_server_cert_validation=ignore\"]\n    }\n  ]\n}\n```\n\n\nNote that you do have to set the \"Administrator\" user, because otherwise Ansible\nwill default to using the user that is calling Packer, rather than the user\nconfigured inside of the Packer communicator. For the contents of\nwindows_bootstrap.txt, see the WinRM docs for the amazon-ebs communicator.\n\nWhen running from OSX, you may see an error like:\n\n```text\n    amazon-ebs: objc[9752]: +[__NSCFConstantString initialize] may have been in progress in another thread when fork() was called.\n    amazon-ebs: objc[9752]: +[__NSCFConstantString initialize] may have been in progress in another thread when fork() was called. We cannot safely call it or ignore it in the fork() child process. Crashing instead. Set a breakpoint on objc_initializeAfterForkError to debug.\n    amazon-ebs: ERROR! A worker was found in a dead state\n```\n\nIf you see this, you may be able to work around the issue by telling Ansible to\nexplicitly not use any proxying; you can do this by setting the template option\n\n**HCL2**\n\n```hcl\nansible_env_vars = [\"no_proxy=\\\"*\\\"\"]\n```\n\n**JSON**\n\n```json\n\"ansible_env_vars\": [\"no_proxy=\\\"*\\\"\"],\n```\n\n\nin the above Ansible template.\n\n#### Method 2 (Not recommended)\n\nIf you want to use the Packer SSH proxy, then you need a custom Ansible\nconnection plugin and a particular configuration. You need a directory named\n`connection_plugins` next to the playbook which contains a file named\npacker.py` which implements the connection plugin. On versions of Ansible\nbefore 2.4.x, the following works as the connection plugin:\n\n```python\nfrom __future__ import (absolute_import, division, print_function)\n__metaclass__ = type\n\nfrom ansible.plugins.connection.ssh import Connection as SSHConnection\n\nclass Connection(SSHConnection):\n    ''' ssh based connections for powershell via packer'''\n\n    transport = 'packer'\n    has_pipelining = True\n    become_methods = []\n    allow_executable = False\n    module_implementation_preferences = ('.ps1', '')\n\n    def __init__(self, *args, **kwargs):\n        super(Connection, self).__init__(*args, **kwargs)\n```\n\nNewer versions of Ansible require all plugins to have a documentation string.\nYou can see if there is a plugin available for the version of Ansible you are\nusing\n[here](https://github.com/hashicorp/packer/tree/master/provisioner/ansible/examples/connection-plugin).\n\nTo create the plugin yourself, you will need to copy all of the `options` from\nthe `DOCUMENTATION` string from the [ssh.py Ansible connection\nplugin](https://github.com/ansible/ansible/blob/devel/lib/ansible/plugins/connection/ssh.py)\nof the Ansible version you are using and add it to a packer.py file similar to\nas follows\n\n```python\nfrom __future__ import (absolute_import, division, print_function)\n__metaclass__ = type\n\nfrom ansible.plugins.connection.ssh import Connection as SSHConnection\n\nDOCUMENTATION = '''\n    connection: packer\n    short_description: ssh based connections for powershell via packer\n    description:\n        - This connection plugin allows ansible to communicate to the target packer machines via ssh based connections for powershell.\n    author: Packer\n    version_added: na\n    options:\n      **** Copy ALL the options from\n      https://github.com/ansible/ansible/blob/devel/lib/ansible/plugins/connection/ssh.py\n      for the version of Ansible you are using ****\n'''\n\nclass Connection(SSHConnection):\n    ''' ssh based connections for powershell via packer'''\n\n    transport = 'packer'\n    has_pipelining = True\n    become_methods = []\n    allow_executable = False\n    module_implementation_preferences = ('.ps1', '')\n\n    def __init__(self, *args, **kwargs):\n        super(Connection, self).__init__(*args, **kwargs)\n```\n\nThis template should build a Windows Server 2012 image on Google Cloud\nPlatform:\n\n```json\n{\n  \"variables\": {},\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"playbook_file\": \"./win-playbook.yml\",\n      \"extra_arguments\": [\n        \"--connection\",\n        \"packer\",\n        \"--extra-vars\",\n        \"\\\"ansible_shell_type=powershell ansible_shell_executable=None\\\"\"\n      ]\n    }\n  ],\n  \"builders\": [\n    {\n      \"type\": \"googlecompute\",\n      \"account_file\": \"{{ user `account_file`}}\",\n      \"project_id\": \"{{user `project_id`}}\",\n      \"source_image\": \"windows-server-2012-r2-dc-v20160916\",\n      \"communicator\": \"winrm\",\n      \"zone\": \"us-central1-a\",\n      \"disk_size\": 50,\n      \"winrm_username\": \"packer\",\n      \"winrm_use_ssl\": true,\n      \"winrm_insecure\": true,\n      \"metadata\": {\n        \"sysprep-specialize-script-cmd\": \"winrm set winrm/config/service/auth @{Basic=\\\"true\\\"}\"\n      }\n    }\n  ]\n}\n```\n\n-\u003e **Warning:** Please note that if you're setting up WinRM for provisioning, you'll probably want to turn it off or restrict its permissions as part of a shutdown script at the end of Packer's provisioning process. For more details on the why/how, check out this useful blog post and the associated code:\nhttps://cloudywindows.io/post/winrm-for-provisioning-close-the-door-on-the-way-out-eh/\n\n### Post i/o timeout errors\n\nIf you see\n`unknown error: Post http://\u003cip\u003e:\u003cport\u003e/wsman:dial tcp \u003cip\u003e:\u003cport\u003e: i/o timeout`\nerrors while provisioning a Windows machine, try setting Ansible to copy files\nover [ssh instead of\nsftp](https://docs.ansible.com/ansible/latest/reference_appendices/config.html#envvar-ANSIBLE_SCP_IF_SSH).\n\n### Too many SSH keys\n\nSSH servers only allow you to attempt to authenticate a certain number of\ntimes. All of your loaded keys will be tried before the dynamically generated\nkey. If you have too many SSH keys loaded in your `ssh-agent`, the Ansible\nprovisioner may fail authentication with a message similar to this:\n\n```text\n    googlecompute: fatal: [default]: UNREACHABLE! =\u003e {\"changed\": false, \"msg\": \"Failed to connect to the host via ssh: Warning: Permanently added '[127.0.0.1]:62684' (RSA) to the list of known hosts.\\r\\nReceived disconnect from 127.0.0.1 port 62684:2: too many authentication failures\\r\\nAuthentication failed.\\r\\n\", \"unreachable\": true}\n```\n\nTo unload all keys from your `ssh-agent`, run:\n\n```shell-session\n$ ssh-add -D\n```\n\n### Become: yes\n\nWe recommend against running Packer as root; if you do then you won't be able\nto successfully run your Ansible playbook as root; `become: yes` will fail.\n\n### Using a wrapping script for your Ansible call\n\nSometimes, you may have extra setup that needs to be called as part of your\nansible run. The easiest way to do this is by writing a small bash script and\nusing that bash script in your `command` in place of the default\n`ansible-playbook`. For example, you may need to launch a Python `virtualenv`\nbefore calling Ansible. To do this, you'd want to create a bash script like\n\n```shell\n#!/bin/bash\nsource /tmp/venv/bin/activate \u0026\u0026 ANSIBLE_FORCE_COLOR=1 PYTHONUNBUFFERED=1 /tmp/venv/bin/ansible-playbook \"$@\"\n```\n\nThe Ansible provisioner template remains very simple. For example:\n\n**HCL2**\n\n```hcl\nprovisioner \"ansible\" {\n  command       = \"/Path/To/call_ansible.sh\"\n  playbook_file = \"./playbook.yml\"\n}\n```\n\n**JSON**\n\n```json\n{\n  \"type\": \"ansible\",\n  \"command\": \"/Path/To/call_ansible.sh\",\n  \"playbook_file\": \"./playbook.yml\"\n}\n```\n\n\nNote that we're calling ansible-playbook at the end of this command and passing\nall command line arguments through into this call; this is necessary for\nmaking sure that --extra-vars and other important Ansible arguments get set.\nNote the quoting around the bash array, too; if you don't use quotes, any\narguments with spaces will not be read properly.\n\n## Docker\n\nWhen trying to use Ansible with Docker, it should \"just work\" but if it doesn't\nyou may need to tweak a few options.\n\n- Change the ansible_connection from \"ssh\" to \"docker\"\n- Set a Docker container name via the --name option.\n\nOn a CI server you probably want to overwrite ansible_host with a random name.\n\nExample Packer template:\n\n**HCL2**\n\n```hcl\nvariable \"ansible_host\" {\n  default = \"default\"\n}\n\nvariable \"ansible_connection\" {\n  default = \"docker\"\n}\n\nsource \"docker\" \"example\" {\n      image       = \"centos:7\"\n      commit      = true\n      run_command = [ \"-d\", \"-i\", \"-t\", \"--name\", var.ansible_host, \"{{.Image}}\", \"/bin/bash\" ]\n}\n\nbuild {\n  sources = [\n    \"source.docker.example\"\n  ]\n\n  provisioner \"ansible\" {\n      groups          = [ \"webserver\" ]\n      playbook_file   = \"./webserver.yml\"\n      extra_arguments = [\n          \"--extra-vars\",\n          \"ansible_host=${var.ansible_host} ansible_connection=${var.ansible_connection}\"\n      ]\n  }\n}\n```\n\n**JSON**\n\n```json\n{\n  \"variables\": {\n    \"ansible_host\": \"default\",\n    \"ansible_connection\": \"docker\"\n  },\n  \"builders\": [\n    {\n      \"type\": \"docker\",\n      \"image\": \"centos:7\",\n      \"commit\": true,\n      \"run_command\": [\n        \"-d\",\n        \"-i\",\n        \"-t\",\n        \"--name\",\n        \"{{user `ansible_host`}}\",\n        \"{{.Image}}\",\n        \"/bin/bash\"\n      ]\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"groups\": [\"webserver\"],\n      \"playbook_file\": \"./webserver.yml\",\n      \"extra_arguments\": [\n        \"--extra-vars\",\n        \"ansible_host={{user `ansible_host`}} ansible_connection={{user `ansible_connection`}}\"\n      ]\n    }\n  ]\n}\n```\n\n\nExample playbook:\n\n```yaml\n- name: configure webserver\n  hosts: webserver\n  tasks:\n    - name: install Apache\n      yum:\n        name: httpd\n```\n\n## Amazon Session Manager\n\nWhen trying to use Ansible with Amazon's Session Manager, you may run into an error where Ansible\nis unable to connect to the remote Amazon instance if the local proxy adapter for Ansible [use_proxy](#use_proxy) is false.\n\nThe error may look something like the following:\n\n```\namazon-ebs: fatal: [default]: UNREACHABLE! =\u003e {\"changed\": false, \"msg\": \"Failed to connect to the host via ssh: ssh: connect to host 127.0.0.1 port 8362: Connection timed out\", \"unreachable\": true}\n```\n\nThe error is caused by a limitation on using Amazon's SSM default Port Forwarding session which only allows for one\nremote connection on the forwarded port. Since Ansible's SSH communication is not using the local proxy adapter\nit will try to make a new SSH connection to the same forwarded localhost port and fail.\n\nIn order to workaround this issue Ansible can be configured via a custom inventory file to use the AWS session-manager-plugin\ndirectly to create a new session, separate from the one created by Packer, at runtime to connect and remotely provision the instance.\n\n-\u003e **Warning:** Please note that the default region configured for the `aws` cli must match the build region where the instance is being\nprovisioned otherwise you may run into a TargetNotConnected error. Users can use `AWS_DEFAULT_REGION` to temporarily override\ntheir configured region.\n\n**HCL2**\n\n```hcl\n  provisioner \"ansible\" {\n      use_proxy               =  false\n      playbook_file           =  \"./playbooks/playbook_remote.yml\"\n      ansible_env_vars        =  [\"PACKER_BUILD_NAME={{ build_name }}\"]\n      inventory_file_template =  \"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\"sh -c \\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\"\\\"'\\n\"\n  }\n```\n\n**JSON**\n\n```json\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"use_proxy\": false,\n      \"ansible_env_vars\": [\"PACKER_BUILD_NAME={{ build_name }}\"],\n      \"playbook_file\":   \"./playbooks/playbook_remote.yml\",\n      \"inventory_file_template\": \"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\"sh -c \\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\"\\\"'\\n\"\n    }\n  ]\n```\n\n\nFull Packer template example:\n\n**HCL2**\n\n```hcl\n\nvariables {\n  instance_role = \"SSMInstanceProfile\"\n}\n\nsource \"amazon-ebs\" \"ansible-example\" {\n  region        = \"us-east-1\"\n  ami_name      = \"packer-ami-ansible\"\n  instance_type = \"t2.micro\"\n\n  source_ami_filter {\n      filters = {\n          name                = \"ubuntu/images/*ubuntu-xenial-16.04-amd64-server-*\"\n          virtualization-type = \"hvm\"\n          root-device-type    = \"ebs\"\n      }\n      owners      = [ \"099720109477\" ]\n      most_recent =  true\n  }\n  communicator         = \"ssh\"\n  ssh_username         = \"ubuntu\"\n  ssh_interface        = \"session_manager\"\n  iam_instance_profile = var.instance_role\n}\n\nbuild {\n  sources = [\"source.amazon-ebs.ansible-example\"]\n\n  provisioner \"ansible\" {\n      use_proxy               =  false\n      playbook_file           =    \"./playbooks/playbook_remote.yml\"\n      ansible_env_vars        =  [\"PACKER_BUILD_NAME={{ build_name }}\"]\n      inventory_file_template =  \"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\"sh -c \\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\"\\\"'\\n\"\n    }\n}\n```\n\n**JSON**\n\n```json\n{\n  \"variables\": {\n    \"instance_role\": \"SSMInstanceProfile\"\n  },\n\n  \"builders\": [\n    {\n      \"type\": \"amazon-ebs\",\n      \"region\": \"us-east-1\",\n      \"ami_name\": \"packer-ami-ansible\",\n      \"instance_type\": \"t2.micro\",\n      \"source_ami_filter\": {\n        \"filters\": {\n          \"virtualization-type\": \"hvm\",\n          \"name\": \"ubuntu/images/*ubuntu-xenial-16.04-amd64-server-*\",\n          \"root-device-type\": \"ebs\"\n        },\n        \"owners\": [\"099720109477\"],\n        \"most_recent\": true\n      },\n      \"communicator\": \"ssh\",\n      \"ssh_username\": \"ubuntu\",\n      \"ssh_interface\": \"session_manager\",\n      \"iam_instance_profile\": \"{{user `instance_role`}}\"\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"ansible\",\n      \"use_proxy\": false,\n      \"ansible_env_vars\": [\"PACKER_BUILD_NAME={{ build_name }}\"],\n      \"playbook_file\": \"./playbooks/playbook_remote.yml\",\n      \"inventory_file_template\": \"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\"sh -c \\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\"\\\"'\\n\"\n    }\n  ]\n}\n```\n\n\n## Troubleshooting\n\nIf you are using an Ansible version \u003e= 2.8 and Packer hangs in the\n\"Gathering Facts\" stage, this could be the result of a pipelineing issue with\nthe proxy adapter that Packer uses. Setting `use_proxy` to `false` in the ansible\nprovisioner block of your Packer config should resolve the issue. In the future\nwe will default to setting this, so you won't have to but for now it is a manual\nchange you must make.\n","created_at":"2023-11-27T18:58:19.695Z","updated_at":"2023-11-27T18:58:19.695Z","name":"Ansible","slug":"ansible","component":{"id":"418417de-2c71-46a1-8dbc-7e9ae777a22e","slug":"provisioner","name":"Provisioner","plural_name":"Provisioners","product_id":"4c2b00c6-7cc1-4e4c-b596-4ab57e319f21","created_at":"2022-11-09T22:56:31.054Z","updated_at":"2022-11-09T22:56:31.054Z"},"variable_groups":[]},"processedVariablesMarkdown":{},"anchorLinks":[{"id":"basic-example","level":2,"title":"Basic Example"},{"id":"configuration-reference","level":2,"title":"Configuration Reference"},{"id":"default-extra-variables","level":2,"title":"Default Extra Variables"},{"id":"debugging","level":2,"title":"Debugging"},{"id":"limitations","level":2,"title":"Limitations"},{"id":"redhat-centos","level":3,"title":"Redhat / CentOS"},{"id":"chroot-communicator","level":3,"title":"chroot communicator"},{"id":"winrm-communicator","level":3,"title":"WinRM Communicator"},{"id":"method-1-(recommended)","level":4,"title":"Method 1 (recommended)"},{"id":"method-2-(not-recommended)","level":4,"title":"Method 2 (Not recommended)"},{"id":"post-io-timeout-errors","level":3,"title":"Post i/o timeout errors"},{"id":"too-many-ssh-keys","level":3,"title":"Too many SSH keys"},{"id":"become:-yes","level":3,"title":"Become: yes"},{"id":"using-a-wrapping-script-for-your-ansible-call","level":3,"title":"Using a wrapping script for your Ansible call"},{"id":"docker","level":2,"title":"Docker"},{"id":"amazon-session-manager","level":2,"title":"Amazon Session Manager"},{"id":"troubleshooting","level":2,"title":"Troubleshooting"}],"serializedREADME":{"compiledSource":"var i=Object.defineProperty,N=Object.defineProperties;var d=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;var c=(e,n,s)=\u003en in e?i(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,a=(e,n)=\u003e{for(var s in n||(n={}))o.call(n,s)\u0026\u0026c(e,s,n[s]);if(p)for(var s of p(n))r.call(n,s)\u0026\u0026c(e,s,n[s]);return e},m=(e,n)=\u003eN(e,d(n));var l=(e,n)=\u003e{var s={};for(var t in e)o.call(e,t)\u0026\u0026n.indexOf(t)\u003c0\u0026\u0026(s[t]=e[t]);if(e!=null\u0026\u0026p)for(var t of p(e))n.indexOf(t)\u003c0\u0026\u0026r.call(e,t)\u0026\u0026(s[t]=e[t]);return s};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(s){var t=s,{components:e}=t,n=l(t,[\"components\"]);return mdx(MDXLayout,m(a(a({},layoutProps),n),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Type: \",mdx(\"inlineCode\",{parentName:\"p\"},\"ansible\")),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"ansible\"),` Packer provisioner runs Ansible playbooks. It dynamically creates\nan Ansible inventory file configured to use SSH, runs an SSH server, executes\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ansible-playbook\"),`, and marshals Ansible plays through the SSH server to the\nmachine being provisioned by Packer.`),mdx(\"div\",a({},{className:\"alert alert-info g-type-body\"}),mdx(\"p\",a({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"Note:\"),\" Any \",mdx(\"inlineCode\",{parentName:\"p\"},\"remote_user\"),` defined in tasks will be ignored. Packer\nwill always connect with the user given in the json config for this\nprovisioner.`)),mdx(\"div\",a({},{className:\"alert alert-info g-type-body\"}),mdx(\"p\",a({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"Note:\"),` Options below that use the Packer template engine won't be able to\naccept jinja2 `,mdx(\"inlineCode\",{parentName:\"p\"},\"{{ function }}\"),` macro syntax in a way that can be preserved to\nthe Ansible run. If you need to set variables using Ansible macros, you need to\ndo so inside your playbooks or inventory files.`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Please see the \",mdx(\"a\",a({parentName:\"p\"},{href:\"#debugging\"}),\"Debugging\"),\", \",mdx(\"a\",a({parentName:\"p\"},{href:\"#limitations\"}),\"Limitations\"),\", or \",mdx(\"a\",a({parentName:\"p\"},{href:\"#troubleshooting\"}),\"Troubleshooting\"),` if you are having trouble\ngetting started.`),mdx(\"h2\",a({},{id:\"user-content-basic-example\",\"data-text-content\":\"Basic Example\",className:\"g-type-display-3\"}),\"Basic Example\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`This is a fully functional template that will provision an image on\nDigitalOcean. Replace the mock `,mdx(\"inlineCode\",{parentName:\"p\"},\"api_token\"),\" value with your own.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Example Packer template:\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"HCL2\")),mdx(\"pre\",a({},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),\"source \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"digitalocean\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"example\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"api_token\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"6a561151587389c7cf8faa2d83e94150a4202da0e2bad34dd2bf236018ffaeeb\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"image\"),\"     \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ubuntu-20-04-x64\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"region\"),\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"sfo1\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"build\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"sources\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"source.digitalocean.example\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"provisioner\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"ansible\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"playbook_file\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./playbook.yml\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"JSON\")),mdx(\"pre\",a({},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"builders\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"digitalocean\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"api_token\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"6a561151587389c7cf8faa2d83e94150a4202da0e2bad34dd2bf236018ffaeeb\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"image\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ubuntu-20-04-x64\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"region\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"sfo1\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"provisioners\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"playbook_file\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./playbook.yml\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Example playbook:\"),mdx(\"pre\",a({},{className:\"language-yaml\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-yaml\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"---\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# playbook.yml\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"name\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"'Provision Image'\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"hosts\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" default\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"become\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean important\"}),\"true\"),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"tasks\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"name\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" install Apache\",`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"package\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"name\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"'httpd'\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"state\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" present\",`\n`)),mdx(\"h2\",a({},{id:\"user-content-configuration-reference\",\"data-text-content\":\"Configuration Reference\",className:\"g-type-display-3\"}),\"Configuration Reference\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Required Parameters:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"playbook_file\"),\" (string) - The playbook to be run by Ansible.\")),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Optional Parameters:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"command\"),` (string) - The command to invoke ansible. Defaults to\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ansible-playbook\"),`. If you would like to provide a more complex command,\nfor example, something that sets up a virtual environment before calling\nansible, take a look at the ansible wrapper guide below for inspiration.\nPlease note that Packer expects Command to be a path to an executable.\nArbitrary bash scripting will not work and needs to go inside an\nexecutable script.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"extra_arguments\"),\" ([]string) - Extra arguments to pass to Ansible. These arguments \",mdx(\"em\",{parentName:\"p\"},\"will not\"),` be passed\nthrough a shell and arguments should not be quoted. Usage example:`),mdx(\"pre\",a({parentName:\"li\"},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"extra_arguments\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--extra-vars\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Region={{user `Region`}} Stage={{user `Stage`}}\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`)),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),`In certain scenarios where you want to pass ansible command line\narguments that include parameter and value (for example\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"--vault-password-file pwfile\"),`), from ansible documentation this is\ncorrect format but that is NOT accepted here. Instead you need to do it\nlike `,mdx(\"inlineCode\",{parentName:\"p\"},\"--vault-password-file=pwfile\"),\".\"),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),`If you are running a Windows build on AWS, Azure, Google Compute, or\nOpenStack and would like to access the auto-generated password that\nPacker uses to connect to a Windows instance via WinRM, you can use the\ntemplate variable`),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"build.Password\"),\" in HCL templates or \",mdx(\"inlineCode\",{parentName:\"p\"},\"{{ build `Password`}}\"),` in\nlegacy JSON templates. For example:`),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),\"in JSON templates:\"),mdx(\"pre\",a({parentName:\"li\"},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"extra_arguments\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--extra-vars\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"winrm_password={{ build `Password`}}\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`)),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),\"in HCL templates:\"),mdx(\"pre\",a({parentName:\"li\"},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"extra_arguments\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--extra-vars\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"winrm_password=',mdx(\"span\",a({parentName:\"span\"},{className:\"token interpolation\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"$\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"{\"),\"build\",mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\".\"),\"Password\",mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"}\")),'\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`)),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),`If the lefthand side of a value contains 'secret' or 'password' (case\ninsensitive) it will be hidden from output. For example, passing\n\"my_password=secr3t\" will hide \"secr3t\" from output.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"ansible_env_vars\"),` ([]string) - Environment variables to set before\nrunning Ansible. Usage example:`),mdx(\"pre\",a({parentName:\"li\"},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"ansible_env_vars\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ANSIBLE_HOST_KEY_CHECKING=False\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),`\"ANSIBLE_SSH_ARGS='-o ForwardAgent=yes -o ControlMaster=auto -o ControlPersist=60s'\"`),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ANSIBLE_NOCOLOR=True\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`)),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),\"  This is a \",mdx(\"a\",a({parentName:\"p\"},{href:\"/packer/docs/templates/legacy_json_templates/engine\"}),\"template engine\"),`. Therefore, you\nmay use user variables and template functions in this field.`),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),`  For example, if you are running a Windows build on AWS, Azure,\nGoogle Compute, or OpenStack and would like to access the auto-generated\npassword that Packer uses to connect to a Windows instance via WinRM, you\ncan use the template variable `,mdx(\"inlineCode\",{parentName:\"p\"},\"{{.WinRMPassword}}\"),\" in this option. Example:\"),mdx(\"pre\",a({parentName:\"li\"},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"ansible_env_vars\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"WINRM_PASSWORD={{.WinRMPassword}}\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"ansible_ssh_extra_args\"),\" ([]string) - Specifies --ssh-extra-args on command line defaults to -o IdentitiesOnly=yes\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"groups\"),` ([]string) - The groups into which the Ansible host should\nbe placed. When unspecified, the host is not associated with any groups.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"empty_groups\"),` ([]string) - The groups which should be present in\ninventory file but remain empty.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"host_alias\"),` (string) - The alias by which the Ansible host should be\nknown. Defaults to `,mdx(\"inlineCode\",{parentName:\"p\"},\"default\"),`. This setting is ignored when using a custom\ninventory file.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"user\"),\" (string) - The \",mdx(\"inlineCode\",{parentName:\"p\"},\"ansible_user\"),` to use. Defaults to the user running\npacker, NOT the user set for your communicator. If you want to use the same\nuser as the communicator, you will need to manually set it again in this\nfield.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"local_port\"),` (int) - The port on which to attempt to listen for SSH\nconnections. This value is a starting point. The provisioner will attempt\nlisten for SSH connections on the first available of ten ports, starting at\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"local_port\"),\". A system-chosen port is used when \",mdx(\"inlineCode\",{parentName:\"p\"},\"local_port\"),` is missing or\nempty.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"ssh_host_key_file\"),` (string) - The SSH key that will be used to run the SSH\nserver on the host machine to forward commands to the target machine.\nAnsible connects to this server and will validate the identity of the\nserver using the system known_hosts. The default behavior is to generate\nand use a onetime key. Host key checking is disabled via the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ANSIBLE_HOST_KEY_CHECKING\"),\" environment variable if the key is generated.\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"ssh_authorized_key_file\"),` (string) - The SSH public key of the Ansible\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ssh_user\"),`. The default behavior is to generate and use a onetime key. If\nthis key is generated, the corresponding private key is passed to\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ansible-playbook\"),\" with the \",mdx(\"inlineCode\",{parentName:\"p\"},\"-e ansible_ssh_private_key_file\"),\" option.\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"ansible_proxy_key_type\"),\" (string) - Change the key type used for the adapter.\"),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Supported values:\"),mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",{parentName:\"ul\"},\"ECDSA (default)\"),mdx(\"li\",{parentName:\"ul\"},\"RSA\")),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),`NOTE: using RSA may cause problems if the key is used to authenticate with rsa-sha1\nas modern OpenSSH versions reject this by default as it is unsafe.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"sftp_command\"),` (string) - The command to run on the machine being\nprovisioned by Packer to handle the SFTP protocol that Ansible will use to\ntransfer files. The command should read and write on stdin and stdout,\nrespectively. Defaults to `,mdx(\"inlineCode\",{parentName:\"p\"},\"/usr/lib/sftp-server -e\"),\".\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"skip_version_check\"),` (bool) - Check if ansible is installed prior to\nrunning. Set this to `,mdx(\"inlineCode\",{parentName:\"p\"},\"true\"),`, for example, if you're going to install\nansible during the packer run.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"use_sftp\"),\" (bool) - Use SFTP\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"inventory_directory\"),` (string) - The directory in which to place the\ntemporary generated Ansible inventory file. By default, this is the\nsystem-specific temporary file location. The fully-qualified name of this\ntemporary file will be passed to the `,mdx(\"inlineCode\",{parentName:\"p\"},\"-i\"),\" argument of the \",mdx(\"inlineCode\",{parentName:\"p\"},\"ansible\"),` command\nwhen this provisioner runs ansible. Specify this if you have an existing\ninventory directory with `,mdx(\"inlineCode\",{parentName:\"p\"},\"host_vars\"),\" \",mdx(\"inlineCode\",{parentName:\"p\"},\"group_vars\"),` that you would like to\nuse in the playbook that this provisioner will run.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"inventory_file_template\"),` (string) - This template represents the format for the lines added to the temporary\ninventory file that Packer will create to run Ansible against your image.\nThe default for recent versions of Ansible is:\n\"{{ .HostAlias }} ansible_host={{ .Host }} ansible_user={{ .User }} ansible_port={{ .Port }}\\\\n\"\nAvailable template engines are: This option is a template engine;\nvariables available to you include the examples in the default (Host,\nHostAlias, User, Port) as well as any variables available to you via the\n\"build\" template engine.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"inventory_file\"),` (string) - The inventory file to use during provisioning.\nWhen unspecified, Packer will create a temporary inventory file and will\nuse the `,mdx(\"inlineCode\",{parentName:\"p\"},\"host_alias\"),\".\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"keep_inventory_file\"),\" (bool) - If \",mdx(\"inlineCode\",{parentName:\"p\"},\"true\"),`, the Ansible provisioner will\nnot delete the temporary inventory file it creates in order to connect to\nthe instance. This is useful if you are trying to debug your ansible run\nand using \"--on-error=ask\" in order to leave your instance running while you\ntest your playbook. this option is not used if you set an `,mdx(\"inlineCode\",{parentName:\"p\"},\"inventory_file\"),\".\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"galaxy_file\"),` (string) - A requirements file which provides a way to\ninstall roles or collections with the `,mdx(\"a\",a({parentName:\"p\"},{href:\"https://docs.ansible.com/ansible/latest/galaxy/user_guide.html#the-ansible-galaxy-command-line-tool\"}),`ansible-galaxy\ncli`),`\non the local machine before executing `,mdx(\"inlineCode\",{parentName:\"p\"},\"ansible-playbook\"),\". By default, this is empty.\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"galaxy_command\"),` (string) - The command to invoke ansible-galaxy. By default, this is\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ansible-galaxy\"),\".\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"galaxy_force_install\"),` (bool) - Force overwriting an existing role.\nAdds `,mdx(\"inlineCode\",{parentName:\"p\"},\"--force\"),\" option to \",mdx(\"inlineCode\",{parentName:\"p\"},\"ansible-galaxy\"),` command. By default, this is\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"false\"),\".\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"galaxy_force_with_deps\"),` (bool) - Force overwriting an existing role and its dependencies.\nAdds `,mdx(\"inlineCode\",{parentName:\"p\"},\"--force-with-deps\"),\" option to \",mdx(\"inlineCode\",{parentName:\"p\"},\"ansible-galaxy\"),` command. By default,\nthis is `,mdx(\"inlineCode\",{parentName:\"p\"},\"false\"),\".\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"roles_path\"),` (string) - The path to the directory on your local system in which to\ninstall the roles. Adds `,mdx(\"inlineCode\",{parentName:\"p\"},\"--roles-path /path/to/your/roles\"),` to\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ansible-galaxy\"),\" command. By default, this is empty, and thus \",mdx(\"inlineCode\",{parentName:\"p\"},\"--roles-path\"),`\noption is not added to the command.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"collections_path\"),` (string) - The path to the directory on your local system in which to\ninstall the collections. Adds `,mdx(\"inlineCode\",{parentName:\"p\"},\"--collections-path /path/to/your/collections\"),` to\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ansible-galaxy\"),\" command. By default, this is empty, and thus \",mdx(\"inlineCode\",{parentName:\"p\"},\"--collections-path\"),`\noption is not added to the command.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"use_proxy\"),\" (boolean) - When \",mdx(\"inlineCode\",{parentName:\"p\"},\"true\"),`, set up a localhost proxy adapter\nso that Ansible has an IP address to connect to, even if your guest does not\nhave an IP address. For example, the adapter is necessary for Docker builds\nto use the Ansible provisioner. If you set this option to `,mdx(\"inlineCode\",{parentName:\"p\"},\"false\"),`, but\nPacker cannot find an IP address to connect Ansible to, it will\nautomatically set up the adapter anyway.`),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),` In order for Ansible to connect properly even when use_proxy is false, you\nneed to make sure that you are either providing a valid username and ssh key\nto the ansible provisioner directly, or that the username and ssh key\nbeing used by the ssh communicator will work for your needs. If you do not\nprovide a user to ansible, it will use the user associated with your\nbuilder, not the user running Packer.\nuse_proxy=false is currently only supported for SSH and WinRM.`),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Currently, this defaults to \",mdx(\"inlineCode\",{parentName:\"p\"},\"true\"),` for all connection types. In the future,\nthis option will be changed to default to `,mdx(\"inlineCode\",{parentName:\"p\"},\"false\"),` for SSH and WinRM\nconnections where the provisioner has access to a host IP.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"ansible_winrm_use_http\"),\" (bool) - Force WinRM to use HTTP instead of HTTPS.\"),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),`Set this to true to force Ansible to use HTTP instead of HTTPS to communicate\nover WinRM to the destination host.`),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),`Ansible uses the port as a heuristic to determine whether to use HTTP\nor not. In the current state, Packer assigns a random port for connecting\nto WinRM and Ansible's heuristic fails to determine that it should be\nusing HTTP, even when the communicator is setup to use it.`),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),`Alternatively, you may also directly add the following arguments to the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"extra_arguments\"),\" section for ansible: \",mdx(\"inlineCode\",{parentName:\"p\"},'\"-e\", \"ansible_winrm_scheme=http\"'),\".\"),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Default: \",mdx(\"inlineCode\",{parentName:\"p\"},\"false\")))),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Parameters common to all provisioners:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"pause_before\"),\" (duration) - Sleep for duration before execution.\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"max_retries\"),\" (int) - Max times the provisioner will retry in case of failure. Defaults to zero (0). Zero means an error will not be retried.\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"only\"),` (array of string) - Only run the provisioner for listed builder(s)\nby name.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"override\"),` (object) - Override the builder with different settings for a\nspecific builder, eg :`),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),\"In HCL2:\"),mdx(\"pre\",a({parentName:\"li\"},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),\"source \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"null\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"example1\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"communicator\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"none\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,\"source \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"null\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"example2\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"communicator\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"none\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"build\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"sources\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"source.null.example1\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"source.null.example2\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"provisioner\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"shell-local\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"inline\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"echo not overridden\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"override\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"example1\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"inline\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"echo yes overridden\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),\"In JSON:\"),mdx(\"pre\",a({parentName:\"li\"},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"builders\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"null\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"name\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"example1\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"communicator\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"none\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"null\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"name\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"example2\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"communicator\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"none\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"provisioners\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"shell-local\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"inline\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"echo not overridden\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"override\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"example1\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"inline\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"echo yes overridden\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"timeout\"),` (duration) - If the provisioner takes more than for example\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"1h10m1s\"),\" or \",mdx(\"inlineCode\",{parentName:\"p\"},\"10m\"),\" to finish, the provisioner will timeout and fail.\"))),mdx(\"h2\",a({},{id:\"user-content-default-extra-variables\",\"data-text-content\":\"Default Extra Variables\",className:\"g-type-display-3\"}),\"Default Extra Variables\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`In addition to being able to specify extra arguments using the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"extra_arguments\"),` configuration, the provisioner automatically defines certain\ncommonly useful Ansible variables:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"packer_build_name\"),` is set to the name of the build that Packer is running.\nThis is most useful when Packer is making multiple builds and you want to\ndistinguish them slightly when using a common playbook.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"packer_builder_type\"),` is the type of the builder that was used to create\nthe machine that the script is running on. This is useful if you want to\nrun only certain parts of the playbook on systems built with certain\nbuilders.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",a({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"inlineCode\",{parentName:\"p\"},\"packer_http_addr\"),` If using a builder that provides an HTTP server for file\ntransfer (such as `,mdx(\"inlineCode\",{parentName:\"p\"},\"hyperv\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"parallels\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"qemu\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"virtualbox\"),\", and \",mdx(\"inlineCode\",{parentName:\"p\"},\"vmware\"),`), this\nwill be set to the address. You can use this address in your provisioner to\ndownload large files over HTTP. This may be useful if you're experiencing\nslower speeds using the default file provisioner. A file provisioner using\nthe `,mdx(\"inlineCode\",{parentName:\"p\"},\"winrm\"),\" communicator may experience these types of difficulties.\"))),mdx(\"h2\",a({},{id:\"user-content-debugging\",\"data-text-content\":\"Debugging\",className:\"g-type-display-3\"}),\"Debugging\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"To debug underlying issues with Ansible, add \",mdx(\"inlineCode\",{parentName:\"p\"},'\"-vvvv\"'),\" to \",mdx(\"inlineCode\",{parentName:\"p\"},'\"extra_arguments\"'),`\nto enable verbose logging.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"HCL2\")),mdx(\"pre\",a({},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"extra_arguments\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-vvvv\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"JSON\")),mdx(\"pre\",a({},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"extra_arguments\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-vvvv\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`)),mdx(\"h2\",a({},{id:\"user-content-limitations\",\"data-text-content\":\"Limitations\",className:\"g-type-display-3\"}),\"Limitations\"),mdx(\"h3\",a({},{id:\"user-content-redhat-centos\",\"data-text-content\":\"Redhat  CentOS\",className:\"g-type-display-4\"}),\"Redhat / CentOS\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Redhat / CentOS builds have been known to fail with the following error due to\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"sftp_command\"),\", which should be set to \",mdx(\"inlineCode\",{parentName:\"p\"},\"/usr/libexec/openssh/sftp-server -e\"),\":\"),mdx(\"pre\",a({},{className:\"language-text\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-text\"}),\"==\u003e virtualbox-ovf: starting sftp subsystem\",`\n`,'    virtualbox-ovf: fatal: [default]: UNREACHABLE! =\u003e {\"changed\": false, \"msg\": \"SSH Error: data could not be sent to the remote host. Make sure this host can be reached over ssh\", \"unreachable\": true}',`\n`)),mdx(\"h3\",a({},{id:\"user-content-chroot-communicator\",\"data-text-content\":\"chroot communicator\",className:\"g-type-display-4\"}),\"chroot communicator\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Building within a chroot (e.g. \",mdx(\"inlineCode\",{parentName:\"p\"},\"amazon-chroot\"),`) requires changing the Ansible\nconnection to chroot and running Ansible as root/sudo.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"HCL2\")),mdx(\"pre\",a({},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),\"source \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"amazon-chroot\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"example\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"mount_path\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"/mnt/packer-amazon-chroot\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"region\"),\"     \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"us-east-1\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"source_ami\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ami-123456\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"build\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"sources\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"source.amazon-chroot.example\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"provisioner\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"ansible\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"extra_arguments\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--connection=chroot\"'),\",\",`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--inventory-file=/mnt/packer-amazon-chroot\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"playbook_file\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"main.yml\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"JSON\")),mdx(\"pre\",a({},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"builders\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"amazon-chroot\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"mount_path\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"/mnt/packer-amazon-chroot\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"region\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"us-east-1\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"source_ami\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ami-123456\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"provisioners\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"extra_arguments\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--connection=chroot\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--inventory-file=/mnt/packer-amazon-chroot\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"playbook_file\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"main.yml\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"h3\",a({},{id:\"user-content-winrm-communicator\",\"data-text-content\":\"WinRM Communicator\",className:\"g-type-display-4\"}),\"WinRM Communicator\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"There are two possible methods for using Ansible with the WinRM communicator.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Please note that if you're having trouble getting Ansible to connect, you may\nwant to take a look at the script that the Ansible project provides to help\nconfigure remoting for Ansible:\n`,mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1\"}),\"https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1\")),mdx(\"h4\",a({},{id:\"user-content-method-1-(recommended)\",\"data-text-content\":\"Method 1 recommended\",className:\"g-type-display-5\"}),\"Method 1 (recommended)\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The recommended way to use the WinRM communicator is to set \",mdx(\"inlineCode\",{parentName:\"p\"},'\"use_proxy\": false'),`\nand let the Ansible provisioner handle the rest for you. If you\nare using WinRM with HTTPS, and you are using a self-signed certificate you\nwill also have to set `,mdx(\"inlineCode\",{parentName:\"p\"},\"ansible_winrm_server_cert_validation=ignore\"),` in your\nextra_arguments.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Below is a fully functioning Ansible example for amazon-ebs using WinRM:\"),mdx(\"pre\",a({},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),`\n`,\"variable \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"aws_region\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"type\"),\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" string\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"default\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"us-east-1\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,\"variable \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"aws_access_key\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"type\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" string\",`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,\"variable \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"aws_secret_key\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"type\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" string\",`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"data \",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),'\"amazon-ami\"')),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"windows\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"filters\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"name\"),\"                \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"*Windows_Server-2012*English-64Bit-Base*\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"root-device-type\"),\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ebs\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"virtualization-type\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"hvm\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"most_recent\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"owners\"),\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"099720109477\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"region\"),\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" var.aws_region\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"access_key\"),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" var.aws_access_key\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"secret_key\"),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" var.aws_secret_key\",`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,\"source \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"amazon-ebs\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"example\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"region\"),\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" var.aws_region\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"instance_type\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"t2.micro\"'),`\n`,`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"source_ami\"),\"       \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" data.amazon-ami.windows.id\",`\n`,`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"ami_name\"),\"         \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"test-ansible-packer\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"user_data_file\"),\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"windows_bootstrap.txt\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"communicator\"),\"     \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"winrm\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"force_deregister\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"winrm_username\"),\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Administrator\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"winrm_insecure\"),\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"winrm_use_ssl\"),\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"build\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"sources\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"source.amazon-ebs.example\"'),\",\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"provisioner\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"ansible\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"playbook_file\"),\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./playbooks/playbook-windows.yml\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"user\"),\"            \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Administrator\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"use_proxy\"),\"       \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"extra_arguments\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-e\"'),\",\",`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible_winrm_server_cert_validation=ignore\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Below is a fully functioning Ansible example for azure-arm using WinRM.\nNote: pywinrm needs to be installed into the python environment on your local build machine if it's not already installed.\nNote: The ConfigureRemotingForAnsible.ps1 script can be found here `,mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1\"}),\"https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1\"),\".\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"HCL2\")),mdx(\"pre\",a({},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),\"source \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"azure-arm\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"server_2019\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"use_azure_cli_auth\"),\"                               \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"build_resource_group_name\"),\"                        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ManagedImages-RGP\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"build_key_vault_name\"),\"                             \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Example-Packer-Keyvault\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"os_type\"),\"                                          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Windows\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"image_publisher\"),\"                                  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"MicrosoftWindowsServer\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"image_offer\"),\"                                      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"WindowsServer\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"image_sku\"),\"                                        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"2019-Datacenter\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"vm_size\"),\"                                          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Standard_D2as_v5\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"os_disk_size_gb\"),\"                                  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"130\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"shared_gallery_image_version_exclude_from_latest\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"virtual_network_resource_group_name\"),\"              \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"VNET-Resource-Group\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"virtual_network_name\"),\"                             \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"My-VNET\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"virtual_network_subnet_name\"),\"                      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"My-Subnet\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"private_virtual_network_with_public_ip\"),\"           \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"communicator\"),\"                                     \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"winrm\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"winrm_use_ssl\"),\"                                    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"winrm_insecure\"),\"                                   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"winrm_timeout\"),\"                                    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"3m\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"winrm_username\"),\"                                   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Packer\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"managed_image_name\"),\"                               \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Managed-Image-Name\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"managed_image_resource_group_name\"),\"                \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ManagedImages-RGP\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"managed_image_storage_account_type\"),\"               \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Standard_LRS\"'),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"shared_image_gallery_destination\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"resource_group\"),\"       \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ManagedImages-RGP\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"gallery_name\"),\"         \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"MyGallery\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"image_name\"),\"           \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Server2019\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"storage_account_type\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Standard_LRS\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"build\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"sources\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"sources.azure-arm.server_2019\"'),\",\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"provisioner\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"shell-local\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"inline_shebang\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"/bin/bash -e\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"inline\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"pipx inject python-env-name \\\\\"pywinrm\\\\\"\"'),\",\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"provisioner\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"powershell\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"script\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"../../scripts/ConfigureRemotingForAnsible.ps1\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"provisioner\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"ansible\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"skip_version_check\"),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"user\"),\"                \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Packer\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"use_proxy\"),\"           \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"playbook_file\"),\"       \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"windows2019.yml\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"extra_arguments\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-e\"'),\",\",`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible_winrm_server_cert_validation=ignore\"'),\",\",`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-e\"'),\",\",`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible_winrm_transport=ntlm\"'),\",\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"JSON\")),mdx(\"pre\",a({},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"builders\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"amazon-ebs\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"region\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"us-east-1\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"instance_type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"t2.micro\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"source_ami_filter\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"filters\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"virtualization-type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"hvm\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"name\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"*Windows_Server-2012*English-64Bit-Base*\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"root-device-type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ebs\"'),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"most_recent\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"owners\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"amazon\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"ami_name\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"test-ansible-packer\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"user_data_file\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"windows_bootstrap.txt\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"communicator\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"winrm\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"force_deregister\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"winrm_insecure\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"winrm_username\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Administrator\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"winrm_use_ssl\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"provisioners\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"playbook_file\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./playbook.yml\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"user\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Administrator\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"use_proxy\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"extra_arguments\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-e\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible_winrm_server_cert_validation=ignore\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Note that you do have to set the \"Administrator\" user, because otherwise Ansible\nwill default to using the user that is calling Packer, rather than the user\nconfigured inside of the Packer communicator. For the contents of\nwindows_bootstrap.txt, see the WinRM docs for the amazon-ebs communicator.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"When running from OSX, you may see an error like:\"),mdx(\"pre\",a({},{className:\"language-text\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-text\"}),\"    amazon-ebs: objc[9752]: +[__NSCFConstantString initialize] may have been in progress in another thread when fork() was called.\",`\n`,\"    amazon-ebs: objc[9752]: +[__NSCFConstantString initialize] may have been in progress in another thread when fork() was called. We cannot safely call it or ignore it in the fork() child process. Crashing instead. Set a breakpoint on objc_initializeAfterForkError to debug.\",`\n`,\"    amazon-ebs: ERROR! A worker was found in a dead state\",`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`If you see this, you may be able to work around the issue by telling Ansible to\nexplicitly not use any proxying; you can do this by setting the template option`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"HCL2\")),mdx(\"pre\",a({},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"ansible_env_vars\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"no_proxy=\\\\\"*\\\\\"\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"JSON\")),mdx(\"pre\",a({},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"ansible_env_vars\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"no_proxy=\\\\\"*\\\\\"\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"in the above Ansible template.\"),mdx(\"h4\",a({},{id:\"user-content-method-2-(not-recommended)\",\"data-text-content\":\"Method 2 Not recommended\",className:\"g-type-display-5\"}),\"Method 2 (Not recommended)\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`If you want to use the Packer SSH proxy, then you need a custom Ansible\nconnection plugin and a particular configuration. You need a directory named\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"connection_plugins\"),` next to the playbook which contains a file named\npacker.py\\` which implements the connection plugin. On versions of Ansible\nbefore 2.4.x, the following works as the connection plugin:`),mdx(\"pre\",a({},{className:\"language-python\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-python\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"from\"),\" __future__ \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"import\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"absolute_import\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" division\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" print_function\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,\"__metaclass__ \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"type\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"from\"),\" ansible\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"plugins\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"connection\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"ssh \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"import\"),\" Connection \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"as\"),\" SSHConnection\",`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token class-name\"}),\"Connection\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"SSHConnection\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"''' ssh based connections for powershell via packer'''\"),`\n`,`\n`,\"    transport \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"'packer'\"),`\n`,\"    has_pipelining \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"True\"),`\n`,\"    become_methods \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"    allow_executable \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"False\"),`\n`,\"    module_implementation_preferences \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"'.ps1'\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"''\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"__init__\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"*\"),\"args\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"**\"),\"kwargs\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"super\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"Connection\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" self\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"__init__\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"*\"),\"args\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"**\"),\"kwargs\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Newer versions of Ansible require all plugins to have a documentation string.\nYou can see if there is a plugin available for the version of Ansible you are\nusing\n`,mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/hashicorp/packer/tree/master/provisioner/ansible/examples/connection-plugin\"}),\"here\"),\".\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"To create the plugin yourself, you will need to copy all of the \",mdx(\"inlineCode\",{parentName:\"p\"},\"options\"),` from\nthe `,mdx(\"inlineCode\",{parentName:\"p\"},\"DOCUMENTATION\"),\" string from the \",mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/ansible/ansible/blob/devel/lib/ansible/plugins/connection/ssh.py\"}),`ssh.py Ansible connection\nplugin`),`\nof the Ansible version you are using and add it to a packer.py file similar to\nas follows`),mdx(\"pre\",a({},{className:\"language-python\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-python\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"from\"),\" __future__ \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"import\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"absolute_import\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" division\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" print_function\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,\"__metaclass__ \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"type\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"from\"),\" ansible\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"plugins\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"connection\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"ssh \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"import\"),\" Connection \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"as\"),\" SSHConnection\",`\n`,`\n`,\"DOCUMENTATION \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"'''\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"    connection: packer\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"    short_description: ssh based connections for powershell via packer\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"    description:\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"        - This connection plugin allows ansible to communicate to the target packer machines via ssh based connections for powershell.\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"    author: Packer\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"    version_added: na\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"    options:\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"      **** Copy ALL the options from\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"      https://github.com/ansible/ansible/blob/devel/lib/ansible/plugins/connection/ssh.py\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"      for the version of Ansible you are using ****\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"'''\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token class-name\"}),\"Connection\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"SSHConnection\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token triple-quoted-string string\"}),\"''' ssh based connections for powershell via packer'''\"),`\n`,`\n`,\"    transport \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"'packer'\"),`\n`,\"    has_pipelining \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"True\"),`\n`,\"    become_methods \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"    allow_executable \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"False\"),`\n`,\"    module_implementation_preferences \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"'.ps1'\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"''\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"__init__\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"*\"),\"args\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"**\"),\"kwargs\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"super\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"Connection\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" self\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"__init__\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"*\"),\"args\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"**\"),\"kwargs\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`This template should build a Windows Server 2012 image on Google Cloud\nPlatform:`),mdx(\"pre\",a({},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"variables\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"provisioners\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"playbook_file\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./win-playbook.yml\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"extra_arguments\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--connection\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"packer\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--extra-vars\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"\\\\\"ansible_shell_type=powershell ansible_shell_executable=None\\\\\"\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"builders\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"googlecompute\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"account_file\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"{{ user `account_file`}}\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"project_id\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"{{user `project_id`}}\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"source_image\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"windows-server-2012-r2-dc-v20160916\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"communicator\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"winrm\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"zone\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"us-central1-a\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"disk_size\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"50\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"winrm_username\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"packer\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"winrm_use_ssl\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"winrm_insecure\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"metadata\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"sysprep-specialize-script-cmd\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"winrm set winrm/config/service/auth @{Basic=\\\\\"true\\\\\"}\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"div\",a({},{className:\"alert alert-info g-type-body\"}),mdx(\"p\",a({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"Warning:\"),` Please note that if you're setting up WinRM for provisioning, you'll probably want to turn it off or restrict its permissions as part of a shutdown script at the end of Packer's provisioning process. For more details on the why/how, check out this useful blog post and the associated code:\n`,mdx(\"a\",a({parentName:\"p\"},{href:\"https://cloudywindows.io/post/winrm-for-provisioning-close-the-door-on-the-way-out-eh/\"}),\"https://cloudywindows.io/post/winrm-for-provisioning-close-the-door-on-the-way-out-eh/\"))),mdx(\"h3\",a({},{id:\"user-content-post-io-timeout-errors\",\"data-text-content\":\"Post io timeout errors\",className:\"g-type-display-4\"}),\"Post i/o timeout errors\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`If you see\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"unknown error: Post http://\u003cip\u003e:\u003cport\u003e/wsman:dial tcp \u003cip\u003e:\u003cport\u003e: i/o timeout\"),`\nerrors while provisioning a Windows machine, try setting Ansible to copy files\nover `,mdx(\"a\",a({parentName:\"p\"},{href:\"https://docs.ansible.com/ansible/latest/reference_appendices/config.html#envvar-ANSIBLE_SCP_IF_SSH\"}),`ssh instead of\nsftp`),\".\"),mdx(\"h3\",a({},{id:\"user-content-too-many-ssh-keys\",\"data-text-content\":\"Too many SSH keys\",className:\"g-type-display-4\"}),\"Too many SSH keys\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`SSH servers only allow you to attempt to authenticate a certain number of\ntimes. All of your loaded keys will be tried before the dynamically generated\nkey. If you have too many SSH keys loaded in your `,mdx(\"inlineCode\",{parentName:\"p\"},\"ssh-agent\"),`, the Ansible\nprovisioner may fail authentication with a message similar to this:`),mdx(\"pre\",a({},{className:\"language-text\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-text\"}),`    googlecompute: fatal: [default]: UNREACHABLE! =\u003e {\"changed\": false, \"msg\": \"Failed to connect to the host via ssh: Warning: Permanently added '[127.0.0.1]:62684' (RSA) to the list of known hosts.\\\\r\\\\nReceived disconnect from 127.0.0.1 port 62684:2: too many authentication failures\\\\r\\\\nAuthentication failed.\\\\r\\\\n\", \"unreachable\": true}`,`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"To unload all keys from your \",mdx(\"inlineCode\",{parentName:\"p\"},\"ssh-agent\"),\", run:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"ssh-add -D\")),`\n`)),mdx(\"h3\",a({},{id:\"user-content-become:-yes\",\"data-text-content\":\"Become yes\",className:\"g-type-display-4\"}),\"Become: yes\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`We recommend against running Packer as root; if you do then you won't be able\nto successfully run your Ansible playbook as root; `,mdx(\"inlineCode\",{parentName:\"p\"},\"become: yes\"),\" will fail.\"),mdx(\"h3\",a({},{id:\"user-content-using-a-wrapping-script-for-your-ansible-call\",\"data-text-content\":\"Using a wrapping script for your Ansible call\",className:\"g-type-display-4\"}),\"Using a wrapping script for your Ansible call\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Sometimes, you may have extra setup that needs to be called as part of your\nansible run. The easiest way to do this is by writing a small bash script and\nusing that bash script in your `,mdx(\"inlineCode\",{parentName:\"p\"},\"command\"),` in place of the default\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ansible-playbook\"),\". For example, you may need to launch a Python \",mdx(\"inlineCode\",{parentName:\"p\"},\"virtualenv\"),`\nbefore calling Ansible. To do this, you'd want to create a bash script like`),mdx(\"pre\",a({},{className:\"language-shell\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token shebang important\"}),\"#!/bin/bash\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"source\"),\" /tmp/venv/bin/activate \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"\u0026\u0026\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"ANSIBLE_FORCE_COLOR\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"PYTHONUNBUFFERED\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1\"),\" /tmp/venv/bin/ansible-playbook \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$@\"),'\"'),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The Ansible provisioner template remains very simple. For example:\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"HCL2\")),mdx(\"pre\",a({},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"provisioner\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"ansible\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"command\"),\"       \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"/Path/To/call_ansible.sh\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"playbook_file\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./playbook.yml\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"JSON\")),mdx(\"pre\",a({},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"command\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"/Path/To/call_ansible.sh\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"playbook_file\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./playbook.yml\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Note that we're calling ansible-playbook at the end of this command and passing\nall command line arguments through into this call; this is necessary for\nmaking sure that --extra-vars and other important Ansible arguments get set.\nNote the quoting around the bash array, too; if you don't use quotes, any\narguments with spaces will not be read properly.`),mdx(\"h2\",a({},{id:\"user-content-docker\",\"data-text-content\":\"Docker\",className:\"g-type-display-3\"}),\"Docker\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`When trying to use Ansible with Docker, it should \"just work\" but if it doesn't\nyou may need to tweak a few options.`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},'Change the ansible_connection from \"ssh\" to \"docker\"'),mdx(\"li\",{parentName:\"ul\"},\"Set a Docker container name via the --name option.\")),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"On a CI server you probably want to overwrite ansible_host with a random name.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Example Packer template:\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"HCL2\")),mdx(\"pre\",a({},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"variable\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"ansible_host\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"default\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"default\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"variable\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"ansible_connection\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"default\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"docker\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,\"source \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"docker\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"example\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"image\"),\"       \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"centos:7\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"commit\"),\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"run_command\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-d\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-i\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-t\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--name\"'),\", var.ansible_host, \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"{{.Image}}\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"/bin/bash\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"build\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"sources\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"source.docker.example\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"provisioner\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"ansible\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"groups\"),\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"webserver\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"playbook_file\"),\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./webserver.yml\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"extra_arguments\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--extra-vars\"'),\",\",`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible_host=',mdx(\"span\",a({parentName:\"span\"},{className:\"token interpolation\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"$\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token keyword\"}),\"var\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),\"ansible_host\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"}\")),\" ansible_connection=\",mdx(\"span\",a({parentName:\"span\"},{className:\"token interpolation\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"$\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token keyword\"}),\"var\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),\"ansible_connection\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"}\")),'\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"JSON\")),mdx(\"pre\",a({},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"variables\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"ansible_host\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"default\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"ansible_connection\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"docker\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"builders\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"docker\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"image\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"centos:7\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"commit\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"run_command\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-d\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-i\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"-t\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--name\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"{{user `ansible_host`}}\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"{{.Image}}\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"/bin/bash\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"provisioners\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"groups\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"webserver\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"playbook_file\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./webserver.yml\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"extra_arguments\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"--extra-vars\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible_host={{user `ansible_host`}} ansible_connection={{user `ansible_connection`}}\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Example playbook:\"),mdx(\"pre\",a({},{className:\"language-yaml\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-yaml\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"name\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" configure webserver\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"hosts\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" webserver\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"tasks\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"name\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" install Apache\",`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"yum\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token key atrule\"}),\"name\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" httpd\",`\n`)),mdx(\"h2\",a({},{id:\"user-content-amazon-session-manager\",\"data-text-content\":\"Amazon Session Manager\",className:\"g-type-display-3\"}),\"Amazon Session Manager\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`When trying to use Ansible with Amazon's Session Manager, you may run into an error where Ansible\nis unable to connect to the remote Amazon instance if the local proxy adapter for Ansible `,mdx(\"a\",a({parentName:\"p\"},{href:\"#use_proxy\"}),\"use_proxy\"),\" is false.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The error may look something like the following:\"),mdx(\"pre\",null,mdx(\"code\",{parentName:\"pre\"},'amazon-ebs: fatal: [default]: UNREACHABLE! =\u003e {\"changed\": false, \"msg\": \"Failed to connect to the host via ssh: ssh: connect to host 127.0.0.1 port 8362: Connection timed out\", \"unreachable\": true}',`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`The error is caused by a limitation on using Amazon's SSM default Port Forwarding session which only allows for one\nremote connection on the forwarded port. Since Ansible's SSH communication is not using the local proxy adapter\nit will try to make a new SSH connection to the same forwarded localhost port and fail.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`In order to workaround this issue Ansible can be configured via a custom inventory file to use the AWS session-manager-plugin\ndirectly to create a new session, separate from the one created by Packer, at runtime to connect and remotely provision the instance.`),mdx(\"div\",a({},{className:\"alert alert-info g-type-body\"}),mdx(\"p\",a({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"Warning:\"),\" Please note that the default region configured for the \",mdx(\"inlineCode\",{parentName:\"p\"},\"aws\"),` cli must match the build region where the instance is being\nprovisioned otherwise you may run into a TargetNotConnected error. Users can use `,mdx(\"inlineCode\",{parentName:\"p\"},\"AWS_DEFAULT_REGION\"),` to temporarily override\ntheir configured region.`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"HCL2\")),mdx(\"pre\",a({},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"provisioner\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"ansible\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"use_proxy\"),\"               \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"playbook_file\"),\"           \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./playbooks/playbook_remote.yml\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"ansible_env_vars\"),\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"PACKER_BUILD_NAME={{ build_name }}\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"inventory_file_template\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),`\"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\\\"sh -c \\\\\\\\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\\\\\\\"\\\\\"'\\\\n\"`),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"JSON\")),mdx(\"pre\",a({},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"provisioners\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"use_proxy\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"ansible_env_vars\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"PACKER_BUILD_NAME={{ build_name }}\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"playbook_file\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./playbooks/playbook_remote.yml\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"inventory_file_template\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),`\"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\\\"sh -c \\\\\\\\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\\\\\\\"\\\\\"'\\\\n\"`),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Full Packer template example:\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"HCL2\")),mdx(\"pre\",a({},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"variables\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"instance_role\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"SSMInstanceProfile\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,\"source \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"amazon-ebs\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible-example\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"region\"),\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"us-east-1\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"ami_name\"),\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"packer-ami-ansible\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"instance_type\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"t2.micro\"'),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"source_ami_filter\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"filters\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"name\"),\"                \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ubuntu/images/*ubuntu-xenial-16.04-amd64-server-*\"'),`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"virtualization-type\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"hvm\"'),`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"root-device-type\"),\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ebs\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"owners\"),\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"099720109477\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"most_recent\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"communicator\"),\"         \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ssh\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"ssh_username\"),\"         \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ubuntu\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"ssh_interface\"),\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"session_manager\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"iam_instance_profile\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" var.instance_role\",`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"build\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"sources\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"source.amazon-ebs.ansible-example\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"provisioner\",mdx(\"span\",a({parentName:\"span\"},{className:\"token type variable\"}),' \"ansible\" ')),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"use_proxy\"),\"               \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"playbook_file\"),\"           \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./playbooks/playbook_remote.yml\"'),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"ansible_env_vars\"),\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"PACKER_BUILD_NAME={{ build_name }}\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"inventory_file_template\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),`\"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\\\"sh -c \\\\\\\\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\\\\\\\"\\\\\"'\\\\n\"`),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"JSON\")),mdx(\"pre\",a({},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"variables\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"instance_role\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"SSMInstanceProfile\"'),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"builders\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"amazon-ebs\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"region\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"us-east-1\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"ami_name\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"packer-ami-ansible\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"instance_type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"t2.micro\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"source_ami_filter\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"filters\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"virtualization-type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"hvm\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"name\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ubuntu/images/*ubuntu-xenial-16.04-amd64-server-*\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"root-device-type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ebs\"'),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"owners\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"099720109477\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"most_recent\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"communicator\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ssh\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"ssh_username\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ubuntu\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"ssh_interface\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"session_manager\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"iam_instance_profile\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"{{user `instance_role`}}\"'),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"provisioners\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"type\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ansible\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"use_proxy\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"ansible_env_vars\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"PACKER_BUILD_NAME={{ build_name }}\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"playbook_file\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"./playbooks/playbook_remote.yml\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"inventory_file_template\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),`\"{{ .HostAlias }} ansible_host={{ .ID }} ansible_user={{ .User }} ansible_ssh_common_args='-o StrictHostKeyChecking=no -o ProxyCommand=\\\\\"sh -c \\\\\\\\\\\\\"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\\\\\\\\\\\\\"\\\\\"'\\\\n\"`),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"h2\",a({},{id:\"user-content-troubleshooting\",\"data-text-content\":\"Troubleshooting\",className:\"g-type-display-3\"}),\"Troubleshooting\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`If you are using an Ansible version \u003e= 2.8 and Packer hangs in the\n\"Gathering Facts\" stage, this could be the result of a pipelineing issue with\nthe proxy adapter that Packer uses. Setting `,mdx(\"inlineCode\",{parentName:\"p\"},\"use_proxy\"),\" to \",mdx(\"inlineCode\",{parentName:\"p\"},\"false\"),` in the ansible\nprovisioner block of your Packer config should resolve the issue. In the future\nwe will default to setting this, so you won't have to but for now it is a manual\nchange you must make.`))}MDXContent.isMDXComponent=!0;\n","scope":{}},"breadcrumbLinks":[{"title":"Developer","url":"/"},{"title":"Packer","url":"/packer"},{"title":"Integrations","url":"/packer/integrations"},{"title":"Ansible","url":"/packer/integrations/hashicorp/ansible","isCurrentPage":false},{"title":"v1.1.1","url":"/packer/integrations/hashicorp/ansible/v1.1.1","isCurrentPage":false},{"title":"Components"},{"title":"Provisioner"},{"title":"Ansible","url":"/packer/integrations/hashicorp/ansible/latest/components/provisioner/ansible","isCurrentPage":true}]},"__N_SSG":true},"page":"/[productSlug]/integrations/[organizationSlug]/[integrationSlug]/[integrationVersion]/components/[componentType]/[componentSlug]","query":{"productSlug":"packer","organizationSlug":"hashicorp","integrationSlug":"ansible","integrationVersion":"latest","componentType":"provisioner","componentSlug":"ansible"},"buildId":"V7v-fhXeCmiHNFDH8cxwc","assetPrefix":"/hashicorp-vault","isFallback":false,"gsp":true,"scriptLoader":[]}</script><script nomodule="">window.MSInputMethodContext && document.documentMode && document.write('<script src="/ie-warning.js"><\x2fscript>');</script></body></html>