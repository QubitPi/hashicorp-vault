"use strict";(()=>{var e={};e.id=3748,e.ids=[3748],e.modules={33666:e=>{e.exports=require("@vercel/fetch")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},84269:e=>{e.exports=require("url")},56249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},17519:(e,t,r)=>{r.r(t),r.d(t,{config:()=>E,default:()=>P,routeModule:()=>T});var n,o,s={};r.r(s),r.d(s,{default:()=>A});var i=r(71802),a=r(47153),c=r(56249),u=r(33666),d=r.n(u);let l=require("next-auth");var h=r.n(l),p=r(84269);(n||(n={})).CloudIdp="cloud-idp",function(e){e.RefreshAccessTokenError="[next-auth] RefreshAccessTokenError",e.RefreshAccessTokenExpiredError="[next-auth] RefreshAccessTokenError: token_inactive"}(o||(o={}));let f={id:n.CloudIdp,name:"Cloud IDP",type:"oauth",wellKnown:"https://auth.idp.hcp.dev/.well-known/openid-configuration",authorization:{params:{scope:"openid offline_access"}},idToken:!0,checks:["pkce","state"],clientId:process.env.AUTH_CLIENT_ID,clientSecret:process.env.AUTH_CLIENT_SECRET,client:{name:"HashiCorp Developer",token_endpoint_auth_method:"client_secret_post"},profile:e=>({id:e.sub,...e})};async function _(e){try{let t=new URL("/oauth2/token","https://auth.idp.hcp.dev"),r=await fetch(t.toString(),{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",body:new URLSearchParams({client_id:process.env.AUTH_CLIENT_ID,client_secret:process.env.AUTH_CLIENT_SECRET,grant_type:"refresh_token",refresh_token:e})}),n=await r.json();if(!r.ok)throw n;return n}catch(e){throw console.log("refreshTokenSet error",e),e}}let k=require("jsonwebtoken"),w=d()(),A=h()({session:{maxAge:2592e3},events:{async signOut({token:e}){try{let t=(await (await w(f.wellKnown)).json()).end_session_endpoint,r=new p.URL(t),n=e.id_token;r.searchParams.set("id_token_hint",n),await w(r.toString())}catch(e){console.error("[NextAuth] There was an error in the `signOut` event:",e)}}},providers:[f],callbacks:{async jwt({token:e,account:t,profile:r}){if(t&&r)return e.access_token=t.access_token,e.refresh_token=t.refresh_token,e.id_token=t.id_token,e.picture=r.picture,e.nickname=r.nickname,e;let[n,s]=function(e){let t=Date.now()/1e3,r=(0,k.decode)(e,{json:!0});if(!r)throw Error("isJwtExpired failed to parse jwt");let{exp:n}=r;return[t>n,Math.floor(n-t)]}(e.access_token);if(n)try{let{access_token:t,refresh_token:r}=await _(e.refresh_token);e.access_token=t,e.refresh_token=r}catch(t){return console.error(`${o.RefreshAccessTokenError}: failed to refresh token set`,t),{...e,error:o.RefreshAccessTokenError}}return e},session:async({session:e,token:t})=>({...e,accessToken:t.access_token,id:t.sub,user:{...e.user,nickname:t.nickname,id:t.sub},error:t.error})}}),P=(0,c.l)(s,"default"),E=(0,c.l)(s,"config"),T=new i.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/auth/[...nextauth]",pathname:"/api/auth/[...nextauth]",bundlePath:"",filename:""},userland:s})},47153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=17519);module.exports=r})();