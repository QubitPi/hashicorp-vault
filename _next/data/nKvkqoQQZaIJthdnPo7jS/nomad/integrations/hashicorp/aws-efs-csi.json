{"pageProps":{"metadata":{"title":"AWS EFS CSI | Integrations","description":"Configures a set of nodes to run the AWS EFS CSI volume plugin."},"product":{"name":"Nomad","slug":"nomad","algoliaConfig":{"indexName":"product_NOMAD","searchOnlyApiKey":"9bfec34ea54e56a11bd50d6bfedc5e71"},"analyticsConfig":{"includedDomains":"nomadproject.io www.nomadproject.io","segmentWriteKey":"qW11yxgipKMsKFKQUCpTVgQUYftYsJj0"},"datoToken":"88b4984480dad56295a8aadae6caad","metadata":{"title":"Nomad by HashiCorp","description":"Nomad is a highly available, distributed, data-center aware cluster and application scheduler designed to support the modern datacenter with support for long-running services, batch jobs, and much more.","image":"https://www.nomadproject.io/nomad-public/img/og-image.png","icon":[{"href":"/nomad-public/_favicon.ico"}]},"alertBannerActive":true,"alertBanner":{"tag":"HashiDays","url":"https://hashicorp.com/conferences/hashidays","text":"One conference. Three cities.","linkText":"Find a city near you","expirationDate":"2024-06-14T00:00:00-08:00"},"version":"1.2.5","subnavItems":[{"text":"Overview","url":"/","type":"inbound"},{"text":"Enterprise","url":"https://www.hashicorp.com/products/nomad/","type":"outbound"},"divider",{"text":"Tutorials","url":"https://developer.hashicorp.com/nomad/tutorials","type":"outbound"},{"text":"Docs","url":"/docs","type":"inbound"},{"text":"API","url":"/api-docs","type":"inbound"},{"text":"Plugins","url":"/plugins","type":"inbound"},{"text":"Tools","url":"/tools","type":"inbound"},{"text":"Community","url":"/community","type":"inbound"}],"basePaths":["docs","api-docs","plugins","tools","intro","downloads"],"rootDocsPaths":[{"iconName":"docs","name":"Documentation","path":"docs"},{"iconName":"entry-point","name":"Intro","path":"intro"},{"iconName":"api","name":"API","path":"api-docs"},{"iconName":"terminal-screen","name":"Tools","path":"tools"},{"iconName":"plug","name":"Plugins","path":"plugins"}],"integrationsConfig":{"description":"A curated collection of official, partner, and community Nomad Integrations."}},"integration":{"id":"c2b61d1e-5d8f-49b0-bf1b-567dc94fb943","slug":"aws-efs-csi","name":"AWS EFS CSI","description":"Configures a set of nodes to run the AWS EFS CSI volume plugin.","license_type":null,"license_url":null,"external_only":false,"external_url":"https://github.com/kubernetes-sigs/aws-efs-csi-driver","tier":"community","repo_url":"https://github.com/hashicorp/nomad-pack-community-registry","subdirectory":"/packs/aws_efs_csi","created_at":"2023-05-17T17:26:03.174Z","updated_at":"2023-07-12T18:05:02.183Z","hide_versions":false,"organization":{"id":"a4a0551a-1451-4d89-9f56-8031c8350c77","slug":"hashicorp","created_at":"2022-11-09T22:56:32.391Z","updated_at":"2022-11-09T22:56:32.391Z"},"product":{"id":"40557cca-56ca-4cb2-abc6-9bba2a9ca62d","slug":"nomad","name":"Nomad","created_at":"2022-11-09T22:56:29.799Z","updated_at":"2022-11-09T22:56:29.799Z"},"versions":["0.0.1"],"components":[],"flags":[],"integration_type":{"id":"e8835871-6a6a-4836-8797-505cbfbe426a","product_id":"40557cca-56ca-4cb2-abc6-9bba2a9ca62d","slug":"pack","name":"Pack","plural_name":"Packs","description":"Packs are templated sets of resources that are meant to be deployed to Nomad together. Each pack defines parameters that can be customized by the end user.","created_at":"2023-05-02T17:31:29.062Z","updated_at":"2023-05-17T22:44:11.429Z"}},"activeRelease":{"id":"fba9cf18-c806-4d18-b988-35198247f0c3","integration_id":"c2b61d1e-5d8f-49b0-bf1b-567dc94fb943","version":"0.0.1","readme":"This pack contains a single system job that runs the AWS EFS CSI plugin. It will run the nodes in\nmonolith modes, which means they will run as both nodes and controllers. The job can only be run\non Nomad hosts which have enabled privileged mode for Docker. In addition the hosts will need to have to\nbe provided with access to AWS EFS through AWS IAM.\n\n## Variables\n\n- `job_name` (string \"aws-efs-csi-nodes\") - The name to use as the job name.\n- `datacenters` (list(string) [\"dc1\"]) - A list of datacenters in the region which are eligible for\n  task placement.\n- `region` (string \"global\") - The region where the job should be placed.\n- `constraints` (list(object)) - Constraints to apply to the entire job.\n- `resources` (object) - The resource to assign to the plugin task.\n- `image` (string \"amazon/aws-efs-csi-driver:master\") - The Docker image to run on the plugin tasks.\n- `csi_id` (string \"aws-efs\") - The CSI ID to use for this plugin.\n\n### `constraints` List of Objects\n\n[Nomad job specification constraints](https://www.nomadproject.io/docs/job-specification/constraint) allows restricting the set of eligible nodes\non node task will run.\n\n- `attribute` (string) - Specifies the name or reference of the attribute to examine for the\n  constraint.\n- `operator` (string) - Specifies the comparison operator. The ordering is compared lexically.\n- `value` (string) - Specifies the value to compare the attribute against using the specified\n  operation.\n\nBy default the job will run on hosts running linux and having Docker privileged mode enabled. The HCL\nvariable list of objects for the default configuration is shown below and uses a double dollar sign for escaping:\n```hcl\n[\n    {\n      attribute = \"$${attr.kernel.name}\",\n      value     = \"linux\",\n      operator  = null,\n    },\n    {\n      attribute = \"$${attr.driver.docker.privileged.enabled}\",\n      value     = true,\n      operator  = null,\n    }\n]\n```\nBelow is also an example of how to pass `constraints` to the CLI with with the -var argument.\n```bash\nnomad-pack run -var 'constraints=[{\"attribute\":\"$${meta.my_custom_value}\",\"operator\":\">\",\"value\":\"3\"}]' packs/aws_efs_csi\n```\nWhen setting the `constrains` variable manually its default value will be overriden.\n\n### `resources` Object\n\n- `cpu` (number 100) - Specifies the CPU required to run this task in MHz.\n- `memory` (number 128) - Specifies the memory required in MB.\n\n\n## Volume creation example\nThe plugin currently only by creating new access points to existing EFS file systems. So you'll first have\nto provision a new EFS file system. The capacity in the volume spec is not used, but is required by the\nCSI Volume API.\n\n#### **`volume.hcl`**\n```hcl\nid = \"test\"\nname = \"Test\"\ntype = \"csi\"\nplugin_id = \"aws-efs\"\ncapacity_max = \"1G\"\ncapacity_min = \"1M\"\n\ncapability {\n\taccess_mode = \"single-node-writer\"\n\tattachment_mode = \"file-system\"\n}\n\nparameters {\n\tprovisioningMode = \"efs-ap\"\n\tfileSystemId = \"<insert-your-efs-id>\"\n\tdirectoryPerms = \"700\"\n\tgidRangeStart = \"1000\"\n\tgidRangeEnd = \"2000\"\n\tbasePath = \"/test\"\n}\n```\nRun the command:\n```sh\nnomad volume create volume.hcl\n```\n","created_at":"2023-05-17T22:18:56.895Z","updated_at":"2023-05-17T22:18:56.895Z","components":[]},"breadcrumbLinks":[{"title":"Developer","url":"/"},{"title":"Nomad","url":"/nomad"},{"title":"Integrations","url":"/nomad/integrations"},{"title":"AWS EFS CSI","url":"/nomad/integrations/hashicorp/aws-efs-csi","isCurrentPage":true}],"anchorLinks":[{"id":"variables","level":2,"title":"Variables"},{"id":"constraints-list-of-objects","level":3,"title":"constraints List of Objects"},{"id":"resources-object","level":3,"title":"resources Object"},{"id":"volume-creation-example","level":2,"title":"Volume creation example"},{"id":"volume.hcl","level":4,"title":"volume.hcl"}],"serializedREADME":{"compiledSource":"const layoutProps={};const MDXLayout=\"wrapper\";function MDXContent({components,...props}){return mdx(MDXLayout,{...layoutProps,...props,components:components,mdxType:\"MDXLayout\"},mdx(\"p\",{\"className\":\"g-type-long-body\"},`This pack contains a single system job that runs the AWS EFS CSI plugin. It will run the nodes in\nmonolith modes, which means they will run as both nodes and controllers. The job can only be run\non Nomad hosts which have enabled privileged mode for Docker. In addition the hosts will need to have to\nbe provided with access to AWS EFS through AWS IAM.`),mdx(\"h2\",{\"id\":\"user-content-variables\",\"data-text-content\":\"Variables\",\"className\":\"g-type-display-3\"},`Variables`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`job_name`),` (string \"aws-efs-csi-nodes\") - The name to use as the job name.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`datacenters`),` (list(string) `,`[\"dc1\"]`,`) - A list of datacenters in the region which are eligible for\ntask placement.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`region`),` (string \"global\") - The region where the job should be placed.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`constraints`),` (list(object)) - Constraints to apply to the entire job.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`resources`),` (object) - The resource to assign to the plugin task.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`image`),` (string \"amazon/aws-efs-csi-driver:master\") - The Docker image to run on the plugin tasks.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`csi_id`),` (string \"aws-efs\") - The CSI ID to use for this plugin.`)),mdx(\"h3\",{\"id\":\"user-content-constraints-list-of-objects\",\"data-text-content\":\"constraints List of Objects\",\"className\":\"g-type-display-4\"},mdx(\"inlineCode\",{parentName:\"h3\"},`constraints`),` List of Objects`),mdx(\"p\",{\"className\":\"g-type-long-body\"},mdx(\"a\",{parentName:\"p\",\"href\":\"https://www.nomadproject.io/docs/job-specification/constraint\"},`Nomad job specification constraints`),` allows restricting the set of eligible nodes\non node task will run.`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`attribute`),` (string) - Specifies the name or reference of the attribute to examine for the\nconstraint.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`operator`),` (string) - Specifies the comparison operator. The ordering is compared lexically.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`value`),` (string) - Specifies the value to compare the attribute against using the specified\noperation.`)),mdx(\"p\",{\"className\":\"g-type-long-body\"},`By default the job will run on hosts running linux and having Docker privileged mode enabled. The HCL\nvariable list of objects for the default configuration is shown below and uses a double dollar sign for escaping:`),mdx(\"pre\",{\"className\":\"language-hcl\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-hcl\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`[`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`      `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`attribute`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"$\\${attr.kernel.name}\"`),`,`,`\n`,`      `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`value`),`     `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"linux\"`),`,`,`\n`,`      `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`operator`),`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` null,`,`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`,`,`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`      `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`attribute`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"$\\${attr.driver.docker.privileged.enabled}\"`),`,`,`\n`,`      `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`value`),`     `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token boolean\"},`true`),`,`,`\n`,`      `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`operator`),`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` null,`,`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`]`),`\n`)),mdx(\"p\",{\"className\":\"g-type-long-body\"},`Below is also an example of how to pass `,mdx(\"inlineCode\",{parentName:\"p\"},`constraints`),` to the CLI with with the -var argument.`),mdx(\"pre\",{\"className\":\"language-bash\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-bash\"},`nomad-pack run -var `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`'constraints=[{\"attribute\":\"$\\${meta.my_custom_value}\",\"operator\":\">\",\"value\":\"3\"}]'`),` packs/aws_efs_csi`,`\n`)),mdx(\"p\",{\"className\":\"g-type-long-body\"},`When setting the `,mdx(\"inlineCode\",{parentName:\"p\"},`constrains`),` variable manually its default value will be overriden.`),mdx(\"h3\",{\"id\":\"user-content-resources-object\",\"data-text-content\":\"resources Object\",\"className\":\"g-type-display-4\"},mdx(\"inlineCode\",{parentName:\"h3\"},`resources`),` Object`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`cpu`),` (number 100) - Specifies the CPU required to run this task in MHz.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},`memory`),` (number 128) - Specifies the memory required in MB.`)),mdx(\"h2\",{\"id\":\"user-content-volume-creation-example\",\"data-text-content\":\"Volume creation example\",\"className\":\"g-type-display-3\"},`Volume creation example`),mdx(\"p\",{\"className\":\"g-type-long-body\"},`The plugin currently only by creating new access points to existing EFS file systems. So you'll first have\nto provision a new EFS file system. The capacity in the volume spec is not used, but is required by the\nCSI Volume API.`),mdx(\"h4\",{\"id\":\"user-content-volume.hcl\",\"data-text-content\":\"volumehcl\",\"className\":\"g-type-display-5\"},mdx(\"strong\",{parentName:\"h4\"},mdx(\"inlineCode\",{parentName:\"strong\"},`volume.hcl`))),mdx(\"pre\",{\"className\":\"language-hcl\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-hcl\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`id`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"test\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`name`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"Test\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`type`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"csi\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`plugin_id`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"aws-efs\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`capacity_max`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"1G\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`capacity_min`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"1M\"`),`\n`,`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token keyword\"},`capability`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`access_mode`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"single-node-writer\"`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`attachment_mode`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"file-system\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`,`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token keyword\"},`parameters`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`provisioningMode`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"efs-ap\"`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`fileSystemId`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"<insert-your-efs-id>\"`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`directoryPerms`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"700\"`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`gidRangeStart`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"1000\"`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`gidRangeEnd`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"2000\"`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`basePath`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"/test\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`)),mdx(\"p\",{\"className\":\"g-type-long-body\"},`Run the command:`),mdx(\"pre\",{\"className\":\"language-sh\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-sh\"},`nomad volume create volume.hcl`,`\n`)))};MDXContent.isMDXComponent=true;","scope":{}}},"__N_SSG":true}