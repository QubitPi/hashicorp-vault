{"pageProps":{"metadata":{"title":"Ceph RBD CSI | Integrations","description":"This pack deploys the Ceph RBD CSI plugin"},"product":{"name":"Nomad","slug":"nomad","algoliaConfig":{"indexName":"product_NOMAD","searchOnlyApiKey":"9bfec34ea54e56a11bd50d6bfedc5e71"},"analyticsConfig":{"includedDomains":"nomadproject.io www.nomadproject.io","segmentWriteKey":"qW11yxgipKMsKFKQUCpTVgQUYftYsJj0"},"datoToken":"88b4984480dad56295a8aadae6caad","metadata":{"title":"Nomad by HashiCorp","description":"Nomad is a highly available, distributed, data-center aware cluster and application scheduler designed to support the modern datacenter with support for long-running services, batch jobs, and much more.","image":"https://www.nomadproject.io/nomad-public/img/og-image.png","icon":[{"href":"/nomad-public/_favicon.ico"}]},"alertBannerActive":true,"alertBanner":{"tag":"HashiConf","url":"https://hashiconf.com/2023?utm_source=direct&utm_medium=banner&utm_campaign=23Q3_HASHICONFGLOBAL_EVENT&utm_content=&utm_offer=event","text":"Our community conference is taking place in San Francisco and online October 10-12.","linkText":"Register now","expirationDate":""},"version":"1.2.5","subnavItems":[{"text":"Overview","url":"/","type":"inbound"},{"text":"Enterprise","url":"https://www.hashicorp.com/products/nomad/","type":"outbound"},"divider",{"text":"Tutorials","url":"https://developer.hashicorp.com/nomad/tutorials","type":"outbound"},{"text":"Docs","url":"/docs","type":"inbound"},{"text":"API","url":"/api-docs","type":"inbound"},{"text":"Plugins","url":"/plugins","type":"inbound"},{"text":"Tools","url":"/tools","type":"inbound"},{"text":"Community","url":"/community","type":"inbound"}],"basePaths":["docs","api-docs","plugins","tools","intro","downloads"],"rootDocsPaths":[{"iconName":"docs","name":"Documentation","path":"docs"},{"iconName":"entry-point","name":"Intro","path":"intro"},{"iconName":"api","name":"API","path":"api-docs"},{"iconName":"terminal-screen","name":"Tools","path":"tools"},{"iconName":"plug","name":"Plugins","path":"plugins"}],"integrationsConfig":{"description":"A curated collection of official, partner, and community Nomad Integrations."}},"integration":{"id":"baf216f0-1ac7-4337-8d0b-1ed301922907","slug":"ceph-rbd-csi","name":"Ceph RBD CSI","description":"This pack deploys the Ceph RBD CSI plugin","license_type":null,"license_url":null,"external_only":false,"external_url":"https://github.com/ceph/ceph-csi","tier":"community","repo_url":"https://github.com/hashicorp/nomad-pack-community-registry","subdirectory":"/packs/ceph_rbd_csi","created_at":"2023-06-26T21:37:18.202Z","updated_at":"2023-07-12T18:05:02.957Z","hide_versions":false,"organization":{"id":"a4a0551a-1451-4d89-9f56-8031c8350c77","slug":"hashicorp","created_at":"2022-11-09T22:56:32.391Z","updated_at":"2022-11-09T22:56:32.391Z"},"product":{"id":"40557cca-56ca-4cb2-abc6-9bba2a9ca62d","slug":"nomad","name":"Nomad","created_at":"2022-11-09T22:56:29.799Z","updated_at":"2022-11-09T22:56:29.799Z"},"versions":["0.1.0"],"components":[],"flags":[],"integration_type":{"id":"e8835871-6a6a-4836-8797-505cbfbe426a","product_id":"40557cca-56ca-4cb2-abc6-9bba2a9ca62d","slug":"pack","name":"Pack","plural_name":"Packs","description":"Packs are templated sets of resources that are meant to be deployed to Nomad together. Each pack defines parameters that can be customized by the end user.","created_at":"2023-05-02T17:31:29.062Z","updated_at":"2023-05-17T22:44:11.429Z"}},"activeRelease":{"id":"0dd12cc9-8082-41ad-a7d4-7a89d83c4837","integration_id":"baf216f0-1ac7-4337-8d0b-1ed301922907","version":"0.1.0","readme":"This pack deploys two jobs that run the [Ceph\nRBD](https://github.com/ceph/ceph-csi) CSI plugin. The node plugin\ntasks will be run as a system job, and the controller tasks will be\nrun as a service job.\n\n## Client Requirements\n\nThis pack can only be run on Nomad clients that have enabled volumes\nand privileged mode for the Docker task driver. In addition, you must\nhave the `rbd` kernel module loaded:\n\n```\n$ sudo modprobe rbd\n$ lsmod | grep rbd\nrbd                   106496  0\nlibceph               327680  1 rbd\n```\n\nWithout the kernel module loaded, plugins tasks will fail with errors\nlike: `modprobe: FATAL: Module rbd not found in directory`\n\n## Variables\n\n* `job_name` (string \"ceph_rbd_csi\") - The prefix to use as the job\n  name for the plugins. For exmaple, if `job_name = \"ceph_rbd_csi\"`,\n  the plugin job will be named `ceph_rbd_csi_controller`.\n* `datacenters` (list(string) [\"dc1\"]) - A list of datacenters in the\n  region which are eligible for task placement.\n* `region` (string \"global\") - The region where the job should be\n  placed.\n* `plugin_id` (string \"rbd.csi.ceph.com\") - The ID to register\n  in Nomad for the plugin.\n* `plugin_namespace` (string \"default\") - The namespace for the plugin\n  job.\n* `plugin_image` (string \"quay.io/cephcsi/cephcsi:canary\") - The\n  container image for the plugin.\n* `controller_count` (number 2) - The number of controller instances\n  to be deployed (at least 2 recommended).\n* `ceph_cluster_id` (string \"\") - The Ceph cluster ID.\n* `ceph_monitor_service_name` (string \"ceph-mon\") - The Consul service\n  name for the Ceph monitoring service.\n* `volume_id` (string \"myvolume\") - ID for the example volume spec to\n  output.\n* `volume_namespace` (string \"default\") - Namespace for the example\n  volume spec to output.\n* `volume_min_capacity` (string \"10GiB\") - Minimum capacity for the\n  example volume spec to output.\n* `volume_max_capacity` (string \"30GiB\") - Maximum capacity for the\n  example volume spec to output.\n\n## Volume creation\n\nThis pack outputs an example volume specification based on the plugin variables.\n\n#### **`volume.hcl`**\n\n```\nid        = \"myvolume\"\nname      = \"myvolume\"\nnamespace = \"default\"\ntype      = \"csi\"\nplugin_id = \"rbd.csi.ceph.com\"\n\ncapacity_min = \"10GiB\"\ncapacity_max = \"30GiB\"\n\ncapability {\n  access_mode     = \"single-node-writer\"\n  attachment_mode = \"file-system\"\n}\n\ncapability {\n  access_mode     = \"single-node-writer\"\n  attachment_mode = \"block-device\"\n}\n\n# get this secret from the Ceph allocation:\n# /etc/ceph/ceph.client.admin.keyring\nsecrets {\n  userID  = \"admin\"\n  userKey = \"AQDsIoxgHqpe...spTbvwZdIzA==\"\n}\n\nparameters {\n  clusterID     = \"129ceb60-ae2e-4313-a9f8-cb6087f97787\"\n  pool          = \"rbd\"\n  imageFeatures = \"layering\"\n}\n```\n","created_at":"2023-06-26T21:46:48.065Z","updated_at":"2023-06-26T21:46:48.065Z","components":[]},"breadcrumbLinks":[{"title":"Developer","url":"/"},{"title":"Nomad","url":"/nomad"},{"title":"Integrations","url":"/nomad/integrations"},{"title":"Ceph RBD CSI","url":"/nomad/integrations/hashicorp/ceph-rbd-csi","isCurrentPage":true}],"anchorLinks":[{"id":"client-requirements","level":2,"title":"Client Requirements"},{"id":"variables","level":2,"title":"Variables"},{"id":"volume-creation","level":2,"title":"Volume creation"},{"id":"volume.hcl","level":4,"title":"volume.hcl"}],"serializedREADME":{"compiledSource":"var c=Object.defineProperty,d=Object.defineProperties;var u=Object.getOwnPropertyDescriptors;var l=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;var p=(e,i,n)=>i in e?c(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n,t=(e,i)=>{for(var n in i||(i={}))o.call(i,n)&&p(e,n,i[n]);if(l)for(var n of l(i))r.call(i,n)&&p(e,n,i[n]);return e},s=(e,i)=>d(e,u(i));var m=(e,i)=>{var n={};for(var a in e)o.call(e,a)&&i.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&l)for(var a of l(e))i.indexOf(a)<0&&r.call(e,a)&&(n[a]=e[a]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var a=n,{components:e}=a,i=m(a,[\"components\"]);return mdx(MDXLayout,s(t(t({},layoutProps),i),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",t({},{className:\"g-type-long-body\"}),\"This pack deploys two jobs that run the \",mdx(\"a\",t({parentName:\"p\"},{href:\"https://github.com/ceph/ceph-csi\"}),`Ceph\nRBD`),` CSI plugin. The node plugin\ntasks will be run as a system job, and the controller tasks will be\nrun as a service job.`),mdx(\"h2\",t({},{id:\"user-content-client-requirements\",\"data-text-content\":\"Client Requirements\",className:\"g-type-display-3\"}),\"Client Requirements\"),mdx(\"p\",t({},{className:\"g-type-long-body\"}),`This pack can only be run on Nomad clients that have enabled volumes\nand privileged mode for the Docker task driver. In addition, you must\nhave the `,mdx(\"inlineCode\",{parentName:\"p\"},\"rbd\"),\" kernel module loaded:\"),mdx(\"pre\",null,mdx(\"code\",{parentName:\"pre\"},\"$ sudo modprobe rbd\",`\n`,\"$ lsmod | grep rbd\",`\n`,\"rbd                   106496  0\",`\n`,\"libceph               327680  1 rbd\",`\n`)),mdx(\"p\",t({},{className:\"g-type-long-body\"}),`Without the kernel module loaded, plugins tasks will fail with errors\nlike: `,mdx(\"inlineCode\",{parentName:\"p\"},\"modprobe: FATAL: Module rbd not found in directory\")),mdx(\"h2\",t({},{id:\"user-content-variables\",\"data-text-content\":\"Variables\",className:\"g-type-display-3\"}),\"Variables\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"job_name\"),` (string \"ceph_rbd_csi\") - The prefix to use as the job\nname for the plugins. For exmaple, if `,mdx(\"inlineCode\",{parentName:\"li\"},'job_name = \"ceph_rbd_csi\"'),`,\nthe plugin job will be named `,mdx(\"inlineCode\",{parentName:\"li\"},\"ceph_rbd_csi_controller\"),\".\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"datacenters\"),\" (list(string) \",'[\"dc1\"]',`) - A list of datacenters in the\nregion which are eligible for task placement.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"region\"),` (string \"global\") - The region where the job should be\nplaced.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"plugin_id\"),` (string \"rbd.csi.ceph.com\") - The ID to register\nin Nomad for the plugin.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"plugin_namespace\"),` (string \"default\") - The namespace for the plugin\njob.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"plugin_image\"),` (string \"quay.io/cephcsi/cephcsi:canary\") - The\ncontainer image for the plugin.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"controller_count\"),` (number 2) - The number of controller instances\nto be deployed (at least 2 recommended).`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"ceph_cluster_id\"),' (string \"\") - The Ceph cluster ID.'),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"ceph_monitor_service_name\"),` (string \"ceph-mon\") - The Consul service\nname for the Ceph monitoring service.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"volume_id\"),` (string \"myvolume\") - ID for the example volume spec to\noutput.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"volume_namespace\"),` (string \"default\") - Namespace for the example\nvolume spec to output.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"volume_min_capacity\"),` (string \"10GiB\") - Minimum capacity for the\nexample volume spec to output.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"volume_max_capacity\"),` (string \"30GiB\") - Maximum capacity for the\nexample volume spec to output.`)),mdx(\"h2\",t({},{id:\"user-content-volume-creation\",\"data-text-content\":\"Volume creation\",className:\"g-type-display-3\"}),\"Volume creation\"),mdx(\"p\",t({},{className:\"g-type-long-body\"}),\"This pack outputs an example volume specification based on the plugin variables.\"),mdx(\"h4\",t({},{id:\"user-content-volume.hcl\",\"data-text-content\":\"volumehcl\",className:\"g-type-display-5\"}),mdx(\"strong\",{parentName:\"h4\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"volume.hcl\"))),mdx(\"pre\",null,mdx(\"code\",{parentName:\"pre\"},'id        = \"myvolume\"',`\n`,'name      = \"myvolume\"',`\n`,'namespace = \"default\"',`\n`,'type      = \"csi\"',`\n`,'plugin_id = \"rbd.csi.ceph.com\"',`\n`,`\n`,'capacity_min = \"10GiB\"',`\n`,'capacity_max = \"30GiB\"',`\n`,`\n`,\"capability {\",`\n`,'  access_mode     = \"single-node-writer\"',`\n`,'  attachment_mode = \"file-system\"',`\n`,\"}\",`\n`,`\n`,\"capability {\",`\n`,'  access_mode     = \"single-node-writer\"',`\n`,'  attachment_mode = \"block-device\"',`\n`,\"}\",`\n`,`\n`,\"# get this secret from the Ceph allocation:\",`\n`,\"# /etc/ceph/ceph.client.admin.keyring\",`\n`,\"secrets {\",`\n`,'  userID  = \"admin\"',`\n`,'  userKey = \"AQDsIoxgHqpe...spTbvwZdIzA==\"',`\n`,\"}\",`\n`,`\n`,\"parameters {\",`\n`,'  clusterID     = \"129ceb60-ae2e-4313-a9f8-cb6087f97787\"',`\n`,'  pool          = \"rbd\"',`\n`,'  imageFeatures = \"layering\"',`\n`,\"}\",`\n`)))}MDXContent.isMDXComponent=!0;\n","scope":{}}},"__N_SSG":true}